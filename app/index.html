<!DOCTYPE html>
<html>
  <head>
    <title>CIS 197 JavaScript</title>
    <meta charset="utf-8">
    <meta name="description" content="UPenn CIS 197 Fall 2014 course website">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic|Montserrat:400,700|Inconsolata:400,700">
    <link rel="stylesheet" type="text/css" href="build/css/vendor/pure-min.css">
    <link rel="stylesheet" type="text/css" href="build/css/vendor/prism.css">
    <link rel="stylesheet" type="text/css" href="build/css/main.css">
  </head>
  <body>
    <div class="pure-g-r main-content index-page">
      <nav class="pure-u-1-8 pure-menu pure-menu-open">
        <div class="pure-menu-heading"><img id="logo" src="build/images/logo.png">
          <h2>CIS 197</h2>
        </div>
        <ul class="sections">
          <li class="home active"><a href="#home">Home</a></li>
          <li class="assignments"><a href="#assignments">Assignments</a></li>
          <li class="lectures"><a href="#lectures">Lectures</a></li>
          <li class="piazza"><a href="https://piazza.com/upenn/fall2014/cis197" target="_blank">Piazza</a></li>
        </ul><small>&copy; 2014</small>
      </nav>
      <section class="pure-u-3-4 home active"><h2 id="javascript-fall-2014-">JavaScript (Fall 2014)</h2>
<h3 id="intro-to-front-end-web-development">Intro to Front End Web Development</h3>
<p>Course meets <strong>Tuesday 3:00pm – 4:30pm</strong> in <strong>Towne 319</strong>.</p>
<p>Instructor: <strong>Geoffrey Vedernikoff</strong> (<a href="mailto:veg@seas.upenn.edu">veg@seas.upenn.edu</a>)</p>
<p>TAs:</p>
<ul>
<li><strong>Ian Sibner</strong> (<a href="mailto:isibner@seas.upenn.edu">isibner@seas.upenn.edu</a>)</li>
<li><strong>Clara Wu</strong> (<a href="mailto:scwu@seas.upenn.edu">scwu@seas.upenn.edu</a>)</li>
</ul>
<p>Office hours: See <a href="https://piazza.com/upenn/fall2014/cis197/staff">Piazza staff page</a></p>
<h3 id="course-description">Course Description</h3>
<p>This course provides an introduction to modern web development frameworks,
techniques, and practices used to deliver robust client side applications on
the web. The emphasis will be on developing JavaScript programs that run in
the browser, <em>not</em> server-side applications in traditional languages like Java,
Python, or Ruby. See the lecture schedule for more info.</p>
<p>This course is most useful for students who have some programming and web
development experience and want to develop moderate JavaScript skills to be
able to build complex, interactive applications in the browser.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>CIS 120 or equivalent (or permission of instructor).</li>
<li>Basic knowledge of HTML/CSS (if you don&#39;t meet this requirement, you are
expected to pick up the basics on your own with online resources like
<a href="http://codecademy.com">Codecademy</a> and
<a href="https://developer.mozilla.org/en-US/">Mozilla Developer Network</a>).</li>
</ul>
<h3 id="policies">Policies</h3>
<p>Extensions on homework assignments will generally be granted if you ask for
them in advance. Assignments come with the opportunity for revision up to a
week after grading. <strong><em>See the
<a href="https://docs.google.com/document/d/1RQeMk8lDLp2xw1_odI5Gaw4NgUpm2c35RlRpMSCwP3A/edit?usp=sharing">course syllabus</a>
for more detailed policies and grading info</em></strong>.</p>

      </section>
      <section class="pure-u-3-4 assignments"><h2 id="assignments">Assignments</h2>
<p>Assignments are due <strong>at 9am</strong> unless otherwise indicated.
Code submissions are to be made using the Github submission system.
Refer to the <a href="#style">style guide</a> for coding JavaScript.</p>
<p>hw0, due <strong>Tues, Sept. 9</strong>: <a href="#github">Set up Github submission</a>.</p>
<p>hw1, due <strong>Tues, Sept. 16</strong>: <a href="https://github.com/cis197f14/hw/blob/master/hw1/exercises.js">Finger exercises</a>.</p>
<p>hw2, due <strong>Fri, Sept. 26</strong>: <a href="#hw2">XML object modeling</a>.</p>
<p>hw3, due <strong>Tues, Oct. 7</strong>: <a href="#hw3">Pokémon map building</a>.</p>
<p>hw4, due <strong>Tues, Oct. 21</strong>: <a href="#hw4">Backbone.js starter</a>.</p>
<p>hw5, due <strong>Fri, Oct. 31</strong>: <a href="#hw5">Intermediate Backbone.js app</a>.</p>
<p>hw6, due <strong>Wed, November 19</strong>: <a href="#hw6">Autocompleter</a>.</p>
<p>hw7, due <strong>Wed, December 3</strong>: <a href="#hw7">Product Hunt Client</a> and <a href="#proposal">Final project proposal</a>.</p>
<h2 id="final-project">Final Project</h2>
<p>The final project will be an open-ended JavaScript application created with
client-side framework of the student&#39;s choice. It should demonstrate 10-15
hours of work. The due date is <strong>December 16</strong>.</p>
<p>See the <a href="#proposal"><strong>proposal spec</strong></a> for more information.</p>

      </section>
      <section class="pure-u-3-4 lectures"><h2 id="lectures">Lectures</h2>
<p><strong>Code samples</strong> from lectures are available in
<a href="https://github.com/cis197s14/lectures">this Github repository</a>.</p>

        <table>
          <thead>
            <tr>
              <td>Lecture</td>
              <td>Date</td>
              <td>Content</td>
              <td>Lecture Code</td>
              <td>Reading, Resources</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0</td>
              <td>9/2</td>
              <td>
                <a href="#lecture1">
                  JS basics & syntax <br/>
                  How to run JS client-side and server-side
                </a>
              </td>
              <td></td>
              <td>
                Eloquent JS, Chapter 2 <br/>
                <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript">
                  [MDN] A re-introduction to JavaScript
                </a>
                
              </td>
            </tr>
            <tr>
              <td>1</td>
              <td>9/9</td>
              <td><a href="#js-functions">JS functions</a></td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec1'>Lec 1</a></td>
              <td>Eloquent JS, Chapters 3</td>
            </tr>
            <tr>
              <td>2</td>
              <td>9/16</td>
              <td><a href="#objects">JS objects & inheritance</a></td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec2'>Lec 2</a></td>
              <td>
                <a href="https://developer.mozilla.org/en-US/docs/DOM">
                  [MDN] Document Object Model
                </a> <br/>
                Eloquent JS, Chapters 12
                
              </td>
            </tr>
            <tr>
              <td>3</td>
              <td>9/23</td>
              <td>
                <a href="#browsers">JS in browsers</a> <br/>
                <a href="#dom-manipulation">DOM Manipulation</a>
              </td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec3'>Lec 3</a></td>
              <td>
                <a href="https://developers.google.com/chrome-developer-tools/">
                  Chrome DevTools docs
                </a>
                
              </td>
            </tr>
            <tr>
              <td>4</td>
              <td>9/30</td>
              <td><a href="#browser-events">Browser Events</a></td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec4'>Lec 4</a></td>
              <td>
                Eloquent JS, Chapter 13 <br/>
                
              </td>
            </tr>
            <tr>
              <td>5</td>
              <td>10/7</td>
              <td><a href="#functional">Functional Programming in JS</a> <br/></td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec5'>Lec 5</a></td>
              <td>
                Eloquent JS, Chapter 6 <br/>
                <a href="http://dailyjs.com/2012/09/14/functional-programming/">
                  [DailyJS] Functional Programming in JS
                </a> <br/>
                DBA: Intro, Fundamentals
                
              </td>
            </tr>
            <tr>
              <td>6</td>
              <td>10/14</td>
              <td><a href="#mvc">Introduction to client-side MVC</a></td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec6'>Lec 6</a></td>
              <td>
                <a href="http://backbonejs.org/">
                  Backbone docs
                </a>
                
              </td>
            </tr>
            <tr>
              <td>7</td>
              <td>10/21</td>
              <td>A Deeper Dive into Backbone</td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec7'>Lec 7</a></td>
              <td>
                <a href="http://backbonejs.org/examples/todos/">
                  Todo app
                </a> <br/>
                <a href='http://backbonejs.org/docs/todos.html'>
                  Todo app source
                </a>
                
              </td>
            </tr>
            <tr>
              <td>8</td>
              <td>10/28</td>
              <td>
                <a href="#lecture9">
                  Promises
                </a>
              </td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec8'>Lec 8</a></td>
              <td>
                <a href="http://mattgreer.org/articles/promises-in-wicked-detail/">
                  Promises in Wicked Detail
                </a>
                
              </td>
            </tr>
            <tr>
              <td>9</td>
              <td>11/4</td>
              <td>
                <a href=''>
                  EventEmitters
                </a> <br/>
                <a href=''>
                  Backbone vs. jQuery
                </a>
              </td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec9'>Lec 9</a></td>
              <td></td>
            </tr>
            <tr>
              <td>10</td>
              <td>11/11</td>
              <td>
                <a href=''>
                  Testing
                </a> <br/>
                <a href=''>
                  CoffeeScript
                </a>
              </td>
              <td>Lec 10</td>
              <td>
                <a href='http://coffeescript.org'>
                  CoffeeScript
                </a> <br/>
                <a href='http://js2coffee.org'>
                  JS to Coffee Compiler
                </a>
                
              </td>
            </tr>
            <tr>
              <td>11</td>
              <td>11/18</td>
              <td>React.js</td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec11'>Lec 11</a></td>
              <td>
                <a href='http://facebook.github.io/react/docs/tutorial.html'>
                  React Tutorial
                </a> <br/>
                <a href='http://facebook.github.io/react/blog/2013/11/05/thinking-in-react.html'>
                  Thinking in React
                </a>
                
              </td>
            </tr>
            <tr>
              <td>12</td>
              <td>12/2</td>
              <td>Future of JavaScript</td>
              <td><a href='https://github.com/cis197f14/lectures/tree/master/lec12'>Lec 12</a></td>
              <td>
                <a href='http://kangax.github.io/compat-table/es6/'>
                  ES6 Compatibility Table
                </a> <br/>
                <a href='https://github.com/lukehoban/es6features#readme'>
                  ES6 Features
                </a> <br/>
                <a href='http://davidwalsh.name/async-generators'>
                  Going Async with ES6 Generators
                </a> <br/>
                <a href='http://javascriptplayground.com/blog/2014/07/introduction-to-es6-classes-tutorial/'>
                  An Intro to ES6 Classes
                </a>
                
              </td>
            </tr>
          </tbody>
        </table><h2 id="reading">Reading</h2>
<ul>
<li><a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742"><em>JavaScript: The Good Parts</em></a> – Douglas Crockford</li>
<li><a href="http://eloquentjavascript.net/"><em>Eloquent JavaScript</em></a> – Marijn Haverbeke</li>
<li><a href="http://addyosmani.github.io/backbone-fundamentals/"><em>Developing Backbone.js Applications</em></a> (DBA) – Addy Osmani</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript"><em>Mozilla Developer Network JS Articles</em></a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes github language-bash"><h1 id="cis197-code-submission">CIS197 Code Submission</h1>
<p>CIS 197 (January 22, 2013)</p>
<p><em>Adapted from <a href="http://www.seas.upenn.edu/~cis192/spring2013/submission/hwsubmission.html">CIS 192</a></em>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Mac or Linux environment. Windows works too, but some commands will be
different and you are responsible for figuring out the differences.</li>
<li>Git installed in your development environment &amp; some basic knowledge of git
commands. If you need to boost your git skills, try
<a href="http://help.github.com/">Github help</a>, <a href="http://try.github.io/">Try Git</a>, <a href="http://gitimmersion.com/">Git
Immersion</a>, and/or
<a href="http://marklodato.github.io/visual-git-guide/index-en.html">A Visual Git Reference</a>.</li>
<li>A <a href="http://github.com">Github</a> account. Feel free to use the one you have
already.</li>
</ul>
<h3 id="setup">Setup</h3>
<p><em>Note</em>: This system is still in beta. If you encounter errors in this guide or
the course website, please post a private <a href="https://piazza.com/class/hpz2ie7jeo0sx">Piazza</a>
question. If you have a question about Git or Github, please post a public
question.</p>
<ol>
<li><p>Complete the <a href="https://docs.google.com/forms/d/1OLTZDuIwhyK6X8lMeuuxRaGJDkmhu1HtAR_4qkTEO3Q/viewform">intro survey</a>
if you haven&#39;t already. Once you get an email
saying you have been added to the <strong>cis197f14</strong> organization, you may proceed
with the next steps.</p>
</li>
<li><p>Log onto Github. Change your view to the CIS 197 class context.
<img src="build/images/github/context.png" alt="switch context"></p>
</li>
<li><p>Click on the repository we&#39;ve created for your homework. The name will be in
the format <strong>&quot;hw_pennkey&quot;</strong>. Note this repository is private; only you and
the instructors have access to it.
<img src="build/images/github/repo-name.png" alt="repo name"></p>
</li>
<li><p>Copy the repository url from its page.
<img src="build/images/github/repo-url.png" alt="repo url"></p>
</li>
<li><p>Open your terminal. You&#39;re going to clone a copy of this repository so that
you can do work on it and push updates back to Github. First <code>cd</code> into the
directory you want the homework folder in (if you don&#39;t know what that means,
please take a few minutes to read Section 3 of <a href="http://heather.cs.ucdavis.edu/~matloff/UnixAndC/Unix/UnixBareMn.pdf">this document</a>. Now execute:</p>
<pre><code> git clone repo_url_you_copied
</code></pre><p>put together, that all looks like</p>
<pre><code> bash-3.2 $ cd ~/Github/cis197/

 bash-3.2 $ git clone https://github.com/cis197f14/hw_cis197bot.git
 Cloning into &#39;hw_cis197bot&#39;...
 Username for &#39;https://github.com&#39;: cis197bot
 Password for &#39;https://cis197bot@github.com&#39;:
 warning: You appeared to have cloned an empty repository.
 Checking connectivity... done.
 bash-3.2 $
</code></pre><p>You&#39;ve now copied the (empty) repository onto our computer, so you can go into
that directory:</p>
<pre><code> bash-3.2 $ cd hw_cis197bot
</code></pre></li>
<li><p>Now you&#39;re going to add the class homework repository as an &quot;upstream&quot; to our
personal homework repository. This will allow you to pull required homework
files directly from Github. You&#39;ll need to execute the following command
inside the directory you just cloned:</p>
<pre><code> git remote add upstream https://github.com/cis197f14/hw.git
</code></pre><p>This added the class repository as a git &quot;remote&quot;, which means that you can
pull changes down from that repository and into your personal repository.
Let&#39;s do that now. Run the command:</p>
<pre><code> git pull upstream master
</code></pre><p>and you should see that files were copied from the server.</p>
</li>
<li><p>Almost done. You need to create a git branch where your code will be
submitted. First, create a new branch called &quot;submit&quot;:</p>
<pre><code> git branch submit
</code></pre><p>Now push that branch to Github:</p>
<pre><code> git push origin submit
</code></pre><p>And also push the master branch to Github:</p>
<pre><code> git push origin master
</code></pre></li>
</ol>
<p>Great! Now that the setup is done, you can get started on homework.</p>
<h3 id="homework-0">Homework 0</h3>
<p>The first submission is just to make sure you&#39;ve set everything up correctly.
It&#39;s a simple JavaScript Hello World program. For future homeworks, please refer
to the next section.</p>
<ol>
<li><p>First, create a <code>hw0</code> folder and create an empty <code>hello.js</code> file in it.</p>
<pre><code> mkdir hw0 &amp;&amp; touch hw0/hello.js
</code></pre></li>
<li><p>Now, write the Hello World program into the file.</p>
<pre><code> echo &quot;console.log(&#39;Hello world&#39;);&quot; &gt; hw0/hello.js
</code></pre></li>
<li><p>Run the program to make sure it prints &#39;Hello world&#39;.</p>
<pre><code> node hw0/hello.js
</code></pre></li>
<li><p>Now, you need to stage and commit all the 
relevant files:</p>
<pre><code> git add hw0/hello.js &amp;&amp; git commit -m &quot;done with hw0&quot;
</code></pre><p>Push changes to Github:</p>
<pre><code> git push origin master
</code></pre></li>
<li><p>Follow steps 4 and 5 in the next section to submit the Pull Request and finish Homework 0.</p>
</li>
</ol>
<h3 id="working-on-homework">Working on homework</h3>
<ol>
<li><p>First, get any files/folders that were added to the class homework
repository:</p>
<pre><code> git pull upstream master
</code></pre></li>
<li><p>Now complete your assignment. Please make sure to create a different folder
in the repository for each homework assignment (<code>hw1</code>, <code>hw2</code>, etc.)</p>
</li>
<li><p>Here&#39;s how you commit to the repository and push the work to Github. Let&#39;s
say you wrote code in two files, <code>file1.js</code> and <code>file2.js</code>, in the directory
<code>hw1</code> inside your homework repository. First you need to stage all the
relevant files:</p>
<pre><code> git add hw1/file1.js hw1/file2.js
</code></pre><p>Now make a commit:</p>
<pre><code> git commit -m &quot;done with hw1&quot;
</code></pre><p>Push changes to Github:</p>
<pre><code> git push origin master
</code></pre></li>
<li><p>Now your homework files are on Github. All you need to do now is create
a pull request to complete the submission. Go to your homework repository and
create a new Pull Request from the Pull Requests tab.
<img src="build/images/github/pull-request.png" alt="pull request"></p>
</li>
<li><p>Set up a pull request with the base branch set as &quot;submit&quot;, and finally send
it.
<img src="build/images/github/send-pull.png" alt="send pull"></p>
</li>
</ol>
<p>Do not click the &quot;Merge Pull Request&quot; button on Github after your submission (a
TA will do that after grading homework). Though we require that you <em>submit</em>
your homework with git, it would be wise to use git to keep track of your
changes before you submit.</p>
<h3 id="notes">Notes</h3>
<ul>
<li>If you don&#39;t want to type your password every time you try to push or pull
from Github, see the documentation on <a href="https://help.github.com/articles/set-up-git#password-caching">password caching</a>.</li>
<li>Feel free to work on a branch other than <code>master</code> (if you know what that
means), but please make pull requests against the <code>submit</code> branch.</li>
</ul>

      </section>
      <section class="pure-u-3-4 notes lecture1 language-javascript"><h1 id="lecture-1-intro-js-basics">Lecture 1: Intro &amp; JS Basics</h1>
<p>CIS 197 (January 22, 2013)</p>
<h2 id="intro">Intro</h2>
<p>As a browser scripting language, one of JavaScript&#39;s main uses is to implement
view logic -- how a user interface on the web is drawn, manipulated, and
interacted with. But as the language has matured, its scope has widened. Today,
you can do things like build a web server in JavaScript using Node.js or compile
video games from C++ to JS using Emscripten to play Quake III in a browser.</p>
<p>A few years ago, the traditional workflow of the front end developer was to get
some JS (probably jQuery) code working locally, FTP it over to a server, and
then handle the myriad cross-browser compatibility issues that ensued (*cough*
IE6 *cough*). The past few years have seen somewhat of a transformation of the
front end dev role, with a much greater emphasis on tools and practices. It&#39;s
a result of:</p>
<ul>
<li>people taking front end more seriously,</li>
<li>browsers getting MUCH better,</li>
<li>and more programmers with traditional programming experience entering the
ecosystem</li>
</ul>
<p>One of my goals in this class is to introduce you to modern tools, practices,
and workflows in front end development. There&#39;s a sort of
<a href="http://rmurphey.com/blog/2012/04/12/a-baseline-for-front-end-developers/">baseline</a>
of things that you&#39;re expected to be familiar with (Node, npm, homebrew, git,
tests, build systems, etc.) in order to be successful and not feel left behind.
I&#39;ll talk more about this at the end of today&#39;s lecture.</p>
<p>Today, I&#39;m going to talk about language basics like syntax and variable scoping
and there won&#39;t be much mention of the web. As a programming language, JS is
an implementation of the ECMAScript standard, which makes no reference to web
technology. We&#39;re currently on v5 of ECMAScript, with v6 expected to be
a significant expansion to the language due in 2014.</p>
<h2 id="language-basics">Language Basics</h2>
<p>See <a href="#js-basics">JS basics module</a>.</p>
<h2 id="exercises">Exercises</h2>
<p>Using these basics, can you write out a Fizzbuzz program?</p>
<p>Solution:</p>
<pre><code>for (var i = 0; i &lt; 15; i++) {
  if (i % 3 === 0 &amp;&amp; i % 5 === 0) {
    console.log(&quot;fizzbuzz\n&quot;);
  } else if (i % 3 === 0) {
    console.log(&quot;fizz\n&quot;);
  } else if (i % 5 === 0) {
    console.log(&quot;buzz\n&quot;);
  } else {
    console.log(i + &quot;\n&quot;);
  }
}
</code></pre><h2 id="homework">Homework</h2>
<p>Most of your homework will be to get up to speed with the tools you need for
front end development.</p>
<p>The first important thing you&#39;re expected to know is <strong>git</strong> version control.
Using version control allows you to collaborate on software projects and
participate in the rich open-source community (JS is the most popular language
on Github!) To boost your git skills, use online resources like:</p>
<ul>
<li><a href="http://help.github.com/">Github help</a></li>
<li><a href="http://try.github.io/">Try Git</a></li>
<li><a href="http://gitimmersion.com/">Git Immersion</a></li>
<li><a href="http://marklodato.github.io/visual-git-guide/index-en.html">A Visual Git Reference</a></li>
</ul>
<p>For this class, I also expect a basic to moderate understanding of HTML/CSS. If
you are lacking in this area, please use online resources like
<a href="http://codecademy.com">Codecademy</a> and
<a href="https://developer.mozilla.org/en-US/">Mozilla Developer Network</a>.</p>
<p>The rest of your homework is as follows:</p>
<ul>
<li>Read the <em>entire</em> <a href="https://docs.google.com/document/d/1RQeMk8lDLp2xw1_odI5Gaw4NgUpm2c35RlRpMSCwP3A/edit?usp=sharing">syllabus</a>.</li>
<li>Download Google Chrome (optionally, Chrome Canary).</li>
<li>Install the latest version of node.js (on OS X, I recommend using Homebrew).</li>
<li>Set up a Github account &amp; fill out the
<a href="https://docs.google.com/forms/d/1OLTZDuIwhyK6X8lMeuuxRaGJDkmhu1HtAR_4qkTEO3Q/viewform">intro survey</a>.</li>
<li>Complete the <a href="#github">code submisison tutorial</a>.</li>
</ul>

      </section>
      <section class="pure-u-3-4 notes js-basics language-javascript"><h1 id="javascript-basics">JavaScript Basics</h1>
<p>Reference: <strong><em>Eloquent JavaScript</em></strong> and <strong><em>JavaScript: The Good Parts</em></strong>.</p>
<p><a href="#lecture1">&larr; Back to Lecture 1</a></p>
<h3 id="introduction">Introduction</h3>
<blockquote>
<p>JavaScript is a programming language being used to do all sorts of clever and
horrible things on the web.</p>
</blockquote>
<p>-- Marijn Haverbeke, EloquentJS</p>
<p>It&#39;s the world&#39;s most widely available application runtime. It runs in all
modern web browsers and is one of the easiest languages to start using since you
don&#39;t have to download anything. Even if you don&#39;t do much web programming,
which this course focuses on, I hope I&#39;ll be able to expose you to some
interesting (or even mind-boggling) programs that influence how you write good
code in other languages and platforms. The good parts of JS (as Douglas
Crockford points out) really make it a great functional language -- deep down,
it actually shares more with Lisp and Scheme than C or Java (even though it
looks like C or Java on the surface).</p>
<p>You might have heard a great deal of criticism about JS coming into the course
(I&#39;m sure I did when I first picked up JS). When you first start writing
programs, you&#39;ll notice that it&#39;s very liberal in what it allows. However, what
you type might end up being interpreted very differently from what you imagined.
Consider this seemingly basic arithmetic with various types:</p>
<pre><code>1 + &#39;2&#39;        // --&gt; &#39;12&#39;
[] + 4         // --&gt; &#39;4&#39;
[] - 4         // --&gt; -4
{} + 4         // --&gt; &#39;[object Object]4&#39;
</code></pre><p>Sure, it might seem weird that we&#39;re adding together arrays, objects, and numbers
(where other languages would throw type errors), but you somewhat get the idea.</p>
<p>This kind of weak dynamic typing accounts for much of the language&#39;s
flexibility, but can also be troubling for beginners since the interpreter won&#39;t
help you identify all errors. On the flip side, it allows for many techniques
that are impossible in more strict languages. By learning the language properly
and working with it for a while, I&#39;ve grown to really like JS -- you might too!</p>
<h3 id="getting-started">Getting Started</h3>
<p>We&#39;re going to learn JavaScript by reading, writing, and running code. Like
I said, JavaScript usually runs in a browser, but it also runs on a platform
called <code>node.js</code>, which is built on Google Chrome&#39;s V8 JavaScript runtime. We&#39;ll
talk more about <a href="http://nodejs.org/">Node</a> later in the course, but for now I&#39;ll
just use it as a JS interpreter and runtime to run code snippets.</p>
<p>You can fire up a REPL (interactive interpreter) simply with the <code>node</code> command.
If you don&#39;t have Node and want to follow along, you can use
<a href="http://repl.it/languages/JavaScript">repl.it</a>. (JS code can also be written to
a <code>.js</code> file and run with <code>node</code>). Alternatively, you can simply open up the
console in your web browser and type expressions:</p>
<p><img src="build/images/browser-console.png" alt="browser-console"></p>
<p>Ready? Let&#39;s start by looking at the different kinds of values in JS.</p>
<h3 id="values">Values</h3>
<p><strong>Number</strong>: only one type, written literally.</p>
<ul>
<li>Internally, stored as a 64-bit double (like Java <code>double</code>)</li>
<li><code>NaN</code> represents not a number, where a value did not produce a result</li>
<li><p><code>Infinity</code> represents all numbers greater than (roughly) <code>1.8e308</code></p>
<pre><code>  2 + (4 * -3)  // --&gt; -10
  1.25e4        // --&gt; 12500
</code></pre></li>
</ul>
<p><strong>String</strong>: written with single quotes or double quotes. Use single quotes.</p>
<ul>
<li>Escape values with backslash <code>&quot;\n \t \\&quot;</code></li>
<li>Insert Unicode character codes with <code>\u</code></li>
<li>Can be compared with <code>&lt;</code>, <code>&gt;</code> (roughly alphabetical)</li>
<li><p>Strings are immutable, but easy to concatenate with <code>+</code></p>
<pre><code>  &quot;abc&quot; + &quot;def&quot;         // --&gt; &quot;abcdef&quot;
  4 + &quot; is a number&quot;    // --&gt; &quot;4 is a number&quot;
  &quot;abacus&quot; &lt; &quot;aardvark&quot; // --&gt; false
</code></pre></li>
<li><p>No <code>char</code> type means you must use a single-char string</p>
</li>
<li>Each character is 16 bits wide</li>
<li>Access length with <code>.length</code> property (there are a few other String methods,
discussed later)</li>
</ul>
<p><strong>Boolean</strong>: <code>true</code>, <code>false</code></p>
<ul>
<li><p>Standard operators: <code>&amp;&amp;</code>, <code>||</code>, <code>!</code></p>
<pre><code>  true &amp;&amp; !false  // --&gt; true
</code></pre></li>
</ul>
<p><em>A note about <em>falsy</em> values</em>: The following values, when evaluated as Booleans,
are false:</p>
<ul>
<li><code>false</code></li>
<li><code>null</code></li>
<li><code>undefined</code></li>
<li>The empty string <code>&#39;&#39;</code></li>
<li>The number <code>0</code></li>
<li>The number <code>NaN</code></li>
</ul>
<p>All <em>other</em> values, including <code>true</code>, the string <code>&#39;false&#39;</code>, and all objects, are
<strong><em>truthy</em></strong>. Control flows like this are common:</p>
<pre><code>var course = {
  title: &#39;JavaScript&#39;,
  dept: &#39;CIS&#39;,
  code: 197
};

if (course.instructor) {
  console.log(course.instructor.name);
} else {
  console.error(&quot;No instructor found!&quot;);
}
</code></pre><p><strong>Object</strong>: curly braces (really convenient literal notation!)</p>
<ul>
<li>Lightweight mutable key-value stores</li>
<li>Like C structs, Python dicts, associative arrays, etc.</li>
<li><p>Accessed with <code>.propertyName</code> or <code>[&#39;propertyName&#39;]</code> refinement syntax</p>
<pre><code>  var obj = {
    number: 1,
    string: &quot;abcdef&quot;,
    bool: true,
    object: { a: 1, b: 2, c: 3 },
    function: (function () { return 0; })
  }

  obj.string        // --&gt; &quot;abcdef&quot;
  obj[&#39;object&#39;].a   // --&gt; 1
</code></pre></li>
<li><p>Under the hood, pretty much everything is represented as an object in JS
(more on this later)</p>
</li>
</ul>
<p><strong>Array</strong>: square brackets literal notation.</p>
<ul>
<li>Hash map performance</li>
<li>Internally represented as objects with numerical property names: <code>arr[0]</code></li>
<li><p>Convenience methods like <code>.push</code>, <code>.pop</code>, <code>.join</code></p>
<pre><code>  var a = [ &#39;this&#39;, &#39;is&#39;, &#39;a&#39;, &#39;list&#39;, &#39;of&#39;, &#39;tokens&#39; ]

  a[0]          // --&gt; &#39;this&#39;
  a.join(&#39; &#39;)   // --&gt; &#39;this is a list of tokens&#39;
</code></pre></li>
</ul>
<p><strong>Function</strong>: <code>function</code> keyword + curly braces contain block of statements.</p>
<ul>
<li>First-class JS object (this allows JavaScript to be highly <em>functional</em>)</li>
<li>&quot;Piece of a program wrapped in a value&quot;</li>
<li><p>Returns a value provided with <code>return</code> keyword, otherwise <code>undefined</code></p>
<pre><code>  var square = function (x) {
    return x * x;
  }

  Math.square = square;

  console.log(&quot;the square of 4 is &quot; + Math.square(4));
</code></pre></li>
</ul>
<p><strong>Undefined</strong>: void, null, un-assigned-to variables.</p>
<pre><code>var x;                    // --&gt; undefined
var f = function () { };
f();                      // --&gt; undefined
</code></pre><p>Values are garbage collected by the JS runtime (no <code>malloc</code>, etc. like in C).</p>
<p>Let&#39;s examine some more language grammar &amp; terminology...</p>
<h3 id="expressions">Expressions</h3>
<p><strong>Expressions</strong> are anything that produces a value:</p>
<ul>
<li>Literally written values (string, number, built-in)</li>
<li>Expression within parentheses</li>
<li>Unary operator applied to one expression (<code>-</code>, <code>!</code>, <code>typeof</code>, ...)</li>
<li>Binary operator applied (infix) to two expressions (<code>+</code>, <code>*</code>, <code>===</code>, <code>&amp;&amp;</code>, ...)</li>
<li>Ternary operator applied to three expressions
(<code>predicate ? valueIfTrue : valueIfFalse</code>)</li>
<li>Object refinement (using <code>[&#39;propertyName&#39;]</code> or <code>.propertyName</code>)</li>
<li>Invocation</li>
</ul>
<p>Expressions cannot have side effects, meaning they cannot affect state of the
program or the world. They <em>only</em> produce a value.</p>
<h3 id="statements">Statements</h3>
<p>JavaScript programs are built as a list of statements. Each is typically
terminated by a semicolon <code>;</code> (C-style syntax). You can also sequence
statements with <code>,</code> but let&#39;s not have any of that in this course.</p>
<p>Programs are executed sequentially statement-by-statement from top to bottom;
you can guarantee order of execution.</p>
<h3 id="programs">Programs</h3>
<p>A JavaScript file contains a program. You can run multiple files at the same
time and they will share a common global environment. There is no built-in
module system in ECMAScript (coming soon in v6), but we will discuss later how
you can properly organize your code to achieve the kinds of module or package
systems you might be familiar with from other programming languages.</p>
<p>In a browser environment, each <code>&lt;script&gt;</code> tag loads a compilation unit and
executes the contained code immediately. Here we encounter one of the <strong>bad
parts</strong> of JavaScript: reliance on global variables.</p>
<p>JavaScript lacks a linker (like <code>C</code>), so when it interprets a compilation unit,
it throws all variables together into a common global namespace &amp; scope.</p>
<h3 id="variable-scoping">Variable Scoping</h3>
<p>We&#39;ve seen a few variables in the above examples; let&#39;s look at them more
closely. You declare variables simply with the <code>var</code> keyword (look ma, no
static types!).</p>
<p>Variables exist in an environment and can one of two scopes:</p>
<ul>
<li>Global</li>
<li>Function</li>
</ul>
<p>The rule for distinguishing the two is actually pretty simple: variables
declared outside of a function definition are <strong>global</strong> while those inside are
<strong>local</strong>.</p>
<p>Local variables are created and destroyed every time a function is run (which
is often just once; we&#39;ll see how this is exploited).</p>
<p><em>Variables are evaluated as if they were declared at the top of the scope they
exist in</em>. This is referred to as <strong><em>hoisting</em></strong>. Take a look at this buggy
program:</p>
<pre><code>var a = 100;
show();

function show () {
  console.log(a);    // --&gt; &quot;undefined&quot;

  if (true) {
    var a = 123;
  }
}
</code></pre><p>Why does line 5 print &quot;undefined&quot;?</p>
<p>Before JavaScript executes a function, it looks for all variable declarations
within the current scope. It then declares all those variables <em>but doesn&#39;t
assign them</em> (effectively executing the statement <code>var a;</code>). Only then does
the function block get executed. Assignment of a variable occurs when the
function execution reaches the line where you actually assign a variable.</p>
<p>In the example above, <code>a</code> is re-declared as a local variable at the top of the
<code>show</code> function. So when we try to print out its value with <code>console.log</code>, its
value is undefined.</p>

      </section>
      <section class="pure-u-3-4 notes js-functions language-javascript"><h1 id="javascript-functions">JavaScript Functions</h1>
<p>Reference: <strong><em>Eloquent JavaScript</em></strong> and <strong><em>JavaScript: The Good Parts</em></strong>.</p>
<hr>
<blockquote>
<p>Generally, the craft of programming is the factoring of a set of requirements
into a set of functions and data structures.</p>
</blockquote>
<p>-- Douglas Crockford (<em>JS: The Good Parts</em>)</p>
<p>I won&#39;t too talk about the data structures, but let&#39;s examine the basics of what
a <em>function</em> does in a programming language. Functions embody the logic of your
application.</p>
<p>Pure functions have no side effects -- they don&#39;t affect the state of the world.
They are easy to use and reason about since they require no context, and they
are also more widely applicable to solving problems through code. However, they
do not solve all the possible problems you might come across when developing
software. I did say, of course, that JS is mainly used for view logic on the
web; if we can&#39;t manipulate the state of a web page, then what good is our
program?</p>
<p>This next bit of advice applies to nearly all programming languages: if
a function seems simple enough that it can be written <em>purely</em>, then do so. In
terms of programming language theory, JavaScript borrows a lot from functional
languages, so it would be wise (and more natural to the language) to remain
thinking functionally, trying to keep as much of the impure application logic
contained to a few modules.</p>
<p>One more thing: like I said earlier, nearly everything in JS is an object, and 
that includes functions as well. They have a few special things about them,
including invocation capabilities. We&#39;ll cover more of the nuances of the
function object later.</p>
<h3 id="invocation">Invocation</h3>
<p>In addition to its arguments (which are <em>immediately</em> defined as variables),
a function receives two extra special variables in its context: <code>this</code> and
<code>arguments</code>.</p>
<p><code>this</code> refers to the containing scope or context of a function invocation:</p>
<p><strong>Method Invocation</strong>: when invoked as a property of an object, a function&#39;s
containing object is its context.</p>
<pre><code>var myObject = {
  value: 0,
  increment: function (inc) {
    inc = inc ? inc : 1;
    this.value += inc;
  }
}

myObject.increment();
myObject.increment(50);
console.log(myObject.value);  // --&gt; 51
</code></pre><p><strong>Function Invocation</strong>: functions not invoked as an object property are
attached to the global object; this is somewhat of a flaw in JavaScript&#39;s
design. This flaw is best demonstrated by example.</p>
<p>Let&#39;s say I wanted to augment <code>myObject</code> with a <code>double</code> method
which doubles the contained <code>value</code> property. And maybe I&#39;d like to use a
helper function to encode this logic, like so:</p>
<pre><code>myObject.double = function () {
  var helper = function () {
    this.value = this.value * 2;
  };

  helper();
};

myObject.double();
console.log(myObject.value);  // --&gt; 51
</code></pre><p>But this doesn&#39;t work! <code>myObject.value</code> has not been doubled; <em>function
invocation</em> is the reason why. Even though the <code>helper</code> function is being
defined within a method of <code>myObject</code>, it gets executed in the global context.
As a result, <code>this</code> within <code>helper</code> references the global context (where the 
<code>value</code> property is meaningless).</p>
<p>The solution ends up being a strange construction like the following.
Functions don&#39;t retain a reference to their parent <code>this</code>, so we must manually
keep a reference, usually called <code>that</code>:</p>
<pre><code>myObject.double = function () {
  var that = this;

  var helper = function () {
    that.value = that.value * 2;
  };

  helper();
};

myObject.double();
console.log(myObject.value);  // --&gt; 102
</code></pre><p><strong>Constructor Invocation</strong>: when a function invocation is proceeded by the <code>new</code>
keyword, a new object is created and the function&#39;s <code>this</code> scope is bound to
that new object. This is strongly tied to prototypical inheritance, which is
covered in the notes on <strong>objects</strong>.</p>
<p><strong>Apply Invocation</strong>: because they&#39;re just objects, functions can have their own
methods as well (crazy, I know). One in particular that&#39;s useful is the <code>.apply</code>
method, which allows you to specify a <code>this</code> context and <code>arguments</code> list.</p>
<pre><code>var anotherObject = {
  value: -10
}

myObject.increment.apply(anotherObject, [5]);

console.log(anotherObject.value)  // --&gt; -5
</code></pre><p><em>Related</em>: <strong>Call Invocation</strong>: works almost the same as the <code>.apply</code> method, but
instead of using an array, you pass arguments directly:</p>
<pre><code>myObject.increment.call(anotherObject, 5);
</code></pre><h3 id="closures">Closures</h3>
<p>Because of the limited types of variable scoping available in JS, hiding private
variables might seem difficult at first. But as as is often the case in the
language, the incredible flexibility of functions comes to the rescue.</p>
<p>A <strong>closure</strong> in JavaScript is a function that, when invoked, is able to use
variables not available in the current scope -- they were stored in the closure
by the function that generated it. Here&#39;s a simple example.</p>
<pre><code>var genClosure = function () {
  var privateUser = {
    firstName: &#39;Adi&#39;
  , lastName: &#39;Dahiya&#39;
  };

  var printName = function () {
    console.log(privateUser.firstName + &#39; &#39; + privateUser.lastName);
  };

  return printName;
}

console.log(genClosure());    // --&gt; &#39;Adi Dahiya&#39;
</code></pre><p>Here, the global environment doesn&#39;t have access to the <code>privateUser</code> variable,
but the function returned from <code>genClosure</code> is still able to access it. You&#39;ll
see this immediately in any code intended for execution in Node: it will be
wrapped in an <strong>Immediately-Invoked Function Expression</strong> (IIFE).</p>
<h3 id="iife">IIFE</h3>
<p>We know by now that global variables in JavaScript are a <em>Bad Thing</em>. Luckily,
JS programmers have developed a pattern to mitigate this concern. An
immediately-invoked function expression is an anonymous function used at the top
level of a JS program to <em>provide a lexical scope for just that file / module</em>.
It looks like this:</p>
<pre><code>(function () {

  var Person = function () { ... };
  Person.prototype.getDescription = function () { ... };
  ...

  module.exports = {
    Person: Person,
    ...
  };

})();
</code></pre><p>What we&#39;ve done here is define an anonymous function and immediately invoked it
so that the contained code is run immediately when the file is loaded. The use
of a function makes any an all <code>var</code> declarations scoped to the anonymous
function, <em>not the global context</em>.</p>
<p>Note the exports exposed by this module at the end of the IIFE. <em>This is an
instance of a closure!</em>. When another file (or the Node interpreter) imports
this module, it can use any properties or functions from the <code>exports</code> object,
but it can&#39;t access the rest of the variables in the IIFE scope. Specifically,
this example uses <strong>AMD</strong> (asynchronous module definition) syntax, which is the
standard in Node.js.</p>

      </section>
      <section class="pure-u-3-4 notes style language-javascript"><h2 id="code-style">Code Style</h2>
<p>Code style is extremely important when developing code that you hope to last
longer than its first writing. This is especially important with JavaScript
because the interpreter is very tolerant and will allow a great deal of
syntactic mistakes to pass undetected when code is executed. JS developers must
exhibit great discipline in writing idiomatic code that is easily readable to
all other developers.</p>
<p>Because of this, we&#39;re going to be adhering to a style guide for code written in
this class. If you ever go out and write JavaScript professionally, you would do
well to adhere to a structured style guide as well.</p>
<p><strong>Indentation</strong>: use spaces, not tabs. 2 or 4 spaces.</p>
<p><strong>Line Length</strong>: avoid lines longer than 80 characters.</p>
<p><strong>Comments</strong>: be generous with comments, but try to describe more about <em>why</em>
a function exists and the assumptions it makes rather than <em>how</em> it does things.
JavaScript is an expressive enough language (with first class functions, etc.)
that you can write very readable code that expresses intent properly.</p>
<p><strong>Whitespace</strong>: most tokens should be separated by whitespace. Declare functions
like this:</p>
<pre><code>var parseInt = function (string, radix) {
  ...
};
</code></pre><p><code>if / else</code> blocks and <code>for</code> / <code>while</code> loops should always be split into lines,
as per the K&amp;R standard:</p>
<pre><code>if (predicate) {
  ...
} else {
  ...
}


for (var i = 0; i &lt; len; i++) {
  ...
}


while (condition) {

}
</code></pre><p><strong>Functions</strong></p>
<p>If you use an identifier with a function expression, it provides the added
benefit of showing up with a proper identifier in stack traces.</p>
<pre><code>var parseInt = function parseInt (string, radix) {
  ...
};
</code></pre><p>Alternatively, you can use a <em>function definition</em> syntax like the following
example, but keep in mind that scoping works slightly differently – this
function becomes available at the top of its scope while the above <em>function
expression</em> syntax means that a function is only available when its expression
is evaluated (and stored to that variable).</p>
<pre><code>function parseInt (string, radix) {
  ...
};
</code></pre><p><strong>Operators</strong></p>
<p>Avoid doing assignments in the conditional of <code>if</code> and <code>while</code> statements:</p>
<pre><code>if (a = b) {
</code></pre><p>...looks like a statement where intent can easily be misinterpreted as</p>
<pre><code>if (a === b) {
</code></pre><p><code>eval</code> is evil and misused. Don&#39;t use it in your programs. It has aliases, so
avoid those as well. Don&#39;t use the <code>Function</code> constructor or pass strings to
<code>setTimeout</code> / <code>setInterval</code>.</p>
<p>Similarly, <code>with</code> <a href="http://yuiblog.com/blog/2006/04/11/with-statement-considered-harmful/">should not be used</a>.</p>
<hr>
<p>Finally, you should be including an IIFE in all your JavaScript files (to
avoid polluting the global namespace), along with a <code>&#39;use strict&#39;</code> statement,
which invokes stricter interpretation of your JS source
(<a href="http://www.webdesignporto.com/why-use-strict-in-javascript-can-save-you-hours/">here&#39;s a more detailed explanation</a>).</p>
<pre><code>// file.js
(function () {
  &#39;use strict&#39;;

  // do stuff


  module.exports = {
    // export stuff
  };
})();
</code></pre><p><strong><em>For a very detailed style guide, refer to
<a href="https://github.com/rwaldron/idiomatic.js/">idiomatic.js</a>.</em></strong> (I generally
agree with most of the conventions used there).</p>

      </section>
      <section class="pure-u-3-4 notes objects language-javascript"><h1 id="javascript-objects-classes">JavaScript Objects &amp; Classes</h1>
<p>Reference: <strong><em>Eloquent JavaScript</em></strong> and <strong><em>JavaScript: The Good Parts</em></strong>.</p>
<hr>
<h3 id="prototypical-inheritance">Prototypical Inheritance</h3>
<p>All objects are linked to their <em>prototype</em>, an object from which they can
inherit properties. Those created as object literals are linked to
<code>Object.prototype</code> (built into the language).</p>
<p>When you attempt to retrieve an object property, JS will walk up the prototype
chain until it finds a matching property name (known as <em>delegation</em>).</p>
<p>Prototypes are <strong>dynamic</strong>: changing or adding a property on one will make it
immediately available to all objects that are linked to it.</p>
<ul>
<li>The Array methods you access when dealing with arrays (like <code>join</code>, <code>push</code>,
<code>pop</code>) are stored in the global <code>Array.prototype</code> rather than every instance
of an Array.</li>
<li><p>You can do some powerful things by updating a built-in prototype...</p>
<pre><code>var a = [ &#39;a&#39;, &#39;list&#39;, &#39;of&#39;, &#39;tokens&#39; ]
  , b = [ &#39;this&#39;, &#39;is&#39; ];

// Concatenates another array to the end of this one. Although this method
// is defined after a and b are initialized, they &quot;inherit&quot; the method.
Array.prototype.concat = function (other) {
  this.push.apply(this, other);
};

b.concat(a);
console.log(b.join(&#39; &#39;));     // --&gt; &#39;this is a list of tokens&#39;
</code></pre></li>
</ul>
<p>(<em>Note</em>: in hindsight, there&#39;s actually a built-in method called
  <code>Array.prototype.concat</code> already. So you wouldn&#39;t want to overwrite it like
  this.)</p>
<ul>
<li><p>And also some dangerous things! Let&#39;s say we wanted to swap the names of <code>pop</code>
and <code>shift</code>, which remove an element from the tail and head of an Array,
respectively:</p>
<pre><code>var old_pop = Array.prototype.pop;

Array.prototype.pop = Array.prototype.shift;
Array.prototype.shift = old_prop;
</code></pre><p>With this last bit of code, if you loaded anyone else&#39;s JS code (like the
jQuery library, etc.), any code that relies on <code>Array.prototype.pop</code> or
<code>Array.prototype.shift</code> wouldn&#39;t work properly. <strong>Lesson</strong>: be careful with
global prototypes.</p>
</li>
</ul>
<p><strong><em>Keep in mind</em></strong>: The delegation of properties sometimes creates problems
when you are only concerned with the immediate object in question (for
reflection or enumeration). In this case, it&#39;s helpful to use the
<code>hasOwnProperty</code> function available to all objects:</p>
<pre><code>for (prop in flight) {
  if (flight.hasOwnProperty(prop)) {
    console.log(prop + &quot;: &quot; + flight[prop]);
  }
}
</code></pre><p>There&#39;s actually another way to solve this problem by being more specific about
what type of property you are defining. The <code>Object.defineProperty</code> method lets
you set a property on an object and <em>configure</em> it with a few parameters,
including whether the property is enumerable, writable, etc. See
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">its documentation</a>.</p>
<pre><code>Object.defineProperty(flight, &#39;toString&#39;, {
  enumerable: false,
  value: function () { ... },
  writable: false
});
</code></pre><p><em>Note</em>: you are not guaranteed the order of properties with a <code>for in</code> loop on
objects. If you are really concerned with enumerating the properties in order,
it&#39;s best to list them out manually in an array:</p>
<pre><code>var categories = [
      &#39;cold&#39;
, &#39;hot&#39;
    , &#39;espresso&#39;
    ]
, coffeeProducts = {
      cold: [ &#39;iced&#39;, &#39;cold brew&#39; ]
, hot: [ &#39;pour over&#39;, &#39;french press&#39;, &#39;drip&#39; ]
    , espresso: [ &#39;americano&#39;, &#39;macchiato&#39;, &#39;shot&#39; ]
    };

for (var i = 0; l = categories.length; i &lt; l; i++) {
  var prop = categories[i];
  console.log(coffeeProducts[prop]);
}
</code></pre><h3 id="pseudo-classes">Pseudo-classes</h3>
<p>JavaScript is slightly conflicted about the nature of its inheritance, so its
constructor syntax makes it seem somewhat classical. You will see many objects
created with the <code>new</code> keyword:</p>
<pre><code>var a = new Array(16);

var americano = new Coffee({
  type: &#39;espresso&#39;
, variations: [ &#39;hot&#39;, &#39;iced&#39; ]
, preparation: &#39;Pull two espresso shots and pour them into a mug of water...&#39;
};
</code></pre><p>The <code>new</code> keyword essentially tells the runtime to <strong>invoke the <code>constructor</code>
method from a function&#39;s prototype</strong>.</p>
<p>Before we further inspect how constructors work, let&#39;s consider what happens in
the JS runtime when a function is created (they&#39;re objects too, after all).</p>
<p>When <strong>a function object is created</strong>, the internal <code>Function</code> constructor that
produces the function object runs some code like this:</p>
<pre><code>this.prototype = { constructor: this }
</code></pre><p>This behavior seems somewhat strange. Why do we need regular ol&#39; functions to
have constructors associated with them? Only those functions that actually
construct class-like objects should behave like this, right? Here we encounter
one of the flaws in the way JS does inheritance. <em>JavaScript doesn&#39;t
discriminate whether functions are meant to be constructors</em>. This means that
you as a programmer ought to demarcate constructors yourself through naming
conventions (capitalize the first letter of the function name).</p>
<p>When JS runs a line of code invoking the <code>new</code> keyword, some additional code
gets run after <code>this.prototype = { constructor: this }</code>. Note that <code>this</code>
represents the constructor function being invoked):</p>
<pre><code>var that = Object.create(this.prototype),
    other = this.apply(that, arguments);

if (typeof other === &#39;object&#39; &amp;&amp; other !== null) {
  return other;
} else {
  return that;
}
</code></pre><p>The method <code>Object.create</code> (see
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">documentation</a>)
simply creates a new empty object with its <code>prototype</code> set to a provided value.
Then the constructor function is applied to the new object with proper arguments
forwarded. If the constructor returned a value, that value is returned as the
newly constructed object. Otherwise, the new object from <code>Object.create</code> is
returned.</p>
<p>Knowing this, we can write some pseudoclassical code like this:</p>
<pre><code>var Person = function (first, last, email) {
  this.firstName = first;
  this.lastName = last;
  this.email = email;
};

Person.prototype.getName = function () {
  return this.firstName + &quot; &quot; + this.lastName;
};

Person.prototype.getEmail = function () {
  return this.email;
};
</code></pre><p>The <code>Person.prototype</code> object now looks something like a class definition:</p>
<pre><code>{
  constructor: function (first, last, email) { ... },
  getName: function () { ... },
  getEmail: function () { ... }
}
</code></pre><p>A <code>Person</code> object would behave like so:</p>
<pre><code>var adi = new Person(&#39;Adi&#39;, &#39;Dahiya&#39;, &#39;adahiya@seas.upenn.edu&#39;);
console.log(adi.getName());       // --&gt; &quot;Adi Dahiya&quot;
</code></pre><p>And let&#39;s say we wanted to inherit from this <code>Person</code> &quot;class&quot;:</p>
<pre><code>var Instructor = function (first, last, email, course) {
  this.firstName = first;
  this.lastName = last;
  this.email = email;
  this.course = course;
};

Instructor.prototype = new Person();

Instructor.prototype.getDescription = function () {
  var name = this.getName();
  return name + &quot; teaches &quot; + this.course;
};

var adi = new Instructor(&#39;Adi&#39;, &#39;Dahiya&#39;, &#39;adahiya@seas.upenn.edu&#39;, &#39;CIS 197&#39;);
console.log(adi.getDescription());  // --&gt; &quot;Adi Dahiya teaches CIS 197&quot;
</code></pre><p>A couple things to note:</p>
<ul>
<li>The <code>Instructor</code> constructor has to re-do the work of the <code>Person</code>
constructor. Can you think of a way we can reuse the logic in <code>Person()</code> with
some clever function application?</li>
<li>I didn&#39;t set <code>Instructor.prototype = Person.prototype</code>. This would
have allowed <code>Instructor</code> access to the <code>Person</code> methods, but it would have
also made it a two-way relationship, where any methods added to
<code>Instructor.prototype</code> are also available to all <code>Person</code> instances, which we
<em>don&#39;t</em> want. By instantiating a new <code>Person</code> object, we get the benefits of
its prototype while maintaining separation.</li>
</ul>
<hr>
<p>We seem to be getting somewhere now! This behavior looks kinda object-oriented,
doesn&#39;t it? But there are some wonky things going on.</p>
<ul>
<li>The inheritance and &quot;class&quot; definition syntax looks weird because of the use
of <code>prototype</code> everywhere.</li>
<li>All properties are public.</li>
<li>You can&#39;t access the <code>super</code> method.</li>
</ul>
<p>Also, as I indicated above, there is some danger in defining a constructor like
this. What would happen if you forgot the <code>new</code> keyword when trying to use
a constructor? (hint: how are functions regularly invoked?)</p>
<p>Again, this design flaw in JavaScript is mitigated by capitalizing the first
letter of constructor functions. The hope is that a programmer reading the code
can easily identify missing <code>new</code> keywords.</p>
<p>As for the flaws mentioned above:</p>
<ul>
<li>There are limited alternatives for object-oriented programming that do not use
the <code>prototype</code> syntax like this. Compile-to-JS languages (which we may cover
later in the course) provide some great syntactic sugar that abstracts away
this kind of low-level class definition.</li>
<li>Use closures in your JS modules to maintain private variables.</li>
<li>If you set up the classes right, you can use something like
<code>Person.prototype.getName(...)</code> to access &quot;super&quot; methods.</li>
</ul>
<h3 id="object-create">Object.create</h3>
<p>In ES5 (the current JS standard), there was a new method introduced called
<code>Object.create</code>, which provides some simple syntax for <strong>differential
inheritance</strong>. Its first argument is the prototype of the object you want to
inherit from (or <code>null</code>), and the second (optional) argument is map of
properties you want to set on the new object.</p>
<p>Another way to express the above <code>Instructor</code> class using <code>Object.create</code>:</p>
<pre><code>var Instructor = function (first, last, email, course) {
  Person.apply(this, arguments);
  this.course = course;
};

Instructor.prototype = Object.create(Person.prototype);

Instructor.prototype.getDescription = function () {
  var name = this.getName();
  return name + &quot; teaches &quot; + this.course;
};
</code></pre><p>This accomplishes the earlier goal of separating <code>Instructor</code> and <code>Person</code>&#39;s
prototype (there&#39;s a level of indirection since <code>Object.create</code> produces a new
object) while also invoking the <code>super</code> constructor.</p>
<p>Both this and the above method (in the section &quot;Pseudo-classes&quot;) for
object-oriented programming in JavaScript are acceptable. The <code>Object.create</code>
method slightly reduces the number of lookups on the prototype chain when
invoking &quot;class&quot; methods.</p>
<hr>
<p><strong>Here&#39;s a real world example</strong> of inheritance from the
<a href="https://github.com/cis197s14/website/blob/master/app/assets/javascripts/main.js">source code</a>
for the CIS 197 website. Note that the actual code in the repository is compiled
from Coffeescript, not hand-written (but you&#39;ll notice the compiler produces
very readable code!).</p>
<pre><code>/*
* Manages state of the section-navigation functionality in the sidebar.
*/
var SectionNav = (function () {

  SectionNav.ACTIVE_CLASS = &#39;active&#39;;   // why can we do this up here?

  function SectionNav (target) {
    this.selected = &#39;&#39;;
    this.target = target;
    this.sections = this.target.children(&#39;section&#39;);
    ...
  };

  SectionNav.prototype.navigateTo = function (sectionName) {
    this.sections.removeClass(SectionNav.ACTIVE_CLASS);
    this.target.children(&quot;.&quot; + sectionName).addClass(SectionNav.ACTIVE_CLASS);

    this.nav.children().removeClass(SectionNav.ACTIVE_CLASS);
    this.nav.find(&quot;.&quot; + sectionName).addClass(SectionNav.ACTIVE_CLASS);
    this.selected = sectionName;
  }

  ...

  return SectionNav;

})();
</code></pre>
      </section>
      <section class="pure-u-3-4 notes browsers language-javascript language-html"><h1 id="javascript-in-the-browser">JavaScript in the browser</h1>
<p>Reference: <strong><em>Eloquent JavaScript</em></strong> &amp; <strong><em>Mozilla Developer Network</em></strong>.</p>
<hr>
<blockquote>
<p>The browser is a really hostile programming environment.</p>
</blockquote>
<p>-- Douglas Crockford, <em>The JavaScript Programming Language</em> (video lecture)</p>
<p>The web browser is actually a great place that&#39;s experienced a huge deal of
development in the past few years (again, this is correlated with an influx of
front end dev tooling). But this quote does have a nugget of truth to it, as
you&#39;ll experience yourself in writing JS for the browser.</p>
<p>The reason that web APIs and browsers have been able to advance quickly is that
their development has been relatively decentralized. There is a standardizing
body, but there is no central authority developing browsers and implementing
language features. Various browser vendors (Google, Mozilla, Microsoft, etc.)
have implemented features at different rates and this has made cross-browser
support somewhat haphazard.</p>
<h2 id="what-is-a-browser-">What is a browser?</h2>
<p>A web browser has two main components that allow you to view and interact with
web pages:</p>
<ul>
<li><strong>JavaScript engine</strong>: loads &amp; interprets JavaScript source code in
a sandboxed runtime. Can also implement extensions to the language.</li>
<li><strong>Rendering engine</strong> (or layout engine, or simply browser engine): formats
information on the page after parsing HTML &amp; CSS.</li>
</ul>
<p>Here are the major <a href="http://en.wikipedia.org/wiki/JavaScript_engine">JS engines</a>
and <a href="http://en.wikipedia.org/wiki/Comparison_of_web_browser_engines">rendering engines</a>, 
respectively:</p>
<ul>
<li><strong>v8</strong> + <strong>Blink</strong> (Google Chrome)</li>
<li><strong>SpiderMonkey / Rhino</strong>  + <strong>Gecko</strong> (Mozilla Firefox)</li>
<li><strong>Nitro</strong> + <strong>WebKit</strong> (Apple Safari)</li>
<li><strong>Chakra</strong> + <strong>Trident</strong> (Internet Explorer)</li>
</ul>
<p>There are even sometimes differences in the core JavaScript runtime across
browsers. For example, IE&#39;s runtime is known to have a memory leak when
a circular reference is retained between a user-created object and a built-in
object (such as a DOM reference).</p>
<p>Most of the development in these engines has been concerning performance.
Mozilla, generally the leader in cutting-edge JS research, has released JS
engines fast enough to run
<a href="https://blog.mozilla.org/blog/2013/03/27/mozilla-is-unlocking-the-power-of-the-web-as-a-platform-for-gaming/">3D games like Quake at 60fps in the browser</a>.</p>
<h3 id="a-bit-of-syntax">A bit of syntax</h3>
<p>Before going further, let&#39;s recall what a basic HTML document looks like:</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;CIS 197 JavaScript&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to CIS 197&lt;/h1&gt;
    &lt;p&gt;
      This is a course about ...
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>In my examples, I&#39;ll usually eschew the <code>&lt;doctype&gt;</code>, <code>&lt;html&gt;</code>, <code>&lt;body&gt;</code>, etc.
tags and write a simplified version of the page.</p>
<h2 id="loading-javascript-in-the-browser">Loading JavaScript in the browser</h2>
<p>Well, we&#39;re not quite at the level of developing browser games right now. Let&#39;s
first understand how JS is loaded in the browser environment.</p>
<p>Web browser programs differ fundamentally from most other programs you are used
to writing in some key ways that have nothing to do with the JavaScript
language. First off, think about what you&#39;re actually doing when you download
JavaScript from the Internet to your web browser and executing it -- you&#39;re
trusting source code from a huge number of websites of varying degrees of
well-meaning to run on your computer. Sounds dangerous, doesn&#39;t it?</p>
<p>But we all get off just fine on the web, don&#39;t we? This is largely due to a neat
little concept called <strong><em>sandboxing</em></strong>. Browsers severely limit the scope of
capabilities that a JavaScript program can act on. It can&#39;t look at the files on
your computer, modify things outside of the web page it&#39;s embedded in, or
contact servers other than the one which served its web page.</p>
<hr>
<p>Just like in a Node.js runtime, JS is executed in a global context, except this
time it&#39;s called <code>window</code>. It represents the current session in your browser
tab, which is cleared with every page refresh. That means your browser requests
new JS files and starts up a new global context when you switch or reload pages.</p>
<p>There are a few ways to invoke JS in an HTML page:</p>
<ul>
<li><p>Inline <code>&lt;script&gt;</code> tag</p>
<pre><code>&lt;head&gt;
  &lt;title&gt;...&lt;/title&gt;
  &lt;script&gt;
    alert(&quot;foo&quot;);
  &lt;/script&gt;
&lt;/head&gt;
</code></pre></li>
<li><p>Linked <code>&lt;script&gt;</code> tag</p>
<pre><code>&lt;head&gt;
  &lt;title&gt;...&lt;/title&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;scripts/foo.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
</code></pre></li>
<li><p>Attached as an event handler to a DOM element</p>
<pre><code>&lt;button class=&quot;submit&quot; onclick=&quot;myApp.submitFormAsync();&quot;&gt;
  Submit
&lt;/button&gt;
</code></pre></li>
</ul>
<p>The first two methods result in the JS code being parsed &amp; run immediately as
the browser engine encounters it (while parsing the HTML document), while the
last (as indicated) runs some bit of JS code as an event callback.</p>
<p><em>Note</em>: It&#39;s good practice to load your <code>&lt;script&gt;</code> tags as late as possible in
the HTML. This way, your browser displays a (possibly functioning)
correctly-rendered HTML document with CSS before using precious CPU cycles on
parsing and interpreting JavaScript code. Also, avoid inline script tags in
favor of linked <code>.js</code> files. These files should be loaded at the end of
<code>&lt;body&gt;</code>:</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head ... &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to CIS 197&lt;/h1&gt;
    ...

    &lt;script type=&quot;text/javascript&quot; src=&quot;scripts/foo.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;scripts/bar.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>There&#39;s no convenient way to load multiple scripts at once like this; you&#39;ll
simply have to link all of them. But as we&#39;ll see later, various tools allow you
to package your application into a single script, which is usually also good
practice.</p>
<h2 id="document-object-model">Document Object Model</h2>
<p>Web pages structure is modeled using the Document Object Model, or DOM for
short. We know that HTML is a heirarchical markup language, so it makes sense
for our DOM to be a tree data structure.</p>
<p><img src="http://eloquentjavascript.net/1st_edition/img/html.png" alt="DOM tree"></p>
<p><em>Source</em>: Eloquent JavaScript</p>
<p>In the above diagram we can see the two main kinds of DOM nodes:
<em>regular nodes</em> and <em>text nodes</em>. Regular nodes are those with angle brackets in
HTML markup <code>&lt; &gt;</code> and text nodes are simply inline strings (for example, the
content of a <code>&lt;p&gt;</code> tag.</p>
<p>The root of an HTML document is available as a global variable in the browser JS
runtime called <code>document</code> -- this is the starting point for locating any other
node in the tree. There are a number of properties available on nodes; explore
them in a browser console and/or the
<a href="https://developer.mozilla.org/en-US/docs/DOM/DOM_Reference">MDN DOM Reference</a>.</p>
<pre><code>document.body;

var firstNode = document.body.firstChild;

if (firstNode.nodeType === 3) {
  // Text node
  console.log(&quot;First node contains text: &quot; + firstNode.nodeValue);
} else {
  // Regular node
  var n = firstNode.childNodes.length;
  console.log(&quot;First node has the tag &lt;&quot; + firstNode.nodeName + &quot;&gt; and
  &quot; + n + &quot; child nodes&quot;);
}
</code></pre><p>So far what we&#39;ve observed is an <em>application programming interface</em> for an HTML
document. Our web browser did the work to parse the DOM and model it for us. Can
we write a function that does the opposite (given a DOM node, print out its
HTML and the HTML of its children)?</p>
<pre><code>var isTextNode = function (node) {
      return node.nodeType === 3;
}
  , withBrackets = function (str, isClosing) {
      if (isClosing) {
        return &quot;&lt;&quot; + str.toLowerCase() + &quot;/&gt;&quot;;
      } else {
        return &quot;&lt;&quot; + str.toLowerCase() + &quot;&gt;&quot;;
      }
  };

var toHTML = function (node) {
  if (isTextNode(node)) {

    return node.nodeValue;        // TODO: escape HTML

  } else {

    var buffer = withBrackets(node.nodeName)
      , len = node.childNodes.length;

    if (len) {
      for (var i = 0; i &lt; len; i++) {
        buffer += toHTML(node.childNodes[i]);
      }

      buffer += withBrackets(node.nodeName, true);
    }

    return buffer;
  }
};

console.log(toHTML(document.body));
</code></pre><p>This is a neat little implementation, but it turns out there&#39;s a built-in
function with pretty similar (and more robust) functionality. The <code>outerHtml</code> 
property on DOM nodes returns a string of the HTML representation of a node
(itself included). <code>innerHtml</code> is the same, but it only looks at children of
the node.</p>
<pre><code>document.body.outerHtml;    // --&gt; &quot;&lt;body&gt;&lt;h1&gt;...&lt;/h1&gt;...&lt;/body&gt;&quot;
</code></pre>
      </section>
      <section class="pure-u-3-4 notes hw2 language-javascript"><h1 id="homework-2-xml-document-modeling">Homework 2: XML Document Modeling</h1>
<p>Due <em>Tuesday, September 23 at 9 AM</em>.</p>
<p>Implementation stub available in the <a href="https://github.com/cis197f14/hw/blob/master/hw2/xml-model.js">homework repository</a>.</p>
<h2 id="before-starting-this-assignment">Before starting this assignment</h2>
<p>Install the sax.js library by running <code>npm install sax</code> in the root of your
homework directory. Also, add the line &quot;node_modules&quot; to your <code>.gitignore</code> file
in this same folder (this prevents libraries from being committed to the git
repository).</p>
<p>See <a href="http://www.mulberrytech.com/papers/fromHTMLtoXML/slide012.html">this page</a>
to understand the relationship between XML and HTML.</p>
<h2 id="modeling-xml-documents">Modeling XML documents</h2>
<p>In this assignment you&#39;re going to develop an API for working with XML
documents. Similar to how web browsers parse an HTML document (which is very
similar to XML in structure anyway) and produce the <strong>Document Object Model</strong>
for us to work with in JavaScript, the tool you produce will be able to take an
XML document (as a string) as input and generate a JavaScript object that can
inspect and filter the document tree.</p>
<p>First off, we ought to decide on a data structure to keep track of the XML nodes
found during parsing. Since this is an exercise in object-oriented JS, we&#39;ll
model XMLElements and the overall XMLDocument as objects.</p>
<p><strong><em>TODO</em></strong>: Define a JavaScript class (using prototypes) called <code>XMLElement</code>
with the following properties and methods. The sample values show the expected
representation for an XML node like
<code>&lt;question seq=&quot;1&quot;&gt;Who framed Roger Rabbit?&lt;/question&gt;</code>.</p>
<pre><code>{
  // Is this a document node or an element in the tree?
  type: &#39;element&#39;,

  // Name of the XML node
  name: &#39;question&#39;,

  // Hash of the node attributes
  attributes: { seq: 1 },

  /*
   * Array of child nodes. Publicly provided in the API to allow for
   * iteration over child nodes.
   */
  children: [ ... ],

  /*
   * Returns a list of nodes in this subtree that match the given `nodeName`
   * by doing a recursive lookup.
   */
  find: function (nodeName) { },

  /*
   * Returns a list of nodes in this subtree that have matching attributes
   * as provided by an input hash of attrs (names &amp; value pairs).
   * If a particular attribute value is not provided (is undefined), this
   * method should match simply on attribute names (whether certain nodes
   * have that attribute at all).
   */
  findWithAttribute: function (attrs) { }
}
</code></pre><p>These are not the only properties and methods allowed in the class; feel free to
add more as necessary for your implementation. If you define properties or
methods that you intend to be private (not part of the XML document object
model), it&#39;s good practice to signify this with an underscore <code>_</code> prefixed to
the property / method name. For example, you might define a <code>_setAttributes</code>
function on <code>XMLElement</code>s that takes a hash and updates the stored attributes
for a node.</p>
<p>However, the XMLElement constructor <em>should</em> take in a single config object (hash) that specifies
its name and attributes. You should be able to call it like this:</p>
<pre><code>var elmnt = new XMLElement({
  name: &quot;My awesome node&quot;,
  attributes: {
    title: &quot;The Most Awesome Node&quot;,
    isAwesome: true
  }
});
</code></pre><p><strong><em>TODO</em></strong>: Define a class called <code>XMLText</code> that simply wraps a text string in
the XML tree. For example, the text inside <code>&lt;greeting&gt;Hello world!&lt;/greeting&gt;</code>
would be an <code>XMLText</code> object with the properties:</p>
<pre><code>{
  type: &#39;text&#39;,
  value: &#39;Hello world!&#39;
}
</code></pre><p>The constructor for your XMLText object should take in value, like so:</p>
<pre><code>var txt = new XMLText(&#39;My awesome text node&#39;);
</code></pre><p>Here&#39;s an example of what the children array in
<code>&lt;xml&gt;Hello, &lt;who name=&quot;world&quot;&gt;world&lt;/who&gt;!&lt;/xml&gt;</code> would look like:</p>
<pre><code>children: [
  { type: &#39;text&#39;, value: &#39;Hello&#39; },       // XMLText
  { type: &#39;element&#39;, name: &#39;who&#39;, ... },  // XMLElement
  { type: &#39;text&#39;, value: &#39;!&#39; }            // XMLText
]
</code></pre><p><strong><em>TODO</em></strong>: Define another class called <code>XMLDocument</code> that inherits from
<code>XMLELement</code>. Ensure it has these additional properties / methods:</p>
<pre><code>{
  // Is this a document node or an element in the tree?
  type: &#39;document&#39;

  /*
   * Creates an XMLElement from a hash of params (structured in the same way
   * as the XMLElement class definition above):
   *
   * params = { name: &#39;answer&#39;, attributes: { seq: 1 }, children: [...] }
   *
   * This element should be appended to the children of the document.
   */
  createElement: function (params) { },

  /*
   * Similar to `createElement`, this generates an XMLText node and adds it
   * to the document.
   */
  createTextNode: function (string) { }
}
</code></pre><h2 id="generating-the-model">Generating the model</h2>
<p>To actually do the string parsing of the XML Document, we&#39;re going to be using
a library called <code>sax</code>. While understanding how a parser works is interesting on
its own, I&#39;ll leave this topic for another course.</p>
<p>This parser reads in an XML document and provides callback hooks for events
that occur during parsing. If you&#39;re not familiar with callbacks -- they are
a method of asynchronous control flow that allows you to define a function to be
run when an event occurs. Some resources for more information about callbacks:</p>
<ul>
<li><a href="https://www.dropbox.com/s/6y4etm6u3ho8zym/Screenshot%202014-02-07%2021.34.58.png">JS, The Good Parts</a></li>
<li><a href="http://recurial.com/programming/understanding-callback-functions-in-javascript/">Understanding Callback Functions in JS</a></li>
</ul>
<p>Parser events we are interested in are the following:</p>
<ul>
<li><code>onerror</code>: an error occurred in parsing; you should probably throw it.</li>
<li><code>opentag</code>: parsed an opening tag for a node, like <code>&lt;question&gt;</code></li>
<li><code>onclosetag</code>: parsed a closing tag for a node, like <code>&lt;/question&gt;</code></li>
<li><code>ontext</code>: parsed some raw text within a node</li>
<li><code>onattribute</code>: parsed a (name, value) pair for a node attribute</li>
</ul>
<p>See the <a href="https://github.com/isaacs/sax-js">sax.js documentation</a> for further
reference. We don&#39;t care about CDATA for this assignment (even though it&#39;s in
the XML standard).</p>
<p>Your implementation should decide what to do when each of these events occurs.
In the end, a single <code>XMLDocument</code> should be produced that models the whole
tree. You should be able to interact with the document object by invoking its
tree filtering methods.</p>
<p>I have provided some implementation already in the <code>XMLDocumentBuilder</code> class
that starts off the parser. The tricky part is to now fill in the parser
callback hooks in a way that builds a proper tree model. While parsing, it
would behoove you to keep track (with a reference in the document builder class)
of the current <strong>context</strong> of the parser, or where it is in the tree. You won&#39;t
get this information in the parser callback; simply the relevant information
that was just parsed.</p>
<p>In the end, you should be able to call the XMLDocumentBuilder like so:</p>
<pre><code>var builder = new XMLDocumentBuilder(SAMPLE_XML, function (doc) {
  // This callback is invoked when the XML document model is fully built.

  console.log(doc);
});
</code></pre><h2 id="debugging">Debugging</h2>
<p>In the implementation stub, there are module exports set up for the <code>xml-model</code>
file. <strong>We will be using the provided 3 attributes (XMLElement, XMLDocument,
and XMLDocumentBuilder) to test your code, so you should <em>not</em> take them out. </strong>
However, you are welcome to add more exports for testing. For example, if you set
up a testing function called <code>testModel</code>, your exports at the bottom of the file
might look like:</p>
<pre><code>module.exports = {
  XMLElement: XMLElement,
  XMLDocument: XMLDocument,
  XMLDocumentBuilder: XMLDocumentBuilder,
  testModel: testModel
};
</code></pre><p>To run the file and load these exports into a node interpreter, use the
following commands (in the hw2 folder):</p>
<pre><code>bash-3.2$ node
node&gt; var xml = require(&#39;./xml-model&#39;);
node&gt; xml.testModel();
</code></pre><p>Also, if you&#39;re feeling adventurous, you could learn about the
<a href="http://nodejs.org/api/debugger.html">node debugger</a>
(related: <a href="https://github.com/node-inspector/node-inspector">node-inspector</a>).</p>

      </section>
      <section class="pure-u-3-4 notes dom-manipulation language-javascript"><h1 id="dom-manipulation">DOM Manipulation</h1>
<h2 id="dom-review">DOM review</h2>
<p>The <code>document</code> object gives us ways of accessing and changing the DOM of the
current web page.</p>
<p><strong>General strategy for DOM manipulation</strong>:</p>
<ol>
<li>Find a DOM node using an access method and store it into a variable.</li>
<li>Manipulate the DOM node by changing its attributes, styles, inner HTML, or
appending new nodes to it.</li>
</ol>
<p>Basic access methods: <code>getElementById</code>, <code>getElementsByTagName</code>
HTML5 access methods: <code>getElementsByClassName</code>, <code>querySelector</code></p>
<p><strong>Attributes</strong> are attached directly to the DOM element object; you can also use
a getter / setter.</p>
<pre><code>var img = document.getElementById(&#39;lolcat&#39;);

var oldSrc = img.getAttribute(&#39;src&#39;);
img.setAttribute(&#39;src&#39;, &#39;http://placekitten.com/100/500&#39;);

img.src = oldSrc;
</code></pre><p><strong>Styles</strong> are applied with the <code>style</code> object property on nodes:</p>
<pre><code>img.style.padding = &#39;10px&#39;;
</code></pre><p><strong>Changing content</strong> is possible with the <code>.innerHtml</code> property on nodes:</p>
<pre><code>var photoContainer = document.getElementById(&#39;#photo-container&#39;);

photoContainer.innerHtml = &quot;Here&#39;s the photo!&quot;;
</code></pre><p><strong>Creating nodes</strong> is possible with document methods:</p>
<pre><code>var photo = document.creatElement(&#39;img&#39;);
photo.src = &#39;http://placekitten.com/100/500&#39;;

photoContainer.appendChild(photo);
</code></pre><p>These are the basics of working with the DOM. The rest of the lecture will build
on these techniques and introduce <em>browser events</em>.</p>
<hr>
<h2 id="chrome-devtools">Chrome DevTools</h2>
<p>Before we move on, though, we need to upgrade our toolkit for front end
development. You all have a pretty powerful set of tools to inspect, debug, and
profile web pages built into your browsers already – today I&#39;ll demonstrate the
tools that ship in the Chrome browser (in-class demo).</p>
<p>All of this applies to Firefox, Safari, and IE as well (at least their modern
versions), as they have similar built-in dev tooling.</p>
<p>For a web tutorial, refer to Google&#39;s
<a href="https://developers.google.com/chrome-developer-tools/">DevTools docs</a>.</p>
<hr>
<p>So far in this course we&#39;ve been programming in vanilla JavaScript; that is, we
haven&#39;t really introduced any dependencies to our source code.</p>
<h2 id="what-is-jquery-">What is jQuery?</h2>
<p>It&#39;s a <a href="http://jquery.com/">JavaScript library</a>. The most widely-used one ever.
Here&#39;s why it&#39;s cool:</p>
<ul>
<li>Optimized, abstracted DOM manipulation</li>
<li>Intuitive API and method syntax</li>
<li>Expressive selector syntax (driven by CSS selectors)</li>
<li>Bearable syntax for web requests</li>
</ul>
<p><em>It&#39;ll make your life a whole lot easier</em>.</p>
<p>Let&#39;s look at a few of the things jQuery is useful for.</p>
<h3 id="selecting-elements">Selecting elements</h3>
<p>jQuery uses Sizzle, which is a CSS selector engine written in JavaScript.
That means that you can select DOM elements in your JS source the same way
you&#39;re selecting them to write CSS. Here are some examples:</p>
<pre><code>// ID
// ----------------------------------------------------------
var myEl  = document.getElementById(&#39;myEl&#39;)
  , $myEl = $(&#39;#myEl&#39;);

// Tag name
// ----------------------------------------------------------
var myTable   = document.getElementsByTagName(&#39;table&#39;)
  , $myTable  = $(&#39;table&#39;);

// Descendant of ID
// ----------------------------------------------------------
var lessons   = document.getElementById(&#39;content&#39;).getElementsByClassName(&#39;lesson&#39;)
  , $lessons  = $(&#39;#content lesson&#39;);

// Every other node
// ----------------------------------------------------------
var inputs = document.getElementsByTagName(&#39;input&#39;)
  , oddInputs = [];

for (var i = 1, l = inputs.length; i &lt; l; i += 2) {
  oddInputs.push(inputs[i]);
}

var $oddInputs = $(&#39;input:odd&#39;);
</code></pre><p>You can see here that jQuery allows much more expressive and elegant selection
functionality than that which is exposed by the DOM API. However, take caution
– the Sizzle selector API hides some underlying performance assumptions you can
make about your selection code. It&#39;s sort of a <em>leaky abstraction</em>, one
which requires you to be knowledgeable about the lower-level functionality in
order to write good, performant code.</p>
<p>If you take a look at how the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Writing_efficient_CSS#How_the_Style_System_Matches_Rules">style system matches rules</a>
and similarly, how <a href="http://www.sitecrafting.com/blog/sizzle-jquery-selector-pitfalls">Sizzle selectors are evaluated</a>,
you&#39;ll start to notice some pitfalls. Most of these apply to selectors in your
CSS as well.</p>
<p>The key to writing fast jQuery selectors is understanding which native functions
the library can leverage (most importantly, <code>document.getElementById</code>,
<code>document.getElementsByTagName</code>, and <code>element.getElementsByTagName</code>).
Without these, jQuery must rely on a large DOM traversal loop that checks a
large number of elements.</p>
<ul>
<li><p><strong>Don&#39;t qualify ID selectors</strong>. There&#39;s simply no advantage to doing this
other than readability purposes (and if your ID isn&#39;t specific enough to be
readable, consider revising that name).</p>
<pre><code>$(&#39;.content #lesson1&#39;);     // BAD
$(&#39;.lesson#lesson1&#39;);       // BAD

$(&#39;#lesson1&#39;);              // GOOD
</code></pre></li>
<li><p><strong>Be careful with raw pseudo selectors</strong>. While pseudo selectors are very
powerful, remember that they&#39;re not supported natively and if you don&#39;t limit
your DOM search, it can be a slow lookup.</p>
<pre><code>$(&#39;:input&#39;);                  // BAD
$(&#39;:radio.show-more&#39;);        // BAD

$(&#39;#myForm :input&#39;);          // OK
$(&#39;input:radio.show-more&#39;);   // OK

$(&#39;input, textarea, select&#39;); // GOOD (but verbose...)
</code></pre></li>
<li><p><strong>Class names are slow in IE</strong>. Keep in mind that all modern browsers except
IE have <code>document.getElementsByClassName</code> built in, so it will be a slower
lookup there. But then I suppose it&#39;s an issue of how much you care about your
IE users...</p>
</li>
</ul>
<p>To check the compatibility of DOM API methods like
<code>document.getElementsByClassName</code> and <code>document.querySelectorAll</code> (which tries
to consolidate selection in the same fashion as Sizzle), refer to the
compatibility table at the bottom of a Mozilla Developer Network DOM reference
page for that method.</p>
<p><strong>One more thing</strong>: keep in mind that when you select something with jQuery, it
gets wrapped into a <em>jQuery object instance</em> containing all* the library&#39;s
functionality. Think this has a greater runtime cost than using the DOM API? You
bet it does! So you&#39;ll want to avoid recurring selectors:</p>
<pre><code>$(&#39;#myDiv&#39;).fadeout(function () {
  $(&#39;#myDiv&#39;).css(&#39;color&#39;, &#39;red&#39;);
  $(&#39;#myDiv&#39;).fadein();
});
</code></pre><p>... is better written as ...</p>
<pre><code>var $elem = $(&#39;#elem_id&#39;);
$elem.fadeout(function () {
  $elem.css(&#39;color&#39;, &#39;red&#39;).fadein();
});
</code></pre><p>In this example you also see an example jQuery&#39;s chaining syntax, which makes
for a nice-to-use API.</p>
<p>* <em>Well, not exactly all the functionality -- there are some global methods
&amp; constructors exposed on the jQuery object itself, like <code>$.Deferred</code>, etc.</em></p>
<h3 id="manipulating-elements">Manipulating elements</h3>
<p>Once you have your target element selected, what can you do with it?
I won&#39;t go over all the methods available to jQuery object instances (see the
<a href="http://api.jquery.com/">docs</a> for that), but it suffices to say that you have
a lot of DOM manipulation power once you select an element with jQuery.</p>
<pre><code>var $myDiv = $(&#39;#myDiv&#39;)
  , $otherDiv = $(&#39;.other&#39;).clone();

$myDiv.addClass(&#39;active&#39;);

$myDiv.after(&#39;here comes another...&#39;);

$myDiv.append($otherDiv);

// Prepend numbers to the children of a node
$myDiv.children().forEach(function (child, i) {
  $(child).before(i + &#39;. &#39;);
});

// Query within a node subtree with CSS selector syntax
$myDiv.find(&#39;a&#39;).each(function (i, anchor) {
  // Keep in mind that in args  ^ index is first!

  $a = $(anchor);

  // Print contents, then clear them
  console.log($a.text());
  $a.empty();
});

var $inputs = $myDiv.find(&#39;input&#39;)
$inputs.attr(&#39;username&#39;);

if (!$myDiv.next()) {
  console.log(&#39;#myDiv is the last child of its parent&#39;);
}

$myDiv.fadeOut(500);
$myDiv.fadeIn(500);

// Remove from DOM
$myDiv.remove();
</code></pre><p>As we saw above, we can chain some of these methods:</p>
<pre><code>$myDiv.addClass(&#39;active&#39;).append($otherDiv);

$mydiv.find(&#39;inputs&#39;).attr(&#39;username&#39;);

$myDiv.fadeOut(500).fadeIn(500);
</code></pre><p>This is possible because many jQuery methods return <code>this</code>, a self-referential
pointer to the jQuery object instance being manipulated.</p>
<pre><code>$.fn.empty = function () {
  var elem, i = 0;

  for (; (elem = this[i]) != null; i++) {
    elem.innerHTML = &#39;&#39;;
  }

  return this;
};
</code></pre><hr>
<h2 id="-things-i-learned-from-the-jquery-source-">&quot;Things I Learned from the jQuery Source&quot;</h2>
<p><em>See the screencast <a href="http://www.paulirish.com/2010/10-things-i-learned-from-the-jquery-source/">here</a></em>.
<em>Browser the source <a href="http://www.keyframesandcode.com/resources/javascript/deconstructed/jquery/">here</a></em>.</p>
<p><strong>Undefined</strong></p>
<p>To ensure a valid <code>undefined</code> keyword, jQuery and other libraries do something
like this in their IIFE:</p>
<pre><code>(function (window, document, undefined) {
  ...
})(this, document);
</code></pre><p><strong>Animation</strong></p>
<p>For animations: <code>$.delay()</code> only works if there&#39;s an animation queue already
there, so this doesn&#39;t work:</p>
<pre><code>$(elem).delay(2000).fadeOut()
</code></pre><p>You can do one of the following instead:</p>
<pre><code>$(elem).fadeIn().delay(2000).fadeOut()

$(elem).queue(function () {
  this.delay(2000).fadeOut()
});
</code></pre><p><strong>Browser Support</strong></p>
<p><code>$.support</code> is the result of a bunch of tests on the current DOM to notify you
of browser bugs, unsupported things, etc. Also use <code>$.browser</code> similarly.</p>
<p><strong>Stylish things</strong></p>
<p>When you&#39;re trying to assign a variable, you can do sometimes elegantly affect
some state as well:</p>
<pre><code>var head = document.getElementsByTagName(&#39;head&#39;)[0];

var base = document.getElementsByTagName(&#39;base&#39;)[0] || (function () {
  return head.insertBefore(d.createElement(&#39;base&#39;), head.firstChild);
})();
</code></pre><p>Similarly, nested ternary operators let you be concise in assignment:</p>
<pre><code>if (data === &#39;true&#39;) {
  data = true;
} else if (data === &#39;false&#39;) {
  data = false;
} else if (data === &#39;null&#39;) {
  data = null;
} else if (!jQuery.isNaN(data)) {
  data = parseFloat(data);
}

// ^ above can be rewritten as:

data = data === &#39;true&#39; ? true :
  data === &#39;false&#39; ? false :
  data === &#39;null&#39; ? null :
  !jQuery.isNaN(data) ? parseFloat(data) :
  data;
</code></pre><p>One last thing...</p>
<pre><code>jQuery.fn === jQuery.prototype
</code></pre><p>You&#39;ll see jQuery functions and plugins being defined on <code>jQuery.fn</code> (and it
might show up in stack traces). It&#39;s just a prototype object (but it doesn&#39;t
correspond to the pseudo-classes we&#39;ve been talking about).</p>
<hr>
<p><a href="#browser-events">Browser events &rarr;</a></p>
<p><strong>References</strong>:</p>
<ul>
<li><em>Eloquent JS</em></li>
<li><em>10 Things I Learned from the jQuery Source</em> (Paul Irish)</li>
<li>Pamela Fox&#39;s <em><a href="http://www.teaching-materials.org/javascript/">JS Teaching Materials</a></em></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes browser-events language-javascript"><h1 id="browser-events">Browser Events</h1>
<p><a href="#dom-manipulation">&larr; DOM Manipulation</a></p>
<p>To build any application or web page that allows user interaction, you&#39;ll need
to work with browser events.</p>
<p>If you recall the <a href="#browsers">JS in browsers</a> notes, we saw an event handler
being attached to a &quot;click&quot; event on a DOM node:</p>
<pre><code>&lt;button class=&quot;submit&quot; onclick=&quot;myApp.submitFormAsync();&quot;&gt; Submit &lt;/button&gt;
</code></pre><p>&quot;onclick&quot; handlers like this are not advised (you should generally keep JS code
only in JS files), so here&#39;s the API for it in plain JS:</p>
<pre><code>domNode.addEventListener( eventType, eventListener, useCapture );
</code></pre><p>(the last argument indicates whether the event should bubble up in the DOM tree
as normal)</p>
<p>... so the above handler becomes:</p>
<pre><code>// assume myApp.submitFormAsync is a defined method

var button = document.getElementsByTagName(&#39;button&#39;);

button.addEventListener(&#39;click&#39;, function () {
  myApp.submitFormAsync();
});
</code></pre><p><strong><em>Events types</em></strong></p>
<p>Browsers can trigger many different events (see the full reference
<a href="https://developer.mozilla.org/en-US/docs/Web/Reference/Events">here</a>). Here are
some important ones:</p>
<ul>
<li><a href="https://developer.mozilla.org/en/DOM/MouseEvent">Mouse</a>:
<code>mousedown</code>, <code>mouseup</code>, <code>click</code>, <code>dblclick</code>, <code>mousemove</code>, <code>mouseover</code>,
<code>mousewheel</code>, <code>mouseout</code>, <code>contextmenu</code></li>
<li><a href="https://developer.mozilla.org/en/DOM/TouchEvent">Touch</a>:
<code>touchstart</code>, <code>touchmove</code>, <code>touchend</code>, <code>touchcancel</code></li>
<li><a href="https://developer.mozilla.org/en/DOM/KeyboardEvent">Keyboard</a>:
<code>keydown</code>, <code>keypress</code>, <code>keyup</code></li>
<li>Forms &amp; their elements: <code>focus</code>, <code>blur</code>, <code>change</code>, <code>submit</code></li>
<li>Window: <code>scroll</code>, <code>resize</code>, <code>hashchange</code>, <code>load</code>, <code>unload</code></li>
</ul>
<p><strong><em>Listeners</em></strong> are functions bound to events that get executed when a certain
event occurs (also known as event handlers). They are passed a properties object
relevant to and created by the event. For example, a <code>MouseEvent</code> reports mouse
coordinates:</p>
<pre><code>document.addEventListener(&#39;mousemove&#39;, function (e) {
  console.log(&#39;Moused to (&#39; + e.clientX + &#39;, &#39; + e.clientY + &#39;)&#39;);
});
</code></pre><p>Event targets are also often available to handlers with <code>event.target</code>; for
example, it&#39;s often useful to know which element on a page was clicked.</p>
<p><strong><em>Note</em></strong>: since browser JavaScript is single-threaded, no two event handlers
run at once. If an event occurs during the execution of a handler, it gets added
to an event queue to be handled after the main thread is freed up.</p>
<hr>
<h3 id="event-propagation">Event propagation</h3>
<p>Events bubble up the DOM tree in a phenomenon known as <strong>event propagation</strong>.
Let&#39;s take the example of a block of text in a <code>&lt;p&gt;</code> tag with links in it:</p>
<pre><code>&lt;body&gt;
  &lt;h1&gt;DOGECOIN&lt;/h1&gt;
  &lt;p&gt;
    dogecoin is an open source peer-to-peer cryptocurrency, favored by Shiba
    Inus worldwide.

    much newbie?
    &lt;a href=&quot;/get-started&quot;&gt;read the getting started guide&lt;/a&gt;, then
    &lt;a href=&quot;http://www.reddit.com/r/dogecoin&quot; target=&quot;_blank&quot;&gt;join the community at /r/dogecoin&lt;/a&gt;
  &lt;/p&gt;
&lt;/body&gt;
</code></pre><p>When you click on one of these links, the browser follows this chain of events:</p>
<ul>
<li>Check if there are event handlers attached to those <code>&lt;a&gt;</code> tags (could have
been attached to just the one clicked, the anchor links in the relevant
paragraph, or all anchor tags in the document)</li>
<li>Check if there are event handlers attached to the <code>&lt;p&gt;</code> tag</li>
<li>Bubble the event up to any <code>&lt;body&gt;</code> handlers</li>
<li>Finally execute the default <code>&lt;document&gt;</code> handler, which follows a link to
another web resource</li>
</ul>
<p>If you want to prevent this kind of propagation up the document tree, you can
use <code>event.stopPropagation</code>. <code>event.preventDefault</code> also exists to let you
specify when the built-in browser functionality for an event should be ignored.</p>
<h3 id="cross-browser-compatibility">Cross-browser compatibility</h3>
<p>If you want your website to work across all browsers, there are a number of
inconsistencies you&#39;re going to have to handle in your code. For example, IE8
and below use this alternative method for attaching a click handler:</p>
<pre><code>domNode.attachEvent(&#39;onclick&#39;, function () {
  // do stuff
});
</code></pre><p>... and it doesn&#39;t even support the third argument, <code>useCapture</code>.</p>
<p>We might try and be clever by creating a wrapper <code>registerEventHandler</code> function
like so:</p>
<pre><code>function registerEventHandler (elem, event, handler) {
  if (typeof elem.addEventListener === &#39;function&#39;) {

    // Regular browser
    elem.addEventListener(event, handler);

  } else {

    // IE
    elem.attachEvent(&#39;on + event, handler);

  }
}
</code></pre><p>Similarly, to detach events, you&#39;d need something like this:</p>
<pre><code>function unregisterEventHandler (elem, event, handler) {
  if (typeof elem.removeEventListener === &#39;function&#39;) {

    // Regular browser
    elem.removeEventListener(event, handler, false);

  } else {

    // IE
    elem.detachEvent(&#39;on&#39; + event, handler);

  }
}
</code></pre><p>And while normally the <code>event</code> object passed to a handler contains event
properties, IE8 and below attach these properties to a <strong>global event
variable</strong>, so you might see code like this:</p>
<pre><code>function onKeypress (event, handler) {
  event = event || window.event;

  // do stuff
}

registerEventHandler(document, &#39;keypress&#39;, onKeypress);
</code></pre><p>For a detailed run down of these kinds of cross-browser incompatibilities, see
<a href="http://eloquentjavascript.net/chapter13.html">Chapter 13</a> of <em>Eloquent JS</em>.</p>
<h3 id="jquery-events-to-the-rescue-">jQuery events to the rescue!</h3>
<p>Much in the same way that jQuery abstracts DOM manipulation for us, it can also
come to the rescue for dealing with events. Let&#39;s say we have a hover event
handler function like this:</p>
<pre><code>function onHover (e) {
  $(this).attr(&#39;hovered&#39;, true);
}
</code></pre><p>There are a few methods jQuery provides to bind handlers, including:</p>
<ul>
<li><p><code>bind</code>: the most straightforward, simply registers an event handler on each
selected element in the jQuery object. Has related convenience methods like
<code>click</code>, <code>hover</code>, etc.</p>
</li>
<li><p><code>live</code>: same as <code>bind</code>, but attaches the handler to the document, which allows
it to capture events for dynamically added elements that match the selector
(deprecated as of jQuery 1.7)</p>
</li>
<li><p><code>delegate</code>: a more nuanced version of <code>live</code> that lets you specify where to
attach the handler:</p>
<pre><code>$(&#39;#dropdown&#39;).delegate(&#39;option&#39;, &#39;hover&#39;, onHover);
</code></pre></li>
<li><p><code>on</code> is versatile and it allows you to emulate the above 3 methods; this is
the most recommended:</p>
<pre><code>$(&#39;#dropdown option&#39;).on(&#39;hover&#39;, onHover);

$(document).on(&#39;#dropdown option&#39;, &#39;hover&#39;, onHover);

$(&#39;#dropdown&#39;).on(&#39;option&#39;, &#39;hover&#39;, onHover);
</code></pre></li>
</ul>
<p><a href="http://www.elijahmanor.com/differences-between-jquery-bind-vs-live-vs-delegate-vs-on/">This article</a>,
although slightly outdated, does a great job of explaining the differences in
these approaches.</p>
<h3 id="document-ready-state">Document ready state</h3>
<p>After your browser successfully receives a web page response from an HTTP
request and parses its HTML, it has to do work to layout elements on
the page from the HTML markup. There&#39;s a delay (on the order of milliseconds)
between content appearing in your browser window and the DOM actually being
<strong>ready</strong>. (<em>Note</em>: keep in mind that script execution can occur either
before or after HTML layout, depending on where the <code>&lt;script&gt;</code> tag is in the
HTML markup).</p>
<p>Once a document is &quot;ready&quot;, you can reliably interact with it in a script.
<code>document.readyState</code> is set to <code>&#39;complete&#39;</code> when this event occurs. Most logic
in your JS applications should occur only after this event, so it&#39;s a common
pattern you&#39;ll encounter.</p>
<p>Typically, you can listen for the <code>&#39;DOMContentLoaded&#39;</code> event on the <code>document</code> and
run all your important DOM-interacting code within an event handler like this:</p>
<pre><code>function onDOMReady () {
  // do everything
}

document.addEventListener(&#39;DOMContentLoaded&#39;, onDOMReady);
</code></pre><p>Unfortunately, this event isn&#39;t fired in all versions of IE. The <code>&#39;load&#39;</code> event
on the <code>window</code> object is a pretty reliable callback:</p>
<pre><code>window.addEventListener(&#39;load&#39;, onDOMReady);
</code></pre><p>But this doesn&#39;t capture all of the state of <em>document ready</em>. Using jQuery is
usually your best bet for a reliable document ready state across all browsers as
it handles most of the compatibility edge cases you might encounter. There is
a convenient event binding method called <code>ready</code> on a jQuery selection of the
<code>document</code>:</p>
<pre><code>$(document).ready(onDOMReady);
</code></pre><p>A shorter syntax for this exists in modern jQuery. If you pass a function as the
first argument to the <code>$</code> function, that function gets executed on document
ready.</p>
<pre><code>$(onDOMReady);
</code></pre><p>In practice, an anonymous function is typically used (this is currently the
preferred syntax):</p>
<pre><code>$(function () {
  // do everything
});
</code></pre><p>If possible, you should keep your DOM-ready code small and organized, such that
application logic that doesn&#39;t deal specifically with the DOM exists outside of
this function. A typical file structure might look like this (recall the advice
about separation of pure functions from impure ones, and think about how it
relates here):</p>
<pre><code>// myScript.js
(function () {
  &#39;use strict&#39;;

  /*
   * File-scoped global variables &amp; imports
   */
  // var foo = {}, bar = &#39;baz&#39;, ...;


  // JS functions and classes that don&#39;t interact with the DOM


  // Document ready
  $(function () {

    // DOM interaction logic

  });


  // Exports, if any
  module.exports = {
    // ...
  };

})();
</code></pre><hr>
<p><strong>References</strong>:</p>
<ul>
<li><em>Eloquent JS</em></li>
<li><a href="http://youmightnotneedjquery.com/">You Might Not Need jQuery</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes hw3 language-javascript"><h1 id="homework-3-map-building">Homework 3: Map Building</h1>
<p>Due <em>Saturday, February 22 at 9 AM</em>.</p>
<p>Implementation stub available in the
<a href="https://github.com/cis197s14/hw/blob/master/hw3/">homework repository</a>.</p>
<h3 id="before-starting-this-assignment">Before starting this assignment</h3>
<p>Review notes about <a href="#dom-manipulation">DOM Manipulation</a> and
<a href="#browser-events">Browser Events</a>. If you are completely new to jQuery, you
might want to go through
<a href="http://learn.jquery.com/about-jquery/how-jquery-works/">this tutorial</a>
on the jQuery website.</p>
<h2 id="building-a-map-builder">Building a map builder</h2>
<p><img src="build/images/map-builder.png" alt="map-builder"></p>
<p>This project will introduce you some important jQuery concepts while helping you
design a map-building application. It will run entirely in the browser; you&#39;re
going to submit the whole client-side application with HTML, CSS, and JS. It&#39;s
inspired a lot by Pokémon maps. Here&#39;s a general outline of the functionality:</p>
<ol>
<li>Pick a swatch from the palette</li>
<li>Hover over the map canvas to see swatch in context</li>
<li>Click on the canvas to paint it with a selected swatch</li>
</ol>
<p>To begin, take a look at the provided HTML and CSS files that lay out the map
building interface. There are a few files linked to the <code>index.html</code> web page -
styles in <code>main.css</code>, the jQuery library in <code>lib/js/jquery-1.11.0.js</code>, and the
script that you will produce in this assignment, <code>map-builder.js</code>.</p>
<p><strong><em>TODO</em></strong>: Go ahead and create this file with the familiar IIFE skeleton:</p>
<pre><code>// map-builder.js
(function () {

})();
</code></pre><p>There are two main sections of concern in <code>index.html</code>: the
swatches palette at the top and the map canvas below it. The map swatches are
already populated for you and have associated tile images (they show up as
background images applied through CSS). A palette swatch looks like this:</p>
<pre><code>&lt;li class=&quot;swatch water-se&quot;&gt;&lt;/li&gt;
</code></pre><p><code>water-se</code> is the swatch name; <strong>this will be the same class name applied to map
tiles to build up the map</strong>.</p>
<p><strong><em>TODO</em></strong>: Start off by creating a JavaScript class called <code>MapBuilder</code> to
encapsulate the map builder logic (this will make it easy to convert to a JS
plugin later on). Its constructor should be accept two arguments:</p>
<ol>
<li><p>A jQuery element that represents the map-builder container. It should contain
a <code>.palette</code> element and <code>.map</code> element within it. In the provided HTML page,
you can immediately see that this corresponds to the <code>&lt;div id=&quot;map-builder&quot;&gt;</code>
container in the document body. The constructor should save this provided
<code>$elem</code> (note the prepended <code>$</code> on jQuery variable names) as a property in
the <code>MapBuilder</code> instance.</p>
</li>
<li><p>An optional params object with <code>width</code> and <code>height</code> properties indicating how
large the map should be in tile dimensions. When this argument isn&#39;t
provided, the <code>MapBuilder</code> should resort to some reasonable stored defaults.</p>
</li>
</ol>
<p><em>Note</em>: For this project, it is likely that all the work done by <code>MapBuilder</code>
will occur in its constructor (not through any instance methods after
construction). Again, we&#39;re using the pseudo-class more as a method of
organization and encapsulation rather than for more &quot;traditional&quot;
object-oriented purposes.</p>
<p><strong><em>TODO</em></strong>: Create an anonymous function at the bottom of <code>map-builder.js</code> and
bind it to document ready invocation using jQuery&#39;s convenient syntax as
illustrated at the bottom of the <a href="#browser-events">browser events notes</a>.
Invoke the <code>MapBuilder</code> constructor in this function appropriately so that it
runs after DOM-load.</p>
<hr>
<h2 id="selecting-swatches">Selecting swatches</h2>
<p><img src="build/images/gifs/select-swatches.gif" alt="select-swatches"></p>
<p>The first task will be to have <code>MapBuilder</code> keep track of which swatch is
currently selected in the palette. Visually (in CSS), we&#39;ll represent this with
the <code>&#39;selected&#39;</code> class on swatches. If the &#39;grass&#39; swatch is selected, its
palette element looks like this:</p>
<pre><code>&lt;li class=&quot;selected swatch grass&quot;&gt;&lt;/li&gt;
</code></pre><p><strong><em>TODO</em></strong>: Write a function on the <code>MapBuilder</code> prototype called
<code>_setupPalette</code> that gets invoked in the builder constructor. This setup
function should bind a <code>click</code> handler to palette swatches that</p>
<ol>
<li>Ensures only one swatch is ever &#39;selected&#39; (check out jQuery&#39;s <code>.removeClass</code>
and <code>.addClass</code> methods)</li>
<li><p>Stores the currently selected swatch name in the <code>MapBuilder</code> instance.
You&#39;ll probably want a helper function to extract the swatch name from a DOM
element. It will be helpful to get access to the raw DOM element <code>classList</code>.
For example:</p>
<pre><code> $grassSwatch = $(&#39;.swatch.grass&#39;);  // jQuery element

 grassSwatch = $grassSwatch.get(0);  // DOM element

 grassSwatch.classList;      // DOM NodeList, which works like an array
</code></pre></li>
</ol>
<p><strong>Debugging</strong>: Try logging the swatch name to the console every time the
selected swatch changes. You ought to be able to click a bunch of swatches and
see this value update to values like <code>&#39;water-se&#39;</code>, <code>&#39;fence-nw&#39;</code>, <code>&#39;cave&#39;</code>, etc.</p>
<hr>
<h2 id="drawing-the-map-canvas">Drawing the map canvas</h2>
<p><strong><em>TODO</em></strong>: Next, write another similar setup function for the map canvas. It
should generate <code>&lt;div&gt;</code>s for the map tiles according to the provided map size
dimensions and insert them into the DOM inside the <code>.map</code> element. A 2 x 2 map
would look like this on the page:</p>
<pre><code>&lt;div class=&quot;map&quot;&gt;
  &lt;h3&gt;Map Canvas&lt;/h3&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;tile swatch grass&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;tile swatch grass&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;tile swatch grass&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;tile swatch grass&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre><p>If you use the same class names as listed here, the styles provided with the
assignment should work right off the bat. Otherwise, you&#39;ll have to go in and
make some CSS edits.</p>
<p>In jQuery, it&#39;s possible to <strong>generate</strong> a DOM element by passing an HTML tag
string to <code>$</code>, like this:</p>
<pre><code>var $newDiv = $(&#39;&lt;div&gt;&#39;);

// We can invoke jQuery methods on this new div
$newDiv.addClass(&#39;swatch&#39;);
</code></pre><p>Until you write <code>$newDiv</code> into the <code>document</code>, however, it only exists in your
script. Take a look at jQuery&#39;s <code>.append</code> method (and related ones) to
write elements into the page DOM.</p>
<p><em>Note</em>: this layout could have been implemented with a <code>&lt;table&gt;</code> (it is, after
all, simply a grid), but using <code>&lt;div&gt;</code>s allows us to write simpler CSS.</p>
<hr>
<h2 id="previewing-swatches">Previewing swatches</h2>
<p><img src="build/images/gifs/preview-swatches.gif" alt="preview-swatches"></p>
<p>While building our Pokémon level map, it would be nice to preview what a map
tile would look like in position on the canvas. There are a few ways you can
make this work with classes, some of which don&#39;t require edits to the provided
CSS file. A map tile simply looks like:</p>
<pre><code>&lt;div class=&quot;tile swatch grass&quot;&gt;&lt;/div&gt;
</code></pre><p>So if you swap out <code>&#39;grass&#39;</code> for another swatch name, it takes on that swatch&#39;s
appearance.</p>
<p><strong><em>TODO</em></strong>: On construction, <code>MapBuilder</code> should bind event handlers to the
newly generated tiles. In particular, we are interested in the <code>mouseenter</code> and
<code>mouseout</code> events on each tile <code>&lt;div&gt;</code>. When the mouse hovers over a tile, it
should take the appearance of <code>MapBuilder</code>&#39;s selected swatch.</p>
<ul>
<li><p><code>mouseenter</code>: edit the tile&#39;s CSS classes so that it appears to look like the
selected swatch</p>
</li>
<li><p><code>mouseout</code>: restore the tile&#39;s original &quot;painted-on&quot; swatch appearance with
CSS classes</p>
</li>
</ul>
<p>Remember that jQuery event handlers have this general form:</p>
<pre><code>function onMouseEnter (e) {
  // An event handler&#39;s context gets bound to its target element on the
  // page. Here, we create a jQuery object handle for the element.
  var $this = $(this);

  // do stuff
}

$myDiv.on(&#39;mouseenter&#39;, onMouseEnter);
</code></pre><p><em>Hint</em>: If you need to store information on a DOM element, it&#39;s common to use
a <code>data-</code> attribute. You can give this any name; it looks something like this:</p>
<pre><code>&lt;li class=&quot;swatch grass&quot; data-seq=&quot;1&quot;&gt;&lt;/li&gt;
</code></pre><p>You can then access these attributes in jQuery:</p>
<pre><code>var $grass = $(&#39;.swatch.grass&#39;);

$grass.data(&#39;seq&#39;);       // --&gt; &#39;1&#39;
$grass.data(&#39;seq&#39;, 2);    // updates the &#39;data-seq&#39; attr
</code></pre><hr>
<h2 id="painting-swatches">Painting swatches</h2>
<p>Now the fun part! To allow a user to &quot;paint&quot; a swatch (make it stay in place on
the map canvas), we&#39;ll make them click on a tile. That tile should then take the
appearance of the selected swatch.</p>
<p><img src="build/images/gifs/paint-swatches.gif" alt="paint-swatches"></p>
<p><strong><em>TODO</em></strong>: On construction, <code>MapBuilder</code> should bind a <code>mousedown</code> event
handler to the map tiles. This handler will be similar to <code>mouseenter</code>, but
you&#39;ll have to do something special to ensure that the swatch appearance doesn&#39;t
revert when the mouse leaves the tile.</p>
<p><strong><em>TODO</em></strong>: In addition, you should implement tile painting by dragging. This
can all be done with just the <code>mousedown</code> and <code>mouseenter</code> events. Think about
what should happen to a tile when the mouse enters it AND the mouse button is
already clicked.</p>
<p><em>Hint</em>: You can access the pressed key or mouse button in an event handler
through the event object:</p>
<pre><code>var LEFT_MOUSE_BUTTON = 1;

$grass.on(&#39;mousedown&#39;, function (e) {
  e.which === LEFT_MOUSE_BUTTON;      // --&gt; true
});
</code></pre><hr>
<h3 id="make-cool-maps">Make cool maps</h3>
<p>If you build any cool Pokémon maps once you&#39;re finished with the assignment,
please share them! Post a screenshot to our Piazza forum.</p>
<h3 id="a-playable-character-optional-">A playable character (optional)</h3>
<p>If you&#39;re feeling adventurous like Ash Ketchum, you can go on to implement
a playable character within this map once it&#39;s built. There are image assets
available for you to leverage for this task in the folders
<code>hw3/lib/img/tilesets</code> and <code>hw3/lib/images/sprites</code> (image tiles for Pikachu,
Ash, etc).</p>
<p>Implement a separate class called <code>Player</code> (like we did in class) that generates
a player on the map when a &#39;Play&#39; button is clicked on the page. This player can
move around with the arrow keys. They should be able to move over terrain but
not through obstructions (look at the images folder or <code>main.css</code> to see which
tiles are terrain and which are obstructions).</p>
<hr>
<h2 id="debugging">Debugging</h2>
<p>Check out the Chrome DevTools docs / tutorials on
<a href="https://developers.google.com/chrome-developer-tools/docs/javascript-debugging">JavaScript debugging</a>.</p>

      </section>
      <section class="pure-u-3-4 notes functional language-javascript"><h1 id="functional-programming-in-javascript">Functional Programming in JavaScript</h1>
<p>As engineers and problem solvers, we often try to reduce the complexity of our
problems and solutions. This is especially important in programming, where we
are presented with a dichotomy of two seemingly incongruous systems: a very
low-level computer and a high-level thinking human. Computer scientists use
<strong>abstractions</strong> to keep the problem space at hand small.</p>
<p>When presenting a solution to a problem (essentially what a piece of code
<em>does</em>), it is helpful to assume prior knowledge about all low-level details
around the problem. Similarly, when I tell you a food recipe, I hope I don&#39;t
have to explain to you how to boil water or dice onions -- rather, I&#39;d like to
tell you <strong>how abstract, agreed-upon elements fit and work together</strong> to
accomplish the task of preparing a certain meal.</p>
<p>One approach to abstraction we&#39;ve already looked at is object-oriented
programming. This lecture will instead focus on <strong>functional programming</strong> (FP),
a method of abstraction through clever uses of functions &amp; their composition. As
I&#39;ve been hinting at, JavaScript is a prime candidate for functional programming
(mainly due to first-class function objects).</p>
<p>The simplest motivating example that applies here is the all-too-tired <code>for</code>
loop. We&#39;ve written this kind of code often:</p>
<pre><code>for (var i = 0, l = arr.length; i &lt; l; i++) {
  // do stuff to arr[i]
}
</code></pre><p>You probably already have ideas for how <code>do stuff to arr[i]</code> here can be
abstracted. Functions, are, after all, quite useful for &quot;doing stuff&quot;:</p>
<pre><code>function forEach (array, fn) {
  for (var i = 0, l = array.length; i &lt; l; i++) {
    fn(arr[i], i);
  }
}
</code></pre><p>Here, we&#39;ve abstracted the low-level details of a <code>for</code> loop into <code>forEach</code>,
which better expresses our <em>intent</em> with the code. What if we wanted to take
this further to other functions that iterate over arrays?</p>
<pre><code>function parseIntArray (array) {
  var newArr = [];

  forEach(array, function (el) {
    newArr.push(parseInt(el, 10));
  });

  return newArr;
}

function getClasses (elements) {
  var classes = [];

  forEach(elements, function (el) {
    classes.concat(el.classList);
  });

  return classes;
}
</code></pre><p>You start to get the idea. We can create another useful abstraction here --
notice how the above functions both take an array of elements and return
a &quot;transformed&quot; array.</p>
<pre><code>var map = function (array, fn) {
  var newArr;

  // Recall that we were nice enough to provide the index to this iterator
  forEach(array, function (el, i) {
    newArr.push(fn(el, i));
  });

  return newArr;
}

var parseIntBaseTen = function  (str) { return parseInt(str, 10) };

var parseIntArray = function (array) {
  map(array, parseIntBaseTen);
};
</code></pre><p><code>map</code> is the first important higher-order function in FP. But we may want to do
more things with arrays than just transform them into other arrays. Consider:</p>
<pre><code>var sum = function (array) {
  var total = 0;

  forEach(array, function (el) {
    total += el;
  });

  return total;
};

var find = function (elements, tag) {
  var filtered = [];

  forEach(elements, function (el) {
    if (el.name === tag) {
      filtered.push(el);
    }
  });

  return filtered;
}
</code></pre><p><code>sum</code> and <code>find</code> might not seem immediately similar, but we can in fact abstract
such logic into a higher-order function called <code>fold</code> (or <code>reduce</code>), which
builds up a single value from an array of values:</p>
<pre><code>var foldl = function (arr, fn, base) {
  forEach(arr, function (el, i) {
    base = fn(base, el, i);
  });

  return base;
};

var sum = function (arr) {
  function mkTotal (base, el) {
    base += el;
  }

  return foldl(arr, mkTotal, 0);
}
</code></pre><p><code>base</code> here is the initial value of the fold as well as the final built-up
value. Can you trace the execution of <code>sum</code> here as implemented with a fold?</p>
<p><strong><em>Prompt</em></strong>: try implementing <code>filter</code> with a fold. It takes two arguments: an
<code>array</code> to filter and a <code>predicate</code> function that tests an array element for
inclusion in the output.</p>
<hr>
<p>In creating <code>parseIntArray</code> above, we almost touched on a couple more important
bits of FP: composition and partial application. Function composition works as
you&#39;re familiar with it from mathematics.</p>
<pre><code>var addTen = function (i) { return i + 10; },
    double = function (i) { return i * 2; };

var comp = function (f, g) {
  return (function (input) {
    return f(g(input));
  });
};

// Note the order of operations.
var doubleThenAddTen = comp(addTen, double);
</code></pre><p>We had to make a function to accomplish the composition. Other more functional
languages have convenient syntax for this (like <code>$</code> in Haskell), but we&#39;ll have
to make do with our functions in JavaScript.</p>
<p>Let&#39;s go back to the <code>parseIntArray</code> example. You can also accomplish partial
application in a similar manner:</p>
<pre><code>// Syntactic sugar for the most common use of `parseInt`
var parseIntBaseTen = function (i) { parseInt(i, 10); };

// Partially apply `map` by returning an anonymous function
var mapWithFunction = function (fn) {
  return (function (arr) {
    return map(arr, fn);
  });
};

var parseIntArray = mapWithFunction(parseIntBaseTen);
</code></pre><p>These are some examples of the powerful nature of first-class function objects.
The variables defined in the above block are all functions -- hopefully this
helps you understand why some might prefer the <code>var fn = function ...</code> syntax to
some extent.</p>
<hr>
<h2 id="underscore-js">Underscore.js</h2>
<p>Working with functions and throwing them around in this way is fun, but soon
we&#39;d end up implementing a lot of higher-order functions and wonder if only
there was someone out there who had the sense to build a library with all the
useful ones in it...</p>
<p>Lucky you! Some crafty JS developers at
<a href="http://www.documentcloud.org/">DocumentCloud</a>
(mainly, <a href="https://github.com/jashkenas">Jeremy Ashkenas</a>) have built just that
library.</p>
<p><a href="http://underscorejs.org/">Underscore</a> is broadly defined as
<strong><em>the JavaScript utility belt</em></strong>.
Or, what should have been built into the standard library. On the library&#39;s home
page, they describe it as the answer to the question:</p>
<blockquote>
<p>If I sit down in front of a blank HTML page, and want to start being
productive immediately, what do I need?</p>
</blockquote>
<p>There are four essential parts to this library. I&#39;ve listed some of the
important functions from each section:</p>
<h4 id="collections">Collections</h4>
<p><em>Note</em>: &quot;Collections&quot; functions work on <strong>both</strong> Arrays and Objects.</p>
<ul>
<li><code>each</code></li>
<li><code>map</code></li>
<li><code>reduce</code></li>
<li><code>find</code></li>
<li><code>filter</code></li>
<li><code>reject</code></li>
<li><code>pluck</code></li>
<li><code>sortBy</code></li>
</ul>
<h4 id="arrays">Arrays</h4>
<ul>
<li><code>first</code></li>
<li><code>last</code></li>
<li><code>flatten</code></li>
<li><code>union</code></li>
<li><code>intersection</code></li>
<li><code>difference</code></li>
<li><code>uniq</code></li>
<li><code>zip</code></li>
</ul>
<h4 id="functions">Functions</h4>
<ul>
<li><code>bind</code></li>
<li><code>partial</code></li>
<li><code>memoize</code></li>
<li><code>debounce</code></li>
<li><code>compose</code></li>
</ul>
<h4 id="objects">Objects</h4>
<ul>
<li><code>keys</code></li>
<li><code>values</code></li>
<li><code>pairs</code></li>
<li><code>extend</code></li>
<li><code>pick</code></li>
<li><code>omit</code></li>
<li><code>clone</code></li>
<li><code>has</code></li>
</ul>
<hr>
<h3 id="using-underscore">Using Underscore</h3>
<p>If we&#39;re really trying to be functional, we&#39;ll compose most of our logic as a
series of operations done on a piece of data. Imperative programming broadly
does this through a sequence of statements, but we want to do it with functions
because hey, this is a lecture on functional programming! There are two ways to
do this sequential composition in Underscore.</p>
<p>In a manner similar to jQuery object instances, Underscore provides
functionality for turning arrays and objects (generically, &quot;collections&quot;) into
<em>wrapped</em> objects. Here&#39;s the difference:</p>
<pre><code>function double (n) { return n * 2; }

_.map([1, 2, 3], double);   // Array

_([1, 2, 3]).map(double);   // wrapped collection
</code></pre><p>Wrapped collections have the benefit that <strong>you can chain methods on them</strong>.
Notice the difference in the two styles of composition:</p>
<pre><code>var stooges = [
  { name: &#39;curly&#39;,  age: 25 },
  { name: &#39;moe&#39;,    age: 21 },
  { name: &#39;larry&#39;,  age: 23 }
];

var getAge = function (stooge) { return stooge.age; };
var rejectShortNames = function (stooge) { return stooge.name.length &gt; 3; };

var youngest = _.first(_.sortBy(_.filter(stooges, rejectShortNames), getAge));

youngest = _.chain(stooges)
            .filter(rejectShortNames)
            .sortBy(getAge)
            .first()
            .value();
</code></pre><p>The first expression to generate <code>youngest</code> looks kind of ugly, while the second
uses the nicer-looking chaining syntax.</p>
<p>Note that in the second case I had to explicitly call <code>chain</code> to turn <code>stooges</code>
into a wrapped object for chaining. This is required when some methods in your
function chain do not return wrapped objects, like <code>filter</code> and <code>sort</code>; <code>chain</code>
ensures that a wrapped object is returned on every call (it even delegates
built-in <code>Array.prototype</code> methods). To get back an <code>Array</code> or <code>Object</code> from
a wrapped collection, you must call <code>.value()</code> on it.</p>
<hr>
<p>Many of these are abstractions over varying JavaScript implementations, in the
same way that jQuery abstracts over differing DOM API implementations. So, in
the spirit of abstraction, readability, and robustness, I generally recommend
it on all projects.</p>
<p>(<em>Time permitting</em>) Let&#39;s explore
<a href="http://underscorejs.org/docs/underscore.html">the source</a>!</p>
<h3 id="fp-libraries">FP libraries</h3>
<p>While Underscore is quite a popular library, there are a few libraries that
facilitate functional programming JavaScript by providing features borrowed from
more pure functional languages.</p>
<ul>
<li><a href="http://lodash.com/">Lodash</a>, a drop-in replacement for Underscore</li>
<li><a href="http://osteele.com/sources/javascript/functional/">Functional</a></li>
<li><a href="https://github.com/raganwald/allong.es">allong.es</a></li>
<li><a href="https://github.com/raganwald/JQuery-Combinators">jQuery Combinators</a></li>
<li><a href="https://github.com/puffnfresh/bilby.js">bilby.js</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes mvc language-javascript"><h1 id="model-view-controller">Model-View-Controller</h1>
<h3 id="definition">Definition</h3>
<p>MVC is an architectural design pattern in software that tries to organize
application logic by applying separation of concerns. As the name suggests,
there are three types of components:</p>
<ol>
<li><strong>Models</strong> contain business data &amp; logic.</li>
<li><strong>Views</strong> contain interface logic &amp; representation.</li>
<li><strong>Controllers</strong> capture input &amp; interactions and coordinate between <strong>Views</strong>
&amp; <strong>Models</strong>.</li>
</ol>
<p>Again, the key here is a <strong>separation of concerns</strong>. Models shouldn&#39;t have to
know anything about what Views do and vice versa.</p>
<h2 id="mvc-in-web-servers">MVC in web servers</h2>
<p>When building a web server, your method of interaction with the user is through
HTTP requests. Requests are stateless, so there is a new context created between
the browser and server on every interaction. This is quite different from the
initial MVC frameworks developed for operating systems (where it was originally
defined by the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four</a>), so
it&#39;s worthwhile to study how MVC is applied to web servers before proceeding.</p>
<p>Ruby on Rails is an MVC framework for programming web servers.</p>
<p><img src="http://addyosmani.github.io/backbone-fundamentals/img/webmvcflow_bacic.png" alt="server mvc"></p>
<p><em>Source</em>: Backbone Fundamentals</p>
<ul>
<li><strong>Models</strong> represent the application&#39;s data as well as rules for transforming
&amp; storing it. A model is responsible for talking to the application&#39;s
database; you will generally have one DB table for each model.</li>
<li><strong>Views</strong> represent the interface to a web browser, often in the form of HTML
pages (but sometimes JSON, etc.). These are generally useless without
application data supplied by models.</li>
<li><strong>Controllers</strong> glue together models and views by processing (routing) web
requests, asking models for data, and populating views to construct responses
for the web browser.</li>
</ul>
<p>There is usually an additional component, a <strong>router</strong>, which analyzes a web
request and determines which <strong>controller</strong> to employ and which <strong>action</strong> to
invoke on it (hence, <code>ActionController</code> in Rails). For example consider these
web application URLs:</p>
<ul>
<li><code>/users/afl23jniovxc34/edit</code>: users controller grabs user, invokes edit action</li>
<li><code>/users/new</code>: users controller invokes new action</li>
<li><code>/pages/542</code>: pages controller grabs page, invokes show action</li>
</ul>
<p>This turns out to be pretty good system to deliver web applications in
a maintainable way. Servers are fast, interpreted languages are friendly, and
MVC encourages separation of concerns. Great.</p>
<p>No system is perfect, though. The weak part at this point becomes the HTTP
requests that allow browsers and servers to interact. Even with heavy caching,
page reloads are relatively slow. So what can we do?</p>
<h2 id="motivation-mvc-on-the-client">Motivation: MVC on the client</h2>
<p>Up to this point, we&#39;ve used JavaScript to add some interspersed interactivity
to our web page. An element click here, a mouse hover there, etc. There is a new
paradigm of delivering web applications that has become popular in the last few
years, one that places a lot more <em>responsibility</em> on client-side JS rather
than on the server.</p>
<p><strong>Single Page Applications</strong> (SPAs) work by loading data into the browser once
from a server request and then reacting to data changes (&amp; user interaction) on
the client side without complete page refreshes (new full request cycles) to the
server. When more data is needed from the server, an AJAX request is initiated
with a server API endpoint. On reponse, the client-side application reacts
accordingly.</p>
<p>With all this new logic happening on the client, your JavaScript applications
quickly start to get quite complicated. Rather than just displaying information
in the form of HTML/CSS and responding to some browser events, your app now has
to maintain state of <em>models</em> and initiate web requests of its own.</p>
<p>You might be tempted to accomplish this all with something like jQuery, but this
approach often leads to lots of unorganized spaghetti code. It&#39;s all too easy to
end up frantically trying to keep data in sync between the HTML UI, your
JavaScript logic, and the database on the server. Eventually, you&#39;ll be
reimplementing a lot of the things that existing client-side frameworks or
libraries already include. Here&#39;s where client-side MVC comes in.</p>
<h2 id="manifestation-backbone-js">Manifestation: Backbone.js</h2>
<p>Backbone.js is an MV* &quot;framework&quot; for client-side programming. It isn&#39;t quite
MVC, but it&#39;s a good start.</p>
<blockquote>
<p>Backbone.js is a lightweight JavaScript library that adds structure to
your client-side code. It makes it easy to manage and decouple concerns in
your application, leaving you with code that is more maintainable in the long
term.</p>
<p>Backbone focuses on giving you helpful methods for querying and manipulating
your data rather than re-inventing the JavaScript object model. It&#39;s
a library, rather than a framework, that plays well with others and scales
well, from embedded widgets to large-scale applications.</p>
<p>Backbone provides a minimal set of data-structuring (Models, Collections) and
user interface (Views, URLs) primitives that are helpful when building dynamic
applications using JavaScript. It’s not opinionated, meaning you have the
freedom and flexibility to build the best experience for your web application
how you see fit. You can either use the prescribed architecture it offers out
of the box or extend it to meet your requirements.</p>
</blockquote>
<p><em>Source</em>: Backbone Fundamentals</p>
<p>Some encouraging thoughts from Addy Osmani! Hopefully this has piqued your
interest in using a library like Backbone.</p>
<p>Now, of course, Backbone isn&#39;t the only client-side framework or library out
there. There are many others and they suit various needs. We&#39;re going to start
with Backbone, however, because it&#39;s mature, popular, and has a vibrant
developer community. It&#39;s also relatively simple; you&#39;ll spend less time
wondering about &quot;magic&quot; occurring under the hood in your application.</p>
<p>You can read more about Backbone on its <a href="http://backbonejs.org/">website</a>.</p>
<h3 id="diving-into-backbone">Diving into Backbone</h3>
<p>The one hard dependency that Backbone requires is Underscore.js. In addition,
developers usually include jQuery (the functionality doesn&#39;t overlap) or some
other DOM manipulation library.</p>
<p>Here&#39;s a high-level overview of Backbone&#39;s features. The following are all JS
&quot;classes&quot; that can be extended and constructed:</p>
<ul>
<li><strong>Models</strong> are used to represent your data and can be <em>created</em>, <em>validated</em>,
<em>destroyed</em>, and <em>saved to data storage</em>.</li>
<li><strong>Views</strong> organize your interface into logical views backed by models. They
also serve as the traditional &quot;controller&quot; in MVC -- but rather than
responding to server requests, they respond to browser events.</li>
<li><strong>Collections</strong> are ordered sets of Models. They have a few convenience
methods you might expect from lists of models, and they also delegate events
from their elements to the whole collection.</li>
<li><strong>History</strong> provides an API for navigation in the SPA. It allows you to listen
for <code>hashchange</code> or <code>pushState</code> events.</li>
<li><strong>Router</strong> works in conjunction with History to allow you to decide which
application logic should run (views generated, etc.) on certain URL locations
in the app.</li>
</ul>
<p>In addition, there&#39;s a handy mixin utility class:</p>
<ul>
<li><strong>Backbone.Events</strong> is a module that is mixed into Models. It provides
a convenient syntax for event dispatching. You can listen for &quot;change&quot; events
on Models with fine detail and update your Views accordingly.</li>
</ul>
<p>Let&#39;s start by looking at the tried-and-true to do list example. Markup in
<code>index.html</code> might look like:</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;To Do List&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;todo-list&quot;&gt;
  &lt;/div&gt;

  &lt;script type=&quot;text/template&quot; id=&quot;item-template&quot;&gt;
    &lt;input id=&quot;todo-complete&quot; type=&quot;checkbox&quot; &lt;%= completed ? &#39;checked=&quot;checked&quot;&#39; : &#39;&#39; %&gt; /&gt;
    &lt;%= title %&gt;
    &lt;span class=&quot;owner&quot;&gt;&lt;%= owner %&gt;
  &lt;/script&gt;

  &lt;!-- load scripts in order --&gt;
  &lt;script src=&quot;lib/jquery.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;lib/underscore.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;lib/backbone.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;todo.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><code>todo.js</code> includes the following code (within its IIFE):</p>
<pre><code>var Todo = Backbone.Model.extend({

  defaults: {
    title: &#39;&#39;,
    completed: false
  }

});
</code></pre><p>Immediately you might notice that we are defining attributes to extend from the
globally-available <code>Backbone.Model</code>. This is similar to class inheritance --
a <code>Todo</code> is a special kind of <code>Backbone.Model</code>. (It&#39;s not quite prototypical
inheritance since <code>extend</code> only clones an object and adds additional
properties).</p>
<p>The <code>Todo</code> model holds the data for each todo item. Later, we will group models
together into <code>Collection</code>s. We&#39;ll also explore a way of persisting models to
some data store (API, database, etc.).</p>
<p>Now here&#39;s the todo View:</p>
<pre><code>// Renders a todo item and manages its UI interactions
var TodoView = Backbone.View.extend({

  // Directive to Backbone telling it wrap this view in an &#39;li&#39;
  tagName: &#39;li&#39;,

  // Returns a function that generates an HTML string
  tmpl: (function () {
    var $tmpl = $(&#39;#item-template&#39;);
    return _.template($tmpl.html());
  })(),

  // Maps events on elements within this view to view methods
  events: {
    &#39;dblclick label&#39;: &#39;edit&#39;,
    &#39;keypress .edit&#39;: &#39;updateOnEnter&#39;,
    &#39;blur .edit&#39;:     &#39;close&#39;
  },

  // Executed when a Todo is created
  initialize: function () {
    this.$el = $(&#39;#todo-list&#39;);
  },

  // Writes this view&#39;s HTML representation to the DOM
  render: function () {
    var renderedTmpl = this.tmpl(this.model.toJSON());
    this.$el.html(renderedTmpl);
    this.input = this.$(&#39;.edit&#39;);
    return this;
  },

  // Executed when todo item is double-clicked
  edit: function () {

  },

  // Executed when todo item loses focus
  close: function () {

  },

  // Executed on each keypress when editing a todo item
  updateOnEnter: function (e) {

  }

});
</code></pre><p>There are a lot of things happening here, and it&#39;s not entirely obvious which
functions get called first. When a <code>Backbone.View</code> is created, its <code>initialize</code>
method is called and its <code>events</code> object is parsed to register event handlers.</p>
<p>Later, when this view is rendered with the <code>render</code> function, it looks up its
template and generates an HTML string from a JSON representation of its model.
Only then can you query for elements available in the view&#39;s template (they
become available in the <code>document</code>).</p>
<p><strong><em>A note on client-side templating</em></strong>: It is possible to generate HTML as
strings or through jQuery methods and add classes, attributes, etc. to them. But
this quickly becomes tedious in any moderately-sized application. A better
solution is to use a <em>templating framework</em>, which allows you to define
common <strong>templates</strong> interface elements as HTML skeletons with interpolated
values built-in. These values are later filled in by a JSON object representing
some application data. For example, we have defined the following Underscore
template in our HTML page, which uses <code>&lt;%= %&gt;</code> as interpolation delimiters:</p>
<pre><code>&lt;script type=&quot;text/template&quot; id=&quot;item-template&quot;&gt;
  &lt;input id=&quot;todo-complete&quot; type=&quot;checkbox&quot; &lt;%= completed ? &#39;checked=&quot;checked&quot;&#39; : &#39;&#39; %&gt; /&gt;
  &lt;%= title %&gt;
  &lt;span class=&quot;owner&quot;&gt;&lt;%= owner %&gt;
&lt;/script&gt;
</code></pre><p>The method <code>_.template</code> will accept a template string and parse it into a
function.</p>
<pre><code>// Returns a string-generating function
var tmpl = _.template($(&#39;#item-template&#39;).html())
  , data = {
      title: &#39;Complete homework 3 by Saturday&#39;,
      owner: &#39;Joe Student&#39;
  };

var renderedHTML = tmpl(data);
</code></pre><hr>
<p>Back to <code>TodoView</code>.</p>
<p>Backbone doesn&#39;t quite separate the &#39;V&#39; and &#39;C&#39; in MVC. You can see that
Controller responsibilities are fulfilled in the <code>Backbone.View</code> defined here.
Its configuration for DOM interactions is managed by the <code>events</code> object, which
delegates browser events to methods defined in the View.</p>
<p>With the model and view in place, we can invoke their constructors:</p>
<pre><code>var todo = new Todo({
      title: &#39;Lorem ipsum dolor sit amet&#39;,
      owner: &#39;Adi&#39;
})
  , todoView = new TodoView({
      model: myTodo;
  });

todoView.render();
</code></pre><p>Notice that a View is directly tied to a Model (it can also be tied to
a collection).</p>
<p>This is the picture of MVC we have now in Backbone.</p>
<p><img src="http://addyosmani.github.io/backbone-fundamentals/img/backbone_mvc.png" alt="backbone-mvc"></p>
<p><em>Source</em>: Backbone Fundamentals</p>
<p>Fairly similar to the server MVC picture, but the View has swallowed the
Controller and interaction (requests / responses for data) happens through the
web page DOM.</p>
<p><em>See the course lecture repository for a simple working Backbone app</em>.</p>
<p>(Time permitting) Let&#39;s explore
<a href="http://documentcloud.github.io/backbone/docs/backbone.html">the source</a>!</p>
<hr>
<p><strong>References</strong></p>
<ul>
<li><a href="http://addyosmani.github.io/backbone-fundamentals/#mvc">Backbone
Fundamentals</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes hw4 language-javascript"><h1 id="homework-4-backbone-js-starter">Homework 4: Backbone.js Starter</h1>
<p>Due <em>Tuesday, Oct. 21 at 9 AM</em>.</p>
<p>Implementation stub available in the
<a href="https://github.com/cis197f14/hw/blob/master/hw4/">homework repository</a>.</p>
<h3 id="before-starting-this-assignment">Before starting this assignment</h3>
<p>Review the <a href="#lectures">lecture 5</a> notes on functional programming,
Underscore.js, MVC, and Backbone.js. It&#39;s probably also helpful to reference the
<strong>Fundamentals</strong> and <strong>Backbone Basics</strong> sections of the
<a href="http://addyosmani.github.io/backbone-fundamentals/"><em>Backbone Fundamentals</em></a>
book.</p>
<h2 id="refactoring-map-builder">Refactoring map builder</h2>
<p><img src="build/images/map-builder.png" alt="map-builder"></p>
<p>Ah, our old friend, the Pokémon map builder from hw3. In this assignment, we&#39;re
going to refactor the jQuery-centric code from the last project into a Backbone
application and also add some functionality. The new app will still have the
restriction that maps are lost on a page refresh (no persistence), but the code
will be more structured and modular.</p>
<p>Here are the essential parts to map builder v2, broken down into MVC
components:</p>
<ul>
<li><code>Builder</code> model: singleton that maintains state of the builder and enables
information sharing between other models.</li>
<li><code>Player</code> model: keeps track of player position and orientation.</li>
<li><code>PaletteView</code>: represents the palette swatch &amp; enables swatch selection.</li>
<li><code>BuilderView</code>: represents the map canvas and enables user interaction with the
map. Also responsible for constructing <code>PaletteView</code>.</li>
<li><code>PlayerView</code>: represents the player on the map.</li>
</ul>
<p><em>Note</em>: Backbone Collections aren&#39;t really necessary for the Map Builder. You
might consider the map layout as a collection of tiles, but they really
don&#39;t have much relationship to each other as modeled objects, and so we&#39;ll just
keep track of tiles as a 2D array in the <code>Builder</code> model.</p>
<hr>
<h2 id="backbone-intro">Backbone intro</h2>
<p>This time around, there&#39;s some starter code provided for you in
<code>map-builder.js</code>. You&#39;ll also notice some more map tiles to play with in the
swatches palette!</p>
<p>Take a look the bottom of the JS file, where the Backbone application is invoked
within jQuery&#39;s document-ready function.</p>
<pre><code>var dimensions = {
      width: 30,
      height: 10
},
    builder = new Builder(dimensions);
</code></pre><p>When <code>builder</code> is created, the first argument it receives gets parsed as an
attributes hash. <code>Backbone.Model</code> internally sets all the (key, value) pairs as
attributes on the model and fills in any <code>defaults</code> if they were defined in
<code>Builder</code>. However, <code>attributes</code> is an internal storage mechanism for models
that you shouldn&#39;t touch externally. It&#39;s better to use the getter / setter
methods:</p>
<pre><code>builder.get(&#39;width&#39;);     // 30
builder.get(&#39;height&#39;);    // 10

builder.set(&#39;width&#39;, 20);                   // fires &#39;change:width&#39; event
builder.set({ width: 20, height: 10 });     // no events fired
builder.set(&#39;width&#39;, 30, { silent: true }); // no events fired
</code></pre><p>Models in Backbone communicate asynchronously through events. All
<code>Backbone.Model</code>s and their extensions have the <code>Backbone.Events</code> mixin. This
means that you can listen for events on the model like so:</p>
<pre><code>builder.on(&#39;change:width&#39;, function (builder) {
  builder.changing;      // true
  bulder.changed;        // { width: 20 }
});
</code></pre><p><em>See <a href="http://documentcloud.github.io/backbone/#Model">Backbone.Model documentation</a>
for more information</em>.</p>
<p>To create a <code>BuilderView</code> tied to this model, we have following:</p>
<pre><code>var builderView = new BuilderView({ model: builder });
</code></pre><p>Assuming that <code>BuilderView</code> internally manages its placement on the DOM, we can
invoke its <code>render</code> function to make it appear on the page:</p>
<pre><code>builderView.render();
</code></pre><p>Similarly for the <code>Player</code> model and <code>PlayerView</code>, we have the following code:</p>
<pre><code>var player = new Player({
      builderModel: builder,
      dimensions: dimensions
})
  , playerView = new PlayerView({ model: player });

playerView.setElement(builderView.$el);
playerView.render();
</code></pre><p><code>Player</code> is passed a reference to the <code>builder</code> so that it can know about the
location of tiles on the map. Also, <code>PlayerView</code> has its containing element set
to <code>builderView</code>&#39;s element so that it knows where to place itself in the DOM
upon <code>render</code>.</p>
<hr>
<p>Now that we know how the top-level application is structured and how our
Backbone Models and Views are used, we can go ahead and fill in their
implementations. But first, a few utility methods will be useful...</p>
<h3 id="utility-functions">Utility functions</h3>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li><p>Implement <code>getSwatchName</code> with underscore methods and the chaining syntax
described in class (its desired functionality is described in
<code>map-builder.js</code>). <em>Hint</em>: consider using <code>_.difference</code> along with <code>_.first</code>.</p>
</li>
<li><p>Implement <code>canvasToPixelUnits</code> to translate between tile units on the canvas
(the units used by the <code>Builder</code> model for <code>width</code>, <code>height</code>) to pixel units
on the web page. It&#39;s a simple scaling function using the constant
<code>TILE_SIZE</code>.</p>
</li>
</ul>
<hr>
<p>We&#39;re now going to create custom model and view classes. This is done with the
extend syntax:</p>
<pre><code>var Builder = Backbone.Model.extend({
  ...
});
</code></pre><p>Each method defined in this custom class has its context bound to the newly
constructed instance of the class. See the Backbone docs for all the possible
customization properties / methods.</p>
<h2 id="models">Models</h2>
<h4 id="builder">Builder</h4>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li><p>Implement a <code>generateTiles</code> method and add it to the custom class. It should 
look at the model&#39;s stored <code>width</code> and <code>height</code> attributes and return a
two-dimensional matrix corresponding to the map tiles modeled like so:</p>
<pre><code>[
  [ { row: 0, col: 0, swatch: &#39;grass&#39; }, { row: 0, col: 1, ...}, ... ],
  [ { row: 1, col: 0, ...}, ... ],
  ...
]
</code></pre><p>Each tile is represented here by an object that contains its row and column
position as well as its swatch name (the model&#39;s <code>selectedSwatch</code>
at the time of construction).
Also note that this matrix is indexed with row and column numbers in the
following order: <code>tiles[row][col]</code>. This is important for rendering the canvas
later.</p>
<p>Avoid <code>for</code> loops in this implementation. Try using underscore methods like
<code>_.map</code> and <code>_.range</code>.</p>
<p><em>Note how <code>generateTiles</code> is invoked</em> in <code>Builder.initialize</code>: the returned
matrix is stored to the <code>tiles</code> attribute with a setter method.</p>
</li>
<li><p>Add a method to the <code>Builder</code> definition called <code>updateTileSwatch</code> that
updates the tile swatch at a given canvas location to the currently
selected swatch (necessary for &quot;painting&quot; tiles). It will be called like this:</p>
<pre><code>builder.updateTileSwatch({
  row: 4,
  col: 0
});
</code></pre><p><em>Hint</em>: remember that you can&#39;t access the tiles simply with <code>this.tiles</code>,
rather you must use <code>this.get(&#39;tiles&#39;)</code> and then index into it as a 2D array
with <code>row</code> and <code>col</code>.</p>
</li>
<li><p>Add another method called <code>hasTerrain</code> which is passed two arguments: <code>row</code>
and <code>col</code>. It should return <code>true</code> if the tile at the given location is
painted with a <em>terrain swatch</em> and <code>false</code> otherwise. There is an array
called <code>TERRAIN_SWATCHES</code> available that contains all the swatch names
that correspond to <em>terrain</em>.</p>
<p><em>Hint</em>: you may find <code>_.contains</code> helpful here.</p>
</li>
</ul>
<h4 id="player">Player</h4>
<p>Next, the <code>Player</code> model. It keeps track of where the player is on the canvas
and its orientation. It also knows about the canvas dimensions (they are passed
in on instantiation of <code>player</code>). Look at the provided <code>defaults</code> object and the
arguments passed to <code>new Player(...)</code> to see what this model&#39;s attributes look
like.</p>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li>Add methods called <code>moveUp</code>, <code>moveLeft</code>, <code>moveDown</code>, and <code>moveRight</code>. These
should check if the proposed move is valid (doesn&#39;t go outside the canvas
dimensions and is walkable terrain, as handily indicated by the <code>isTerrain</code>
method). If so, they should update the player model&#39;s <code>row</code> or <code>col</code> state as
well as its <code>orientation</code>.</li>
</ul>
<hr>
<h2 id="views">Views</h2>
<h4 id="-backbone-view-life-cycle"><code>Backbone.View</code> life cycle</h4>
<p><em>To review</em>: when a Backbone View is created, a few things happen:</p>
<ol>
<li><p>An element is created for the view. It can be customized by supplying options
(like <code>tagName</code>, <code>className</code>, <code>el</code>, etc.) to <code>Backbone.View.extend</code>, but
otherwise it&#39;s just a plain <code>&lt;div&gt;</code>. This element is not placed in the DOM
yet; it only exists in your script.</p>
</li>
<li><p>Event handlers defined by the <code>events</code> hash are bound to the view&#39;s element
using a mechanism similar to jQuery&#39;s <code>delegate</code>.</p>
</li>
<li><p>The view&#39;s <code>initialize</code> method, if it exists, is called.</p>
</li>
</ol>
<p>Technically, <em>rendering</em> a view is optional. You could set a view&#39;s element to
something that already exists in the DOM and the view will attach events
accordingly. But if you have any nontrivial rendering logic to accomplish (like
compiling a template), you&#39;ll define and invoke a <code>render</code> method.</p>
<p><em>Keep in mind</em> that all of the custom view&#39;s defined properties are <strong>computed
upon script execution</strong>. The document may or may not be &quot;ready&quot; by this time, so
we&#39;ll ensure that we only call things like jQuery selectors (to grab templates
on the page) once the view is actually created and initialized.</p>
<h4 id="templating">Templating</h4>
<p>Refer to the <a href="#mvc">MVC notes</a> for an introduction to client-side templating.
Once you have a template function (generated by <code>_.template</code>), you <strong>compile</strong>
it with a <strong>view context</strong>. A context is simply a JS object representing values
available to the template. See the
<a href="http://underscorejs.org/#template">Underscore docs</a> for more info.</p>
<h4 id="paletteview">PaletteView</h4>
<p>This view will do the work of the <code>_setupPalette</code> function from HW3.</p>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li><p>Implement a <code>render</code> method. There is a template function called <code>swatchTmpl</code>
made available by <code>initialize</code> in the view. It corresponds to this template:</p>
<pre><code>&lt;li class=&quot;swatch &lt;%= name %&gt;&quot;&gt;&lt;/li&gt;
</code></pre><p>You&#39;ll need to invoke this template for every swatch (a full list is available
in a variable in <code>map-builder.js</code> called <code>SWATCHES</code>) and insert the generated
HTML string into the DOM so that the palette swatches show up like so:</p>
<pre><code>&lt;div class=&quot;palette&quot;&gt;
  &lt;ul&gt;
    &lt;li class=&quot;swatch grass&quot;&gt;&lt;/li&gt;
    &lt;li class=&quot;swatch flowers-red&quot;&gt;&lt;/li&gt;
    ...
  &lt;/ul&gt;
&lt;/div&gt;
</code></pre><p>In <code>BuilderView</code>, we&#39;re going to set the constructed <code>PaletteView</code>&#39;s element
to the <code>.palette</code> element, so you can assume <code>this.$el</code> points to the
<code>&lt;div class=&quot;palette&quot;&gt;</code> in the above snippet. See
<a href="http://documentcloud.github.io/backbone/#View-dollar">this feature</a> of
Backbone to learn about selecting elements within views. Finally, it is
customary to return <code>this</code> at the end of <code>render</code> for chaining purposes.</p>
<p><em>Hint</em>: Try using <code>_.map</code> when compiling the swatch templates. Also,
<code>Array.prototype.join</code> is useful for concatenating a list of strings together.</p>
</li>
<li><p>Add an event listener for swatch clicks by specifying the <code>events</code> hash and
relevant handler function in the view. See the
<a href="http://documentcloud.github.io/backbone/#View-delegateEvents">events docs</a>
for the appropriate syntax. Note that event handlers delegated in this way get
their <code>this</code> context bound to the current view, <em>not the event target</em> as you
might be used to from jQuery. Keep this in mind when adapting your hw3 code
from <code>_setupPalette</code>.</p>
<p>To keep track of the selected swatch state, you should set the
<code>selectedSwatch</code> attribute on the <code>Builder</code> model (this model is accessible in
<code>PaletteView</code> as simply <code>this.model</code>).</p>
</li>
</ul>
<h4 id="builderview">BuilderView</h4>
<p>There is some starter code here which gets template functions for you.
We don&#39;t really need a template for this view since it&#39;s all static
markup. We do, however, need a template for the canvas &quot;sub-view&quot;.</p>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li><p>Define &amp; implement <code>_renderPalette</code> (it&#39;s invoked within <code>render</code>). Construct
a new <code>PaletteView</code> and give it a reference to <code>BuilderView</code>&#39;s model (it&#39;s OK
for two views to act on the same model).
<a href="http://documentcloud.github.io/backbone/#View-setElement">Set the new view&#39;s element</a>
to the element passed into <code>_renderPalette</code>. Finally, render the new view.</p>
</li>
<li><p>Define &amp; implement <code>_renderCanvas</code>. This should simply use the saved
<code>canvasTmpl</code> to render canvas tiles into the element passed as an argument.
If you have set up the <code>Builder</code> model right, you simply need to provide
<code>this.model.toJSON()</code> as context for the template. <code>canvas-template</code> has
markup to generate rows and columns from the JSON representation of the model:</p>
<pre><code>&lt;% _.each(tiles, function (row) { %&gt;
  &lt;div class=&quot;row&quot;&gt;

  &lt;% _.each(row, function (tile) { %&gt;
    &lt;div class=&quot;tile swatch &lt;%= tile.swatch %&gt;&quot; data-row=&quot;&lt;%= tile.row %&gt;&quot; data-col=&quot;&lt;%= tile.col %&gt;&quot;&gt;&lt;/div&gt;
  &lt;% }); %&gt;

  &lt;/div&gt;
&lt;% }); %&gt;
</code></pre></li>
<li><p>Define <code>events</code> and their associated handlers in this view. These are the
tile <code>mousedown</code>, <code>mouseout</code>, and <code>mouseenter</code> events from <code>_setupCanvas</code> in
hw3 that allow you to preview and paint tiles. You should simply be adapting
that code to fit the Backbone event system (again, keep in mind the <em>context</em>
each event handler is invoked with). There ought to be one additional bit of
logic in the <code>mousedown</code> handler that notifies the <code>Builder</code> model of
a painted swatch (remember the <code>updateTileSwatch</code> method we implemented
earlier?). <em>This is crucial to allow the <code>Player</code> model to know about the
locations of map tiles</em>.</p>
</li>
</ul>
<h4 id="playerview">PlayerView</h4>
<p>This view will display Pikachu on the map canvas and update its position in
response to user interaction (keypresses). We&#39;ll use a library called
<a href="http://craig.is/killing/mice">Mousetrap</a> so that we have a simple API for
binding key-based event handlers.</p>
<p><strong><em>TODO</em></strong>:</p>
<ul>
<li><p>First implement a <code>render</code> method to draw the player in the canvas. 
We&#39;re able to move the player around the map using CSS absolute positioning.
Here, <code>this.tmpl</code> is a reference to the template:</p>
<pre><code>&lt;div class=&quot;player facing-&lt;%= orientation %&gt;&quot; style=&quot;top: &lt;%= top %&gt;px; left: &lt;%= left %&gt;px&quot;&gt;&lt;/div&gt;
</code></pre><p>It expects a context with <code>top</code>, <code>left</code>, and <code>orientation</code> values available.
The player model keeps track of <code>orientation</code>, but to get <code>top</code> and <code>left</code>
pixel values, you&#39;ll have to use the <code>canvasToPixelUnits</code> utility defined
earlier.</p>
<p>Once you&#39;ve compiled the template into a string, use jQuery&#39;s <code>.prepend</code> to
place the player as the first child of <code>this.$el</code>. The page will then have
something like:</p>
<pre><code>&lt;div id=&quot;map-builder&quot;&gt;
  &lt;div class=&quot;player facing-right&quot; style=&quot;top: 0px; left: 0px&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;canvas&quot;&gt;...&lt;/div&gt;
  &lt;hr/&gt;
  &lt;div class=&quot;palette&quot;&gt;...&lt;/div&gt;
&lt;/div&gt;
</code></pre></li>
<li><p>Define &amp; implement a method to bind keypress listeners to the document using
the <a href="http://craig.is/killing/mice">Mousetrap</a> library.
Keypresses (in particular, &#39;keydown&#39;) on <code>W</code>, <code>A</code>, <code>S</code>, and <code>D</code>
should correspond to the <code>Player</code> model&#39;s <code>moveUp</code>, <code>moveLeft</code>, <code>moveDown</code>,
and <code>moveRight</code> actions. This new event-binding method should be called in
<code>render</code>.</p>
</li>
<li><p>Here&#39;s the interesting reactive part -- in <code>initialize</code>, add some code to tell
the <code>PlayerView</code> to listen for <code>change:row</code> and <code>change:col</code> events on the
<code>Player</code> model. When these events occur, the <code>PlayerView</code> should be
re-rendered. Again, see the
<a href="http://documentcloud.github.io/backbone/#Events-on">Events docs</a> for help.</p>
<p>This step also requires you to edit <code>render</code> to add logic that destroys the
<code>.player</code> element if it already exists on the page (we don&#39;t want multiple
Pikachus to be displayed).</p>
<p><em>Note</em>: with <code>render</code> being invoked many times in this manner, you&#39;ll notice
that we&#39;re repeatedly binding keypress listeners on the page; your application
might even start to run slowly! To avoid this, use Underscore&#39;s <code>once</code> method to
ensure that keypress listeners are only ever bound once.</p>
</li>
</ul>
<hr>
<p>That&#39;s it! At this point you should have an editable canvas of map tiles and
a playable Pikachu character that moves around with WASD controls. I encourage
you to thoroughly explore the
<a href="http://documentcloud.github.io/backbone">Backbone docs</a> to get a handle on how
the library is used to build a simple app like this.</p>
<p><img src="build/images/gifs/player-moving.gif" alt="player-moving"></p>
<h3 id="notes">Notes</h3>
<ul>
<li>Please remove &quot;TODO&quot; comments from the code when you complete implementing
those parts of the application.</li>
<li>Check out the Chrome DevTools docs / tutorials on
<a href="https://developers.google.com/chrome-developer-tools/docs/javascript-debugging">JavaScript debugging</a>.</li>
</ul>

      </section>
      <section class="pure-u-3-4 notes backbone"><h1 id="backbone-js-applications">Backbone.js Applications</h1>
<p>Most of what was covered in lecture can be learned from the
<a href="http://backbonejs.org/">Backbone.js docs</a>.</p>
<p>A few useful diagrams are available in the
<a href="files/lecture5.pdf">lecture slides</a>.</p>
<p>Be sure to browse the associated
<a href="https://github.com/cis197s14/lectures/tree/master/lecture-5">code examples</a>.</p>

      </section>
      <section class="pure-u-3-4 notes server-js language-javascript"><h1 id="server-side-javascript">Server-Side JavaScript</h1>
<p>Last time, we saw some examples of how a client-side application might talk to
a web server to save its state &amp; data.</p>
<pre><code>var player = new Player({...});

player.fetch();

player.set({
  position: {
    x: 10,
    y: 0
  }
});

player.save();
</code></pre><p>This last line relies on a custom URL defined in the <code>Player</code> model to save the
model state to the server. Backbone will internally call <code>sync</code> to perform an
AJAX request to some API you&#39;ve specified. This lecture will cover the details
of such an API.</p>
<h2 id="rest">REST</h2>
<p>Data transfer on the web these days happens almost exclusively through what are
known as <strong><em>RESTful web services</em></strong>. REST (Representational State Transfer) is
kind of a specification for how these services interface with one another. Some
guidelines:</p>
<h4 id="use-semantic-http-requests">Use semantic HTTP requests</h4>
<p>RESTful HTTP requests should do something to or with a resource:</p>
<ul>
<li>Create a resource with <code>POST</code></li>
<li>Retrieve a resource with <code>GET</code></li>
<li>Update a resource with <code>PUT</code></li>
<li>Delete a resource with <code>DELETE</code></li>
</ul>
<p>Notice the direct mapping to typical CRUD actions for data models.</p>
<p>This structure can be abused, however. For example, a service might allow state
changes with a <code>GET</code> route, which can pose a number of problems:</p>
<pre><code>GET /adduser?name=Robert
</code></pre><p>This action is better represented as a <code>POST</code> with a JSON payload:</p>
<pre><code>POST /users

Content-type:application/json
{
  &quot;name&quot;: &quot;Robert&quot;,
  &quot;email&quot;: &quot;robert@example.com&quot;
}
</code></pre><h4 id="be-stateless">Be stateless</h4>
<p>Web servers that keep track of a client&#39;s state and respond accordingly are
difficult to maintain and pose issues of synchronization, serialization, etc.
RESTful web services strive to be stateless; when you interact with an API, you
as the client must keep track of your state over multiple requests and use
request parameters as necessary.</p>
<h4 id="expose-directory-like-uris">Expose directory-like URIs</h4>
<p>URLs in RESTful web services should have semantic meaning within them. A good
example of this occurs in most web publications, where the URL contains much of
the metadata relevant to an article:</p>
<pre><code>http://www.nytimes.com/2014/03/05/movies/awardsseason/keeping-faith-in-oscar-filmmakers-work-and-sacrifice.html
</code></pre><p>The service&#39;s <em>router</em> will have some logic to parse URLS and figure out which
models to work with, etc. (similar to Backbone&#39;s router).</p>
<pre><code>/:year/:month/:day/:section/:subsection/...
</code></pre><hr>
<p>One of our next goals is to build a RESTful web API ourselves in JavaScript for
our client-side applications to interact with. To do this, we&#39;ll leverage
<code>node.js</code>. We&#39;ve been using it simply as an interpreter for JS code thus far,
but today we&#39;ll explore its extensive capabilities as a library for building
web servers.</p>
<h2 id="web-services-with-node">Web services with Node</h2>
<p>From the node website (emphasis mine):</p>
<blockquote>
<p>Node.js is a platform built on Chrome&#39;s JavaScript runtime for easily building
fast, scalable network applications. Node.js uses an <strong>event-driven,
non-blocking I/O model</strong> that makes it lightweight and efficient, perfect for
data-intensive real-time applications that run across distributed devices.</p>
</blockquote>
<p>Node basically provides two things: an <strong>environment</strong> and a <strong>library</strong>. In the
browser, we had our own special environment to play around with, but loading
files was done somewhat crudely with <code>&lt;script&gt;</code> tags. Node provides a much more
structured module system.</p>
<p>When you open up a REPL or a <code>.js</code> file, you&#39;ll have some variables already
defined and available to you -- these are global values in Node such as:</p>
<ul>
<li><code>global</code> object, or <code>root</code></li>
<li><code>process</code>: provides information and interaction with the currently
running Node process</li>
<li><code>console</code>: STDIO functionality in a browser-y way</li>
<li><code>setTimeout()</code>, <code>setInterval()</code>, <code>clearTimeout()</code>, <code>clearInterval()</code> timing
functions</li>
</ul>
<p><em>Within</em> any module (basically any <code>.js</code> file run with Node), you also have:</p>
<ul>
<li><code>module</code>, <code>module.exports</code>, <code>exports</code>: allow definition of a module &amp; its
exports (more on this below)</li>
<li><code>require()</code>: allows importing of other modules</li>
<li><code>filename</code>: path of the currently executing file</li>
<li><code>dirname</code>: directory of the currently executing file</li>
</ul>
<p>Then there are a handful of core modules available on your system when Node is
installed, but you&#39;ll have to <code>require</code> them individually to gain access to
them. A few popular ones include:</p>
<ul>
<li><code>fs</code> (File System)</li>
<li><code>http</code></li>
<li><code>stream</code></li>
<li><code>querystring</code></li>
<li><code>url</code></li>
<li><code>child_process</code></li>
<li><code>events</code></li>
</ul>
<h3 id="modules">Modules</h3>
<p>Node follows the CommonJS module system; the easiest way to include modules from
separate files is through use of the <code>require</code> function. In a nutshell, it
parses another script and returns the <code>exports</code> object.</p>
<pre><code>var fs = require(&#39;fs&#39;);

console.log(fs);   // { Stats: [Function], exists: [Function], ...}
</code></pre><p>To define your own module, you might have something like this in a JS file:</p>
<pre><code>console.log(&quot;evaluating example.js&quot;);

var privateFn = function () {
  console.log(&quot;invisible&quot;);
};

exports.message = &quot;hi&quot;;

exports.say = function () {
  console.log(exports.message);
}
</code></pre><p>And its import would look like this (note the <code>./</code> filepath syntax):</p>
<pre><code>var example = require(&#39;./example&#39;);
console.log(example);       // { message: &#39;hi&#39;, say: [Function] }
</code></pre><p>You don&#39;t have to include the <code>.js</code> file extension; <code>require</code> will figure it out
and do the right thing.</p>
<p><em>Note</em>: if you re-require an already-loaded file, Node will use its module cache
instead of reloading the file.</p>
<p>You can export a function instead, if you&#39;d like:</p>
<pre><code>// example2.js
module.exports = function () {
  console.log(&#39;hello&#39;);
}

// Node REPL
&gt; require(&#39;./example2&#39;)();    // &#39;hello&#39;
</code></pre><p><em>Note</em>: we couldn&#39;t simply define <code>exports = ...</code> because this would have
created a new global variable (however,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode">&#39;strict mode&#39;</a>
would likely guard against this).</p>
<h3 id="node-package-manager">Node Package Manager</h3>
<p>Soon, you&#39;ll want to use packages written by the Node community. To get these
on to your computer, you&#39;ll use the Node Package Manager, or <code>npm</code>. It consists
of an online repository of published open-source projects and a command-line
utility (bundled with every Node installation) to manage packages, versions,
etc. on your system. Package installation is very simple; here&#39;s how you&#39;d
install the <code>async</code> package:</p>
<pre><code>$ npm install async
</code></pre><p>If you install a package locally like this, it gets put in a <code>node_modules</code>
folder in the current directory. You can also install a package globally; its
main executable (if any) will hopefully get sym-linked to your <code>PATH</code> and you
can use it anywhere:</p>
<pre><code>$ npm install -g coffee-script

$ coffee -c foo.coffee -o ./build/
</code></pre><p>The <a href="https://www.npmjs.org/">online npm registry</a> contains information about
all published packages.</p>
<p>Finally, most node projects will include a file called <code>package.json</code> at their
root, which specifies metadata about the package and allows you to declaratively
list dependencies. For example, here&#39;s a portion of the <code>package.json</code> for the
Express framework:</p>
<pre><code>{
  &quot;name&quot;:         &quot;express&quot;,
  &quot;description&quot;:  &quot;Sinatra inspired web development framework&quot;,
  &quot;version&quot;:      &quot;4.0.0-rc2&quot;,
  &quot;author&quot;: {
    &quot;name&quot;:       &quot;TJ Holowaychuk&quot;,
    &quot;email&quot;:      &quot;tj@vision-media.ca&quot;
  },
  &quot;contributors&quot;: [ ...  ],
  &quot;dependencies&quot;: {
    &quot;accepts&quot;:            &quot;1.0.0&quot;,
    &quot;type-is&quot;:            &quot;1.0.0&quot;,
    &quot;range-parser&quot;:       &quot;1.0.0&quot;,
    &quot;cookie&quot;:             &quot;0.1.0&quot;,
    &quot;buffer-crc32&quot;:       &quot;0.2.1&quot;,
    &quot;fresh&quot;:              &quot;0.2.2&quot;,
    &quot;methods&quot;:            &quot;0.1.0&quot;,
    &quot;send&quot;:               &quot;0.2.0&quot;,
    &quot;cookie-signature&quot;:   &quot;1.0.3&quot;,
    &quot;merge-descriptors&quot;:  &quot;0.0.2&quot;,
    &quot;utils-merge&quot;:        &quot;1.0.0&quot;,
    &quot;escape-html&quot;:        &quot;1.0.1&quot;,
    &quot;qs&quot;:                 &quot;0.6.6&quot;,
    &quot;debug&quot;:              &quot;&gt;= 0.7.3 &lt; 1&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;ejs&quot;:                &quot;~0.8.4&quot;,
    &quot;mocha&quot;:              &quot;~1.15.1&quot;,
    &quot;jade&quot;:               &quot;~0.30.0&quot;,
    &quot;hjs&quot;:                &quot;~0.0.6&quot;,
    &quot;stylus&quot;:             &quot;~0.40.0&quot;,
    &quot;should&quot;:             &quot;~2.1.1&quot;,
    &quot;connect-redis&quot;:      &quot;~1.4.5&quot;,
    &quot;marked&quot;:             &quot;0.2.10&quot;,
    &quot;supertest&quot;:          &quot;~0.8.1&quot;,
    &quot;body-parser&quot;:        &quot;1.0.0&quot;,
    &quot;cookie-parser&quot;:      &quot;1.0.1&quot;,
    &quot;static-favicon&quot;:     &quot;1.0.0&quot;,
    &quot;express-session&quot;:    &quot;1.0.1&quot;,
    &quot;morgan&quot;:             &quot;1.0.0&quot;
  },
  &quot;keywords&quot;: [
    &quot;express&quot;, &quot;framework&quot;, &quot;sinatra&quot;, &quot;web&quot;,
    &quot;rest&quot;, &quot;restful&quot;, &quot;router&quot;, &quot;app&quot;, &quot;api&quot;
  ],
  &quot;repository&quot;: {
    &quot;type&quot;:       &quot;git&quot;,
    &quot;url&quot;:        &quot;git://github.com/visionmedia/express&quot;
  },
  &quot;scripts&quot;: {
    &quot;prepublish&quot;: &quot;npm prune&quot;,
    &quot;test&quot;:       &quot;make test&quot;
  },
  &quot;engines&quot;: {
    &quot;node&quot;:       &quot;&gt;= 0.8.0&quot;
  },
  &quot;license&quot;:      &quot;MIT&quot;,

  ...
}
</code></pre><p>Notice that you can separate project dependencies by development and production.
To automatically install local packages with a <code>package.json</code> specified like
this, you can simply run <code>npm install</code> in the project directory. More
information about this file is available
<a href="https://www.npmjs.org/doc/json.html">here</a>.</p>
<hr>
<h2 id="asynchronous-programming">Asynchronous Programming</h2>
<p>Node is a framework that emphasizes asynchronous programming from the ground up
(in contrast to other web frameworks). There are often two functions to do the
same thing; as a general rule of thumb, you should avoid the <em>synchronous</em> ones
and instead use the <em>asynchronous</em> versions.</p>
<p>Let&#39;s look at an example of reading in a file:</p>
<pre><code>var fs = require(&#39;fs&#39;);

// async
// ----------------------------------------

fs.readFile(&#39;example.file&#39;, &#39;utf8&#39;, function (err, data) {
  if (err) {
    return console.log(err);
  }
  console.log(data);
});


// sync
// ----------------------------------------

var data = fs.readFileSync(&#39;example.file&#39;,&#39;utf8&#39;);
console.log(data);
</code></pre><p>At first, it seems like the synchronous code is simpler and more concise.
However, the async code is complicated for a reason. When you invoke
<code>fs.readFileSync</code>, the node process will sit there waiting for the OS to read
a file before continuing in the script. On the other hand, <code>fs.readFile</code> will
ask the OS to start a process to read the file and listen for the OS event
indicating that it is done reading the file, at which point the callback we
pass into <code>readFile</code> here will be run. In the meantime (let&#39;s say you&#39;re reading
a large file), your node process can continue on to other things in the script.
The same kind of logic could be applied to expensive database queries.</p>
<p>You may have to adjust your mental model a bit and have to think about
synchronization issues, but overall the benefits of async code contribute to
some of Node&#39;s speed as a web development library; you may realize its
advantages in the long run.</p>
<p><em>Note about &quot;callbacks&quot;</em>: callbacks are the term we generally use to refer to
the last argument passed to an async function; they are also functions
themselves. It&#39;s kind of like saying &quot;do this with some parameters, and then
when you&#39;re done, do this other thing.&quot; Node generally has a convention for its
callback functions that makes it so an <code>error</code> object is typically passed as the
first argument to a callback (you can see this is the case in the above
<code>fs.readFile</code>).</p>
<p>One more relevant part of async programming in Node is <code>EventEmitter</code>. This is
an interface used when there are multiple stages to a task that a client might
want to be notified about. For example, you might need to parse multi-part form
data or read in a large file with chunks at a time (using <code>Stream</code>s). For more
information, see the
<a href="http://nodejs.org/api/events.html#events_class_events_eventemitter"><code>EventEmitter</code> docs</a>.</p>
<p><strong><em>One &quot;gotcha&quot; of async</em></strong>: a common mistake might be to write code like this:</p>
<pre><code>for (var i = 0; i &lt; 5; i++) {
  setTimeout(function () {
    console.log(i);
  }, i);
}
</code></pre><p>You&#39;d get an unexpected output like the following:</p>
<pre><code>5
5
5
5
5
</code></pre><p><strong>Prompt</strong>: why does this occur?</p>
<p><strong>Answer</strong>: <code>setTimeout</code> is passed a closure which contains a reference to the
<code>for</code> loop&#39;s <code>i</code>. When that closure finally executes, <code>i</code> has already been
incremented all the way to <code>5</code>.</p>
<p>You can accomplish the intended functionality like this:</p>
<pre><code>for (var i = 0; i &lt; 5; i++) {
  (function(i) {
    setTimeout(function () {
      console.log(i);
    }, i);
  })(i);
}
</code></pre><hr>
<h2 id="a-simple-web-server-with-node-built-ins">A simple web server with Node built-ins</h2>
<p>Now that we have somewhat of a handle on the Node environment and ecosystem, we
can jump into writing a RESTful web server. The basic parts we need to get
working are as follows:</p>
<ul>
<li><strong>Listen for connections</strong> on a local port</li>
<li><strong>Parse URLs</strong> for query strings and other params</li>
<li><strong>Route URLs</strong> to relevant request handlers </li>
<li><strong>Parse request data / payloads</strong></li>
<li><strong>Construct responses</strong> to send back to clients</li>
</ul>
<p>To do any of this, we have to start with the <code>http</code> package. This is what the
most basic web server looks like in Node:</p>
<pre><code>// server.js
var http = require(&#39;http&#39;);

var requestHandler = function (req, res) {
  console.log(&#39;Request received&#39;);

  res.writeHead(200, {&#39;Content-Type&#39;: &#39;text/plain&#39;});
  res.write(&#39;Hello World.\n&#39;);

  res.end();
};

var server = http.createServer(requestHandler);

server.listen(1337, &#39;127.0.0.1&#39;);
console.log(&#39;Server running at http://127.0.0.1:1337/&#39;);
</code></pre><p>Try running this code as a file -- when you do so, the process will hang,
simply waiting for connections. If you open your browser to <code>localhost:1337</code>,
however, you ought to get back a <code>&#39;Hello World&#39;</code> string!</p>
<p>Even though the <code>listen</code> function is <strong>blocking</strong>, this is still an instance of
<em>asynchronous programming</em>. An HTTP server is constructed with a request handler
function passed in; this function is invoked every time a client hits the
port(s) which the server is listening on. The work is done <em>later</em>, not
<em>immediately</em>.</p>
<p><em>Aside</em>: For completeness&#39; sake, here&#39;s how you would go about creating and
invoking an HTTP request in Node (in this case, a <code>POST</code> request).</p>
<pre><code>var options = {
  host: &#39;localhost&#39;,
  path: &#39;/&#39;,
  port: &#39;1337&#39;,
  method: &#39;POST&#39;
};

// Note: working with an EventEmitter
var callback = function(response) {
  var str = &#39;&#39;

  response.on(&#39;data&#39;, function (chunk) {
    str += chunk;
  });

  response.on(&#39;end&#39;, function () {
    console.log(str);
  });
}

var req = http.request(options, callback);

req.write(&quot;hello world!&quot;);
req.end();
</code></pre><hr>
<p><strong>References</strong>:</p>
<ul>
<li><a href="http://addyosmani.github.io/backbone-fundamentals/#creating-the-back-end">Backbone Fundamentals</a></li>
<li><a href="http://docs.nodejitsu.com/articles">Nodejitsu Articles</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes hw5 language-javascript"><h1 id="homework-5-playing-pok-mon">Homework 5: Playing Pokémon</h1>
<p>Due <em>Fri, Oct 31 at 9 AM</em>.</p>
<p>Implementation stub available in the
<a href="https://github.com/cis197f14/hw/blob/master/hw5/">homework repository</a>.</p>
<p>This assignment will extend your Backbone.js experience to include topics we&#39;ve
recently covered in class:</p>
<ul>
<li>Backbone routing</li>
<li>Model persistence</li>
</ul>
<p>Here&#39;s a general outline of the new functionality we&#39;re adding to the Pokémon
game:</p>
<ul>
<li>Separate game modes: map building and playing the game</li>
<li>Larger map building area &amp; smaller visible map</li>
<li>URL routes point to map regions</li>
<li>Persistent map to local storage</li>
</ul>
<h3 id="before-starting-this-assignment">Before starting this assignment</h3>
<p>Review the <a href="http://backbonejs.org/">documentation</a> on Backbone&#39;s Router and
<a href="https://github.com/cis197f14/lectures/tree/master/lec7">these code samples</a>
from lecture.</p>
<h3 id="application-structure">Application Structure</h3>
<p>Our code is starting to get a little complicated and disparate for one file, so
we&#39;re going to split it up and move all scripts to a <code>app/</code> directory. Take
a look at <code>index.html</code>. To share information between our scripts, we&#39;ll use a
global object called <code>POKEMON</code>, which is declared and initialized in
<code>index.html</code> before all of our application scripts. (There are better ways to do
this, including dependency injection and requireJS modules, but for now we&#39;ll
stick to basic script loading.)</p>
<ul>
<li><code>app/utils.js</code> is loaded first; it contains global variables and utility
functions.</li>
<li><code>app/builder.js</code> contains the <code>Builder</code> model and <code>PaletteView</code>
&amp; <code>BuilderView</code>.</li>
<li><code>app/player.js</code> contains the <code>Player</code> model and <code>PlayerView</code>.</li>
<li><code>app/map.js</code> contains a <code>MapView</code>, which will be used for the &quot;playing&quot; game
mode.</li>
<li><code>app/pokemon.js</code> is a stub for the overall application. It is loaded last
because it depends on everything else (models, views, etc.) being available.</li>
</ul>
<p><strong><code>Builder</code>, <code>PaletteView</code>, and <code>BuilderView</code></strong> functionality (up to hw4) is
provided for you already in <code>app/builder.js</code>. One difference in rendering you
might notice from hw4 is that a new <code>&lt;div&gt;</code> is created for <code>BuilderView</code> rather
than attaching to the existing <code>#map</code> element on the page (explicitly setting
the view&#39;s <code>el</code>). This is necessary for removing / re-rendering of views that
occurs when switching game modes. </p>
<p><strong><code>Player</code> and <code>PlayerView</code></strong> are left blank in <code>app/player.js</code> -- you should copy
over your code from hw4 to use as a implementation stub. Try to update your code
to use the global variables from <code>POKEMON.globals</code>. In addition, for the
same reason as above for <code>BuilderView</code>, if you were <em>explicitly setting</em>
<code>PlayerView</code>&#39;s element in your implementation, you&#39;ll likely need to edit your
code to instead rely on Backbone&#39;s internally created <code>el</code>.</p>
<p><em>Note</em>: if you are lacking working hw4 code for this portion, please email the
TAs.</p>
<p><strong><code>app/pokemon.js</code></strong> contains code to initialize models and start off a custom
Backbone router.</p>
<hr>
<h2 id="separate-game-modes">Separate Game Modes</h2>
<p>If you open up <code>index.html</code>, you&#39;ll notice a few controls available at the top
right of the page: <strong>Build</strong>, <strong>Play</strong>, and <strong>Reset</strong>. We&#39;ll use url routes to
invoke all these actions, so these controls simply point to different routes
(<code>#build</code>, <code>#play</code>, <code>#reset</code>).</p>
<p><strong><em>TODO</em></strong>: Create a <code>&#39;build&#39;</code> route in <code>pokemon.js</code>. Its handler should
construct a new <code>BuilderView</code> (but <em>only if it doesn&#39;t exist already</em>).
<code>render</code> the view and call <code>delegateEvents</code> to re-bind event handlers. Remember
that you&#39;ll need to wait until DOM ready to construct any views. All the
necessary models you need are already available here.</p>
<p><strong><em>TODO</em></strong>: Create a <code>&#39;play&#39;</code> route whose handler constructs a new <code>MapView</code> and
a new <code>PlayerView</code> if they don&#39;t exist. Render these views and delegate their
events. Be sure to set the <code>playerView</code>&#39;s element to that of the <code>mapView</code> (this
is the same as in hw4).</p>
<p><em>Note</em>: Reference the hw4 implementation stub if you need help constructing
these views.</p>
<p><strong><em>TODO</em></strong>: Revisit both of these route handlers to ensure that the old view
is destroyed when the game mode is switched. For example, when the <code>build</code> route
is hit, you should <strong>undo</strong> the work of <code>render</code> and <code>delegateEvents</code> by calling
<code>undelegateEvents</code> and <code>remove</code> (in that order) on <strong>both</strong> <code>mapView</code> and
<code>playerView</code>.</p>
<p><img src="build/images/gifs/game-modes.gif" alt="game-modes"></p>
<p>Although <code>MapView</code> isn&#39;t implemented completely, you should be able to switch
game modes at this point between the map builder and an empty map playing view
(using the controls at the top right).</p>
<hr>
<h2 id="visible-map-area">Visible Map Area</h2>
<p>In &quot;play&quot; mode, we&#39;re only going to expose a small portion of the map
(of width &amp; height equal to <code>POKEMON.globals.MAP_SIZE</code>) to emulate a
handheld-like game experience.</p>
<p><img src="build/images/gifs/build-play.gif" alt="build-play"></p>
<p>The coordinates of the top-left corner of the
visible map area will be encoded in the url; the route will now look something
like the following (it represents row 5 and column 8):</p>
<pre><code>play/r5/c8
</code></pre><p><em>Hint</em>: take a look at the lecture 5 code to see how to define route parameters
like this.</p>
<p><strong><em>TODO</em></strong>: Once you define this route and parse the row and column in its
handler, you&#39;ll need to decide how to make <code>MapView</code> <strong>only show the relevant
slice of the map</strong> (<em>Hint</em>: you may want to make <code>MapView</code>&#39;s model point to
the <code>Builder</code> model when that view is constructed). There are edge cases that
need to be handled as well, as you can see in the above demonstration.</p>
<p><strong><em>TODO</em></strong>: When the player reaches the edge of the visible map, make the
application re-route to shift the visible map area (this will force your views
to be rebuilt). For example, if the current route is <code>play/r0/c0</code> and Pikachu
just tried to move to the tile at row 0, col 10,
you might want to shift the map to <code>play/r0/c2</code>. You should do this using
Backbone&#39;s <code>router.navigate</code>
(<a href="http://documentcloud.github.io/backbone/#Router-navigate">docs</a>).
Be sure to pass in the appropriate options for <code>trigger</code> and <code>replace</code> to this
function.</p>
<p>This is the tricky part of the whole assignment, especially the edge
cases. One strategy is to let the <code>Player</code> model know about the visible
map area and have it re-route under certain conditions in its moving functions.</p>
<hr>
<p><strong><em>TODO</em></strong>: Go back to the <code>play</code> route handler you defined earlier. Make it
re-route the application (using <code>navigate</code>) to a map slice centered on the
player&#39;s current position (of the form <code>play/r0/c0</code>).</p>
<p><strong><em>Extra Credit</em></strong> (3pts): create a minimap next to the regular map that shows
you where you are in relation to the whole map (only in &quot;play&quot; mode).</p>
<hr>
<h2 id="map-persistence">Map Persistence</h2>
<p>To persist the state of the map tiles, we&#39;ll use remarkably simple
<code>localStorage</code> API. This is an HTML5 feature that stores information in the
browser to use between sessions. It is a global object available as
<code>window.localStorage</code> that has special getter / setter semantics, but a simple
syntax that works just like objects.</p>
<pre><code>localStorage[&#39;foo&#39;] = &#39;bar&#39;;

console.log(localStorage[&#39;foo&#39;]); // &#39;bar&#39;;
</code></pre><p>The one disadvantage is that it can only store strings, so to <em>store</em> any
array-like or object-like data, you&#39;ll need to use the built-in <code>JSON.stringify</code>
(and <code>JSON.parse</code> to complement this when <em>retrieving</em> data).</p>
<p><strong><em>TODO</em></strong>: Edit the definition of the <code>Builder</code> model to save the current map
tiles to localStorage whenever the tiles change using Model events. Use the
global constant <code>POKEMON.globals.LOCALSTORAGE_KEY</code> to index into the
<code>localStorage</code> object. In addition, edit this model&#39;s <code>initialize</code> method to
parse stored tiles from localStorage if they are available (or fall back to
generating new ones).</p>
<p>Now when you reload your web page, the map tiles should stay in place! Magic!</p>
<p><img src="build/images/gifs/map-persistence.gif" alt="map-persistence"></p>
<p><strong><em>TODO</em></strong>: Add a method to <code>Builder</code> that resets all the map tiles to the default
swatch (essentially erases the whole map). Then, add a Backbone route handler
for the route <code>&#39;reset&#39;</code> that invokes this function. If you implement this
correctly, the map should reset when you click &quot;Reset&quot; in the controls on the
top right of the page.</p>
<hr>
<h3 id="notes">Notes</h3>
<p>If you find yourself spending an inordinate amount of time on this assignment,
please seek help on Piazza, in office hours, or by appointment. </p>
<p>Your final output should function like the demo gif under the &quot;Visible Map Area&quot;
heading above.</p>

      </section>
      <section class="pure-u-3-4 notes server-js-2 language-javascript"><h1 id="more-server-side-javascript">More Server-Side JavaScript</h1>
<p><a href="#server-js">Last lecture</a>, we talked about the building blocks of a web server
in JavaScript. This time, we&#39;ll look into request routing, the Express
framework for Node, and stringing the JavaScript web application stack together.</p>
<h2 id="routing-requests">Routing requests</h2>
<p>Recall the server-side MVC diagram.</p>
<p><img src="http://addyosmani.github.io/backbone-fundamentals/img/webmvcflow_bacic.png" alt="server mvc"></p>
<p>Some kind of URL parsing is certainly necessary to route web requests to various
controller actions / handlers. You might use functions like the following to
inspect parts of the URL and query string (using only core modules):</p>
<pre><code>|                                   url.parse(string).query
|                                           |
|           url.parse(string).pathname      |
|                       |                   |
|                       |                   |
|                     ------ -------------------
http://localhost:8888/start?foo=bar&amp;hello=world
|                               ---       -----
|                                |          |
|                                |          |
|             querystring(string)[&quot;foo&quot;]    |
|                                           |
|                       querystring(string)[&quot;hello&quot;]
</code></pre><p><em>Source: Node Beginner Book</em></p>
<p>You can imagine how we might program our server to send requests for certain
pathnames to different handlers and pass along relevant data (for example, from
the query string).</p>
<p>Now consider a RESTful route like this example we saw a few weeks ago:</p>
<pre><code>/:year/:month/:day/:section/:subsection/:story.html
</code></pre><p><em>Prompt</em>: how would you parse out the relevant bits of data here? Imagine you got
a URL looking like</p>
<pre><code>http://www.nytimes.com/2014/03/05/movies/awardsseason/some-long-story-name.html
</code></pre><p><em>Answer</em>: One way would be to construct some regular expressions from the route
definition above and use them to match on the incoming URL
request route.</p>
<p>With the fundamentals of server-side JS under our belt, we can move onto what
it&#39;s like to build a real web application in Node. As was the case with the DOM
API, you will likely use some kind of abstraction layer to build your web
application...</p>
<hr>
<h2 id="express-js-framework">Express.js framework</h2>
<p>As you might expect from something called a &quot;framework&quot;, Express is an
abstraction over the fundamental web server logic in a Node application.
It&#39;s small, flexible, extensible, and widely used. Mainly, it provides common
HTTP utilities (like a robust router) and <em>middleware</em> APIs (sessions, cookies,
auth, etc.).</p>
<p>The most basic Express server looks something like this:</p>
<pre><code>var express = require(&#39;express&#39;);

// create an app skeleton
var app = express();

// register a route &amp; its handler
app.get(&#39;/hello&#39;, function (req, res) {
  res.send(&#39;Hello World&#39;);
});

// asynchronously start the server
var server = app.listen(3000);
console.log(&#39;Express app listening on port %d&#39;, server.address().port);
</code></pre><p>Requests are routed using functions that mirror the HTTP method names (in the
above example, a <code>GET</code> method). There are no &quot;controllers&quot; built in, but you may
easily create your own.
If we add in some standard <strong>middleware</strong> (a term broadly used to define plugins
for a web framework) and move routes to a separate module, we get something
like this:</p>
<pre><code>// server.js
var express = require(&#39;express&#39;)
  , app     = express()
  , routes  = require(&#39;./routes&#39;);

// Config
// ----------------------------------------------------

// View engine
app.set(&#39;view engine&#39;, &#39;jade&#39;);
app.set(&#39;views&#39;, __dirname + &#39;/views&#39;);

// Logger
app.use(express.logger());

// Get / set user cookies
app.use(express.cookieParser());

// Enable JSON, urlencoded, and multipart request bodies
app.use(express.bodyParser());

// Serve static files
app.use(express.directory(__dirname + &#39;/public&#39;));
app.use(express.static(__dirname + &#39;/public&#39;));


// Routes
// ----------------------------------------------------

app.get(&#39;/&#39;, routes.site.index);


// User routes

app.all(&#39;/users&#39;,           routes.users.list);
app.all(&#39;/user/:id/:op?*&#39;,  routes.users.load);

app.get(&#39;/user/:id&#39;,        routes.users.view);
app.get(&#39;/user/:id/view&#39;,   routes.users.view);
app.get(&#39;/user/:id/edit&#39;,   routes.users.edit);
app.put(&#39;/user/:id/edit&#39;,   routes.users.update);

// Posts routes

app.get(&#39;/posts&#39;,         routes.posts.list);


// Start server
// ----------------------------------------------------
var server = app.listen(3000);
console.log(&#39;Express app listening on port %d&#39;, server.address().port);
</code></pre><p>A few new things are introduced here:</p>
<ul>
<li>a <strong>view engine</strong> is set, in this case the Jade templating engine, which
enables <code>res.render()</code> to render &amp; send HTML pages in responses</li>
<li><code>express.cookieParser()</code>: enables getting / setting cookies</li>
<li><code>express.bodyParser()</code>: enables parsing of request bodies including <code>json</code>,
<code>urlencoded</code>, and <code>multipart</code> middleware (it&#39;s actually just a wrapper for
those three modules)</li>
<li><code>express.directory</code> &amp; <code>express.static</code>: serve directories and their files;
essentially a file browser</li>
</ul>
<p>There&#39;s also another kind of routing function in use: <code>app.all</code>, which
attaches &quot;global&quot; logic to a route. In the above example, if we ever hit a route
which pertains to a specific user, the first handler that gets run will be
<code>router.user.load</code> (presumably, fetch a user&#39;s data from the database, or
a handle for it). The <code>/op?*</code> part of the route will make anything past <code>:id</code>
optional in that route.</p>
<p><strong>Important</strong>: now that there are multiple (asynchronous)
handlers attached to a route, we need to explicitly tell express when one
handler is finished so that the next one can run (it&#39;s impossible to know
otherwise). This is done by calling the <code>next</code> function in a handler. Here&#39;s
what the routes file for the above example might look like:</p>
<pre><code>// routes.js

// assume database functionality is defined elsewhere...
var db = require(&#39;./db&#39;);

module.exports = {

  user {

    list: function (req, res) {
      var users = db.getUsers();
      res.send(&#39;users: &#39; + users.join(&#39;, &#39;));
    },

    load: function (req, res, next) {
      req.user = db.loadUser(req.params.id);
      next();
    },

    view: function (req, res, next) {
      res.send(&#39;viewing user &#39; + req.user.name);
    },

    edit: function (req, res) {
      res.send(&#39;editing user &#39; + req.user.name);
    },

    update: function (req, res) {
      var success = db.updateUser(req.user, req.params);

      if (success) {
        res.send(&#39;user successfully updated&#39;);
      } else {
        res.send(&#39;user update unsucessful&#39;);
      }
    }

  },

  posts: {

    list: function (req, res) {
      res.send(&#39;list of posts&#39;);
    }

  }

};
</code></pre><p>If we didn&#39;t call <code>next()</code> in <code>load</code> above, then the request would hang and
a client wouldn&#39;t get a response on that route.</p>
<hr>
<p>An alternative way to organize routes might be like
<a href="https://github.com/visionmedia/express/blob/master/examples/route-map/index.js">this</a>:</p>
<pre><code>app.map = function (a, route) {
  route = route || &#39;&#39;;

  for (var key in a) {
    switch (typeof a[key]) {

      // { &#39;/path&#39;: {...} }
      case &#39;object&#39;:
        app.map(a[key], route + key);
        break;

      // get: function () {...}
      case &#39;function&#39;:
        if (verbose) console.log(&#39;%s %s&#39;, key, route);
        app[key](route, a[key]);
        break;

    }
  }
};

app.map({
  &#39;/users&#39;: {
    get:          routes.users.list,
    del:          routes.users.del,

    &#39;/:uid&#39;: {
      get:        routes.users.get,

      &#39;/pets&#39;: {
        get:      routes.pets.list,

        &#39;/:pid&#39;: {
          del:    routes.pets.del
        }
      }
    }
  }
});
</code></pre><p>The above example abstracts away the route mapping functions so you can simply
provide a literal map (object) of routes.</p>
<p><em>Note</em>: If in your application you ever need to inspect / reflect upon your
currently defined routes, simply look at the <code>app.routes</code> object.</p>
<p>Middleware isn&#39;t just restricted to framework plugins; there&#39;s such
a thing as <em>route middleware</em>, which act like a chained series of actions on
a route. Notice how errors are passed along the middleware chain as necessary.</p>
<pre><code>// Dummy users
var users = [
    { uid: 0, name: &#39;tj&#39;, email: &#39;tj@vision-media.ca&#39;, role: &#39;member&#39; }
, { uid: 1, name: &#39;ciaran&#39;, email: &#39;ciaranj@gmail.com&#39;, role: &#39;member&#39; }
  , { uid: 2, name: &#39;aaron&#39;, email: &#39;aaron.heckmann+github@gmail.com&#39;, role: &#39;admin&#39; }
];

// Middleware
// --------------------------------------------------------

function fauxAuthentication (req, res, next) {
  req.authenticatedUser = users[0];
  next();
}

app.use(fauxAuthentication);


// Routes middleware
// --------------------------------------------------------

function loadUser (req, res, next) {
  // You would fetch your user from the db
  var user = users[req.params.uid];
  if (user) {
    req.user = user;
    next();
  } else {
    next(new Error(&#39;Failed to load user &#39; + req.params.id));
  }
}

function andRestrictToSelf (req, res, next) {
  // If our authenticated user is the user we are viewing
  // then everything is fine
  if (req.authenticatedUser.uid == req.user.uid) {
    next();
  } else {
    next(new Error(&#39;Unauthorized&#39;));
  }
}

function andRestrictTo (role) {
  return function(req, res, next) {
    if (req.authenticatedUser.role === role) {
      next();
    } else {
      next(new Error(&#39;Unauthorized&#39;));
    }
  }
}

// Routes
// --------------------------------------------------------

app.get(&#39;/&#39;, function (req, res) {
  res.redirect(&#39;/user/0&#39;);
});

app.get(&#39;/user/:id&#39;, loadUser, function (req, res) {
  res.send(&#39;Viewing user &#39; + req.user.name);
});

app.get(&#39;/user/:id/edit&#39;, loadUser, andRestrictToSelf, function (req, res) {
  res.send(&#39;Editing user &#39; + req.user.name);
});

app.del(&#39;/user/:id&#39;, loadUser, andRestrictTo(&#39;admin&#39;), function (req, res) {
  res.send(&#39;Deleted user &#39; + req.user.name);
});
</code></pre><p>Another way to configure the above user loading is to use <code>app.param</code>, which
maps logic to URL parameters. In the below example, any time <code>:user</code> shows up in
an Express route, the callback will be invoked.</p>
<pre><code>app.param(&#39;user&#39;, function (req, res, next, id) {
  User.find(id, function (err, user) {
    if (err) {
      next(err);
    } else if (user) {
      req.user = user;
      next();
    } else {
      next(new Error(&#39;failed to load user&#39;));
    }
  });
});
</code></pre><p><em>Source: <a href="https://github.com/visionmedia/express/blob/master/examples">Express.js examples</a></em></p>
<p>Here&#39;s a rough diagram of how all the above routing &amp; middleware works
together in the web server:</p>
<p><img src="build/images/express-diagram.png" alt="express-diagram"></p>
<h3 id="request-handlers">Request Handlers</h3>
<p>So far, we&#39;ve seen the features of Express that allow us to set up a web server,
its middleware, and routes. Now we deal with the last part of the request loop:
writing handlers that respond to a client with relevant data.</p>
<p>Request handlers are passed two arguments - <code>req</code> and <code>res</code> - which are the
same as the request and response we saw in the barebones Node http server. (As
we saw above, there&#39;s also a third argument, <code>next</code>, used for chaining handler
logic together).
The middleware in an Express application mostly serves to augment the <code>req</code> and
<code>res</code> objects with added functionality. </p>
<ul>
<li><code>req.params</code>: hash of the parsed URL parameters along the whole path</li>
<li><code>req.query</code>: hash of the parsed query string</li>
<li><code>req.route</code>: detailed info about the route, same object as in <code>app.routes</code></li>
<li><code>req.get(field)</code>: HTTP header fields</li>
<li><code>req.accepts(type)</code> / <code>req.accepted</code>: check the accepted media types for the
request</li>
<li><code>req.ip</code>: client IP</li>
</ul>
<p>In a request handler, you&#39;ll want to inspect the request, do some business
logic, and then construct a response. <code>res</code> contains functionality such as:</p>
<ul>
<li><code>res.get</code> / <code>res.set</code>: HTTP header fields</li>
<li><code>res.redirect</code></li>
<li><code>res.send</code>: send an HTML, JSON, XML, etc. response</li>
<li><code>res.render</code>: if a view engine is set, this will invoke the engine and
generate HTML based on locals you pass in or those that have been set through
middleware</li>
</ul>
<hr>
<p><strong>References</strong>:</p>
<ul>
<li><a href="http://addyosmani.github.io/backbone-fundamentals/#creating-the-back-end">Backbone Fundamentals</a></li>
<li><a href="http://howtonode.org/express-mongodb">Express / MongoDB tutorial</a></li>
<li><a href="http://expressjs.com/3x/api.html">Express API reference</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes hw6 language-javascript"><h1 id="homework-6-autocomplete">Homework 6: Autocomplete</h1>
<p>Due <em>Wednesday, November 19 at 9 AM</em>.</p>
<p>Implementation stub available in the
<a href="https://github.com/cis197s14/hw/blob/master/hw6/">homework repository</a>.</p>
<p>This assignment will tie up what you&#39;ve learned about classes, promises, Backbone,
and jQuery into a single widget: an autocompleter (much like the one that is used
for <a href="https://penncoursereview.com/">Penn Course Review</a>).</p>
<h3 id="before-starting-the-assignment">Before starting the assignment</h3>
<p>Review the docs for <a href="http://backbonejs.org/#View">Backbone Views</a>,
the <a href="https://github.com/petkaantonov/bluebird/blob/master/API.md">Bluebird promise API</a>,
and <a href="https://api.jquery.com/jQuery.get/">jQuery&#39;s <code>.get</code> function</a>.</p>
<h3 id="running-the-code">Running the code</h3>
<p>You may need the <a href="https://www.npmjs.org/package/http-server">http-server</a> npm package in order
to run this code because of protocol restrictions (in some browsers, you cannot make an AJAX HTTP
request from a filesystem HTML page). Install it with <code>npm install -g http-server</code> and
run it from you project directory with <code> http-server ./</code>.
Navigate to <a href="http://localhost:8080/">http://localhost:8080/</a> to run your code.</p>
<h3 id="part-1-tries-trie-js-">Part 1: Tries (trie.js)</h3>
<p>The first thing we&#39;ll need to write the autocompleter is an efficient way to store the
valid words to match. The correct data structure here is called a <em>trie</em> (short for
re<em>trie</em>val), and if you&#39;ve taken CIS 121, you&#39;re already familiar with it. Just in case
you&#39;re rusty, though, here&#39;s an <a href="http://exceptional-code.blogspot.com/2011/07/coding-up-trie-prefix-tree.html">excellent article</a>
to help jog your memory. <em>In order to simplify the implementation, we will be using upper-case only.
All words should be converted using <code>toUpperCase()</code> before adding or retreiving.</em></p>
<p>JavaScript conveniently has hashes (object literals) built right in - we&#39;ll use them for
the nodes of our simple trie. The top-level node of the trie (<code>this.data</code> in the stub)
starts out as an empty object. Your job is to implement the <code>addWord</code> and
<code>getSuggestions</code> functions.</p>
<p><strong><em>TODO</em></strong>: Implement <code>addWord</code>. </p>
<p>The pseudocode for adding an element to a node in the trie is:</p>
<pre>
addWord(word, trieNode) =
  1. If word is the empty string:
    1. Add a 'true' node with key "end" (in our case set, trieNode["end"] =  true)
    2. Return
  2. If trieNode does not have a child labeled with the first character of `word`:
    1. Add a child labeled with that character to trieNode
  3. Let `newWord` equal `word` but with the first character removed
  4. Let `newNode` be the child of trieNode labeled with the first character of `word`
  5. Recursively call addWord(newWord, newNode)
</pre>

<p>Call this algorithm starting with the input word and the root of the trie (<code>this.data</code>).
There are some simple test cases in the code to help get you started.
Don&#39;t forget to convert the input to upper case!</p>
<p><strong><em>TODO</em></strong>: Implement <code>getSuggestions</code>.</p>
<p>This one is a little trickier than <code>addWord</code>, and you won&#39;t have pseudocode to guide
you through this time. In order to get the suggestions for a given prefix, you&#39;ll need to first
see if <em>any</em> word starting with the prefix is in the trie by traversing from the root. If there are
words starting with that prefix, then you should return an array of all of them. Keep in mind that in
this trie implementation, having an &quot;end&quot; key means that a node is the end of a valid word in the trie.</p>
<p>If no words are found, then this method should return the empty array.
Again, there are some simple test cases in the code to help get you started.
Again, don&#39;t forget to convert the input to upper case!</p>
<p>Make sure you have implemented Trie correctly before going on to the next part of the assignment.</p>
<h3 id="part-2-ajax-and-promises-promisifiedajaxsimple-js-promisifiedajax-js-">Part 2: AJAX and Promises (promisifiedAjaxSimple.js, promisifiedAjax.js)</h3>
<p>In this section we are going to use promises to grab dictionary data from a public server. Just
like Penn Course Review, the words we are going to work with will be the names of classes at Penn.</p>
<p><strong><em>TODO</em></strong>: Implement <code>ajaxGet</code>.</p>
<p>This function takes in a URL that points to some JSON and returns a promise that resolves to the
JSON data. Use Bluebird; this should be a one-liner.</p>
<p><strong><em>TODO</em></strong>: Implement <code>trieFromURL</code>.</p>
<p>This function takes in a URL that points to some JSON and returns a promise that resolves to a
trie formed from the JSON data. Use ajaxGet; this should be &lt;5 lines.</p>
<p><strong><em>TODO</em></strong>: Implement <code>multiGet</code>.</p>
<p>This method takes in a URL that returns an array of more documents to get, and a base URL for those documents.
Go to <a href="http://cis197.herokuapp.com/departmentURLs.json">cis197.herokuapp.com/departmentURLs.json</a> to see an example.
The method returns a promise for an array that represents all the data from all the documents (do not include
the original document from the URL in this array).</p>
<p>See stub for step-by-step detailed instructions.</p>
<p><strong>HINT</strong>: Use <a href="https://github.com/petkaantonov/bluebird/blob/master/API.md#all---promise">Promise.all</a></p>
<p><strong><em>TODO</em></strong>: Implement <code>trieFromDataPromise</code>.</p>
<p>This method takes in a promise for data (a string array)and returns a trie constructed from that data.
Use multiGet; this should be &lt;5 lines. There is a test case to make sure this method is working correctly.</p>
<h3 id="part-3-appview">Part 3: AppView</h3>
<p>Now that we can make tries from remotely-hosted JSON dictionaries, all that&#39;s left is to implement
the autocompleter in HTML code. Luckily, we&#39;ve taken care of the CSS and the templating for you. All
you need to do is implement a few missing methods on appView.</p>
<p><strong><em>TODO</em></strong>: Define <code>events</code> in AppView.</p>
<p>The events app should do a search (the next method to do) every time a key is pressed. You will
find the <a href="http://backbonejs.org/#View">Backbone Views documentation</a> useful here!</p>
<p><strong><em>TODO</em></strong>: Define a <code>search</code> in AppView.</p>
<p>This function should be called every time a keypress is detected. It will use the trie promise
passed in during view initialization to give back suggestions for autocompletion and then call
<code>render</code> with the suggestions array as an argument.</p>
<p>When you&#39;re all done it should look something like this:</p>
<p><img src="https://i.imgur.com/aBziSGM.gif" alt="Demo"></p>
<p>You can comment/uncomment the two different implementations (one JSON file vs. multiple JSON files)
in <strong>main.js</strong> (this demo uses the one-file implementation);</p>
<h3 id="notes">Notes</h3>
<p>As a general rule, please remove &quot;TODO&quot; comment blocks after you implement that
portion of the assignment.</p>
<p><strong><em>Extra Credit</em></strong> (3pts): Implement &quot;ExtraCreditTrie&quot; (in ExtraCreditTrie.js). This trie functions
very similarly to the simple trie that we implemented in part 1, except that it is
<strong>partially case-insensitive</strong>. That is, the trie distinguishes between different capitalizations
when adding words; but when getting suggestions, it returns <em>all</em> matches, <em>regardless of case</em>,
  <em>in the original case they were added</em>.</p>
<p>To give a concrete example: you could add &quot;PennApps&quot;, &quot;Upenn&quot;, and &quot;Pennapps&quot; to an ExtraCreditTrie. Then running
getSuggestions(&#39;penn&#39;) would return the array [&quot;PennApps&quot;, &quot;Pennapps&quot;].</p>
<p><strong><em>Extra Credit</em></strong> (2pts): Modify ExtraCreditTrie so that it can start matching at any point in the
a word. For instance, you could add &quot;PennApps&quot;, &quot;Upenn&quot;, and &quot;pineapple&quot; to an ExtraCreditTrie. 
Then running getSuggestions(&#39;app&#39;) would return the array [&quot;PennApps&quot;, &quot;pineapple&quot;].</p>

      </section>
      <section class="pure-u-3-4 notes hw7 language-javascript"><h1 id="homework-7-product-hunt-client-in-react-js">Homework 7: Product Hunt Client in React.js</h1>
<p>Due <em>Wednesday, December 3 at 9 AM</em>.</p>
<p>Implementation stub available in the
<a href="https://github.com/cis197s14/hw/blob/master/hw7/">homework repository</a>.</p>
<p>This assignment will show you the power and awesomeness of <a href="http://reactjs.org">React.js</a>. You 
will be implementing an entirely client side Product Hunt reader. 
<a href="http://www.producthunt.com/">Product Hunt</a> is a link aggregator much like Hacker News, Reddit, 
and Twitter where products (read: <em>apps</em>) are posted and voted on. We&#39;ll be writing a Product 
Hunt client that lets us see today&#39;s top posts and view any of the posts&#39; top level comments.</p>
<p>For this assignment, I&#39;ve provided <strong>two API endpoints</strong>. One fetches the post data and can 
be found here: <a href="http://ph-api.herokuapp.com/posts">http://ph-api.herokuapp.com/posts</a>. 
The other fetches comment data and can be found here: 
<a href="http://ph-api.herokuapp.com/comments?post_id=11287">http://ph-api.herokuapp.com/comments?post_id=11287</a>. 
Notice that the second endpoint requires a <code>post_id</code> parameter to be passed in the URL. 
The <code>post_id</code> parameter specifies which post&#39;s comments you are looking for.</p>
<p>Our client is going to display the posts we get from the posts API endpoint and let the user 
select which post he wants to read the comments for. There can only be one selected post at 
a time which means only one post&#39;s comments can be shown at a time.</p>
<p>The final product should look like this:</p>
<p><img src="http://i.imgur.com/uL9mbNy.gif" alt="Demo"></p>
<h3 id="running-the-code">Running the code</h3>
<p>As in the last homework, you may need the <a href="https://www.npmjs.org/package/http-server">http-server</a>
npm package in order to run this code because of protocol restrictions (in some browsers,
you cannot make an AJAX HTTP request from a filesystem HTML page). Install it with 
<code>npm install -g http-server</code> and run it from you project directory with 
<code> http-server ./</code>. Navigate to <a href="http://localhost:8080/">http://localhost:8080/</a> 
to run your code.</p>
<h3 id="part-1-static-site">Part 1: Static Site</h3>
<p>Complete the <code>render</code> function of the App component so that it renders some Post components. 
Feel free (and I encourage you) to pass in dummy data into the Post components to see just how 
they&#39;re rendered. You can grab post data from the <a href="http://ph-api.herokuapp.com/posts">posts API endpoint</a>. </p>
<h3 id="part-2-figuring-out-state">Part 2: Figuring out State</h3>
<p>You are going to need to figure out what state your application needs to keep track of. Again, 
React.js uses state and the <code>setState</code> function to figure out when to re-render certain views. 
To help you figure out what state you need, try to think of any variables that will be 
changing. Those variables will comprise your state object.</p>
<p>Once you think you&#39;ve got it, modify the <code>getInitialState</code> function of the App component 
to return the correct initial state. You can think of the initial state of your entire 
application as the state before the first AJAX call is executed.</p>
<h3 id="part-3-manipulating-state">Part 3: Manipulating State</h3>
<p>Once you&#39;re setting the correct initial state, finish the <code>componentDidMount</code> function 
of the App component to load the post data from the 
<a href="http://ph-api.herokuapp.com/posts">posts API endpoint</a> and set the state 
appropriately (use <code>setState</code> to set the state). Again, <code>componentDidMount</code> is a function that&#39;s 
executed once a component has been rendered.</p>
<p>Now, you should see that as soon as the AJAX request loads, the state should be set and the 
Post components should re-render (make sure to hook up the Post components with real data).</p>
<h3 id="part-4-manipulating-state-with-comments">Part 4: Manipulating State with Comments</h3>
<p>Keep in mind that you only need to show the currently selected post&#39;s comments.</p>
<p>Once you have the post data, attach a click handler to the <code>&lt;li&gt;</code> component within Post. Every time 
a post is clicked, your application should fetch the comments for the clicked post from the server 
and render the Comments component directly under the clicked post (again, think of state). Also, 
as in class and the React tutorial, make sure to keep in mind that only the App component can 
change the state so make sure to pass down a callback from App to Post through the properties.</p>
<p>As a finishing touch, use the same click handler from the <code>&lt;li&gt;</code> component to enable toggling 
comments so you can hide the currently selected post&#39;s comments by clicking on the post a 
second time.</p>
<h3 id="notes">Notes</h3>
<p><strong>Extra Credit</strong> (2pts): Implement a cache so that once you fetch a post&#39;s comments once from 
the server you don&#39;t have to fetch that same post&#39;s comments directly from the server again.</p>

      </section>
      <section class="pure-u-3-4 notes proposal language-javascript"><h1 id="final-project-proposal">Final Project Proposal</h1>
<p>Due <em>Wednesday, December 3 at 9AM</em>.</p>
<p>The final project will be an opportunity to work on any kind of JavaScript
project of your choosing that demonstrates the things you learned this
semester. These projects will generally fall into one of 3 categories:</p>
<ol>
<li>Client-heavy application (like a game or other complex UI).</li>
<li>Full-stack application (that does something interesting with the internet,
maybe with a 3rd party API)</li>
<li>Node.js application or library</li>
</ol>
<p>You are welcome to use any JavaScript framework, including Backbone, its
extensions, Express.js, and others.</p>
<p><em>Another option</em> altogether is to contribute to an open source JavaScript
framework or library. See some ideas below.</p>
<h4 id="ideas-to-get-you-started">Ideas to get you started</h4>
<ul>
<li>Browser-based game (more full-fledged Pokémon, Chess, Sudoku, Connect 4,
Othello, etc.) or game AI</li>
<li>Interactive data visualization (like
<a href="http://www.nytimes.com/newsgraphics/2013/12/30/year-in-interactive-storytelling/">New York Times stuff</a>)</li>
<li>Chrome extension to add better UI functionality to an existing web app
(like Gmail, Google Calendar, Facebook, Twitter, etc.)</li>
<li>Mobile web application (a new one or a rewrite of an existing mobile app)</li>
<li>Desktop application written in JS using
<a href="https://github.com/rogerwang/node-webkit">node-webkit</a></li>
</ul>
<h4 id="resources-for-inspiration">Resources for inspiration</h4>
<ul>
<li><a href="http://www.chromeexperiments.com/">Chrome Experiments</a></li>
<li><a href="https://developer.mozilla.org/en-US/demos/">Mozilla Demo Studio</a></li>
</ul>
<h4 id="useful-interesting-libraries-to-use-or-hack-on">Useful / interesting libraries to use or hack on</h4>
<ul>
<li><a href="http://d3js.org">D3</a> (data visualization library)</li>
<li><a href="http://threejs.org/">three.js</a> (3D library)</li>
<li><a href="http://leafletjs.com/">Leaflet</a> (interactive maps)</li>
<li><a href="http://hpneo.github.io/gmaps/">gmaps.js</a> (Google Maps abstraction)</li>
<li><a href="http://code.shutterstock.com/rickshaw/">Rickshaw</a> (charts / graphs)</li>
<li><a href="http://www.chartjs.org/">Chart.js</a> (charts / graphs)</li>
<li><a href="http://raphaeljs.com/">Raphael</a> (vector graphics library)</li>
<li><a href="http://paperjs.org/">Paper.js</a> (vector graphics library)</li>
<li><a href="http://packery.metafizzy.co/">Packery</a> (bin-packing layout)</li>
<li><a href="http://labs.hyperandroid.com/static/caat/">CAAT</a> (animation toolkit)</li>
<li><a href="http://qiao.github.io/PathFinding.js/visual/">PathFinding.js</a> (path finding for games, etc.)</li>
<li><a href="https://github.com/subprotocol/verlet-js">verlet-js</a> (physics engine)</li>
<li><a href="http://janpaepke.github.io/ScrollMagic/">ScrollMagic</a> (UI scrolling)</li>
<li><a href="https://github.com/tildeio/rsvp.js">RSVP.js</a> (promises)</li>
<li><a href="https://github.com/sjkaliski/numbers.js">Numbers.js</a> (adv. Math library)</li>
<li><a href="http://lodash.com/">Lodash</a> (utility belt that&#39;s better than Underscore)</li>
<li><a href="http://momentjs.com/">Moment.js</a> (date library)</li>
<li><a href="http://handlebarsjs.com/">Handlebars.js</a> (templating)</li>
<li><a href="http://marionettejs.com/">Backbone.Marionette</a> (Backbone extension)</li>
<li><a href="http://emberjs.com/">Ember</a> (MV* framework)</li>
<li><a href="http://angularjs.org/">AngularJS</a> (MV* framework)</li>
<li><a href="http://facebook.github.io/react/">React</a> (UI library)</li>
<li><a href="https://github.com/mozilla/brick">Brick</a> (web UI components)</li>
<li><a href="http://socket.io/">Socket.io</a> (WebSockets for Node)</li>
<li><a href="https://github.com/jaredhanson/passport">Passport</a> (authentication for Node)</li>
<li><a href="https://www.meteor.com/">Meteor</a> (realtime full-stack JS)</li>
<li><a href="http://getbootstrap.com/">Bootstrap</a> (style &amp; layout library)</li>
<li><a href="http://foundation.zurb.com/">Foundation</a> (style &amp; layout library)</li>
<li><a href="http://harvesthq.github.io/chosen/">Chosen</a> (better select boxes)</li>
<li><a href="http://amsul.ca/pickadate.js/">pickadate.js</a> (better date picker)</li>
<li><a href="http://github.hubspot.com/messenger/">Messenger</a> (UI notifications, alerts)</li>
<li><a href="http://parsleyjs.org/">Parsley</a> (form validation)</li>
<li><a href="http://craig.is/killing/mice">Mousetrap</a> (capture user input)</li>
<li><a href="https://github.com/defunkt/jquery-pjax">jquery-pjax</a> (pushState + ajax)</li>
<li><a href="http://www.listjs.com/">List.js</a> (adv. functionality for UI lists)</li>
<li><a href="http://twitter.github.io/typeahead.js/">typeahead.js</a> (autocomplete library)</li>
<li><a href="http://daneden.github.io/animate.css/">Animate.css</a> (CSS animations)</li>
<li><a href="http://github.hubspot.com/offline/docs/welcome/">Offline.js</a>
(handle offline behavior)</li>
</ul>
<p>Also check out <a href="https://github.com/explore">Github explore</a> for more
libraries.</p>
<h4 id="other-open-source-projects-to-hack-on">Other open source projects to hack on</h4>
<ul>
<li><a href="http://mondrian.io/">Mondrian.io</a> vector drawing app</li>
<li><a href="http://brackets.io/">Adobe Brackets</a> code editor</li>
<li><a href="http://ace.c9.io/">Ace</a> code editor</li>
<li><a href="https://github.com/TryGhost/Ghost">Ghost</a> blogging platform</li>
<li><a href="https://github.com/etsy/statsd">statsd</a> stats aggregator daemon</li>
</ul>
<p>You might get some more ideas by looking at the
<a href="https://github.com/search?l=JavaScript&amp;p=1&amp;q=stars%3A%3E1&amp;s=stars&amp;type=Repositories">most popular Github repositories</a>.</p>
<p>If you need to brush up on HTML/CSS for the purpose of designing a nice
front end interface, I recommend
<a href="http://learn.shayhowe.com/advanced-html-css/">An Advanced Guide to HTML &amp; CSS</a>.</p>
<hr>
<h2 id="proposal-specification">Proposal Specification</h2>
<p>By <em>December 3rd at 9AM</em>, please submit a project proposal outlining your ideas
and aspirations for the final project. Your submission should have at least
300 words. Try to answer questions like the following:</p>
<ul>
<li>What kind of project do you propose?</li>
<li>What do you hope to learn from the project?</li>
<li>What are some concrete goals, i.e. how will we judge the success of your
project?</li>
<li>(If you&#39;re contributing to an open source project) Which bugs are you
fixing? Which additional features are you implementing?</li>
</ul>
<p>In addition, we expect you to do some project research at this point and
include a rough outline of your implementation plans. You might answer
questions like:</p>
<ul>
<li>Which libraries will you use?</li>
<li>Which JavaScript design patterns will be important (e.g., MVC)?</li>
<li>What will the interface look like (visual and/or programmatic)? We&#39;d love to
see UI mockups if you have them.</li>
</ul>
<h4 id="submission-instructions">Submission instructions</h4>
<p>To create this submission, please create a new branch in your homework repo
called <code>final</code>. Add a folder at the root called <code>final/</code> and markdown document
within this folder called <code>proposal.md</code>.  (If you don&#39;t know markdown syntax,
<a href="http://daringfireball.net/projects/markdown/syntax">check it out here</a>.
It&#39;s fairly easy to learn and considered useful language for simple
documents -- this website is powered by markdown.)</p>
<p>If you plan on including any images in the proposal, please organize them
into a folder at <code>final/images</code> and use markdown&#39;s image linking syntax.
Markdown support is built into Github so if you created your document
correctly, it should show up nicely formatted when you access the <code>.md</code> file
on the Github website.</p>
<p>Submit the new file(s) using a pull request called &quot;Final Project Proposal&quot;
<strong>from the <code>final</code> branch to the <code>master</code> branch</strong>.</p>
<hr>
<h2 id="proposal-1-on-1s">Proposal 1-on-1s</h2>
<p>After you&#39;ve submitted your proposal, please <a href="mailto:veg@seas.upenn.edu">email me</a> 
your availabilities over the next week (from Dec 7th to Dec 10th) so we can arrange 
a meeting to talk about your proposal.</p>
<hr>
<h2 id="project-demos">Project Demos</h2>
<p>The demo day time slot is <strong>December 16th from 6 - 8pm in Levine 307</strong>. We&#39;ll get
a room and have some food / drinks. It&#39;ll be fun and you&#39;ll get to see what
cool things your classmates built.</p>
<p>You will be required to submit your final code (due on demo day).</p>
<hr>
<h2 id="final-project-grading">Final Project Grading</h2>
<ul>
<li><p>(15%) <strong>Project Proposal</strong>: Your proposal should be on time, answer the
important questions about the project, and show evidence of some research.</p>
</li>
<li><p>(25%) <strong>Style</strong>: Your project should use good code style and be properly
documented.</p>
</li>
<li><p>(25%) <strong>Correctness</strong>: Your project should be free of errors and should
correctly accomplish whatever it is supposed to accomplish. This means that
if the deadline is looming, your time would be better spent fixing bugs in
what you already have than adding one last feature.</p>
</li>
<li><p>(35%) <strong>Effort / Accomplishment</strong>: We will be looking for evidence that you
put energy and effort (~10-15 hours per person) into your project and that you have
learned something. This is where the document you submit along with your
project comes in: be sure to use it to highlight work you did and things you
learned, especially if it is not obvious from looking at the final product.
For example, if you spent two hours trying an approach that ultimately did
not work, you should write about that and what you learned from the
experience. However, we will not necessarily look with sympathy on
<em>unnecessary</em> work: for example, if you spent five hours trying to track
down a bug without asking for help, that’s just plain silly stubbornness.
If you are stuck on something, please ask for help. We want you to spend
your time making progress on your project, not banging your head against a
wall (although a small amount of head-banging can be healthy).</p>
</li>
</ul>

      </section>
      <section class="pure-u-3-4 notes lecture8 language-javascript"><h1 id="scaling-client-side-applications">Scaling Client-Side Applications</h1>
<h3 id="module-systems-in-the-browser">Module systems in the browser</h3>
<p>By now, we&#39;ve experienced the benefits that module systems can provide in
JavaScript. Thing is, these only exist in platforms like Node.js, where
standards are loose (or nonexistent).
Browser implementations of JavaScript, which follow the ECMAScript standard,
don&#39;t have built-in support for modules yet (it&#39;s coming soon in ES6, though).
Luckily, the JS community has come up with some good workarounds. The most
popular is the <a href="http://requirejs.org/">require.js library</a>, which is an
implementation of the <strong>Asynchronous Module Definition (AMD)</strong> standard.</p>
<p>With <strong>requireJS</strong> (and in particular, its optional CommonJS syntax), you can
write client-side JS modules much like you would write node modules (the
functions <code>define</code> and <code>require</code> are globally exposed by requireJS).</p>
<pre><code>// scripts/main.js
define(function (require, exports, module) {

  var $ = require(&#39;jquery&#39;),
      _ = require(&#39;underscore&#39;);

  function init () {
    // do stuff
  }

  exports.init = init;

});
</code></pre><p>This script would be loaded onto the page not with a <code>&lt;script&gt;</code> tag, but by the
requireJS asynchronous loader. Below, the <code>data-main</code> attribute tells requireJS
to load <code>scripts/main.js</code> after <code>require.js</code> loads.</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Sample RequireJS Project&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- ... --&gt;

    &lt;!-- load scripts --&gt;
    &lt;script data-main=&quot;scripts/main&quot; src=&quot;scripts/require.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><em>Note</em>: to load jQuery and Underscore with the exact syntax as shown above, an
additional shim would be needed to let requireJS know where those libraries live
in the application.</p>
<p>For a more thorough walkthrough on getting requireJS set up, refer to the
<a href="http://requirejs.org/docs/start.html">docs</a>.</p>
<hr>
<h3 id="backbone-events">Backbone Events</h3>
<p>I feel it&#39;s necessary at this point to do a deeper review of Backbone Events.
While you may have not felt the need to use them very heavily in your homework
thus far, they become very useful in larger applications for control
architecture.</p>
<p>Fundamentally, Events are an inversion of control. Rather than reaching
a statement in code and calling another function...</p>
<pre><code>function doStuff () {
  // ...
  doSomeOtherStuff();
  // ...
}
</code></pre><p>you tell some part (or all) of your application that an &quot;event&quot; occurred:</p>
<pre><code>_.extend(app, Backbone.Events);

function doStuff () {
  // ...
  app.trigger(&#39;stuff-happened&#39;);
  // ...
}

app.on(&#39;stuff-happened&#39;, doSomeOtherStuff);
</code></pre><p>Notice how <code>doStuff</code> now doesn&#39;t have to know about what kinds of external
things should happen in the case of the <code>&#39;stuff-happened&#39;</code> event. As long as the
modules in your app can agree on a common events &quot;interface&quot;, you can use a
system like this to enable separation of concerns. Indeed, this is one of the
more powerful features of Backbone since it allows your business logic to be
completely unaware of how the UI works. <em>Events are leveraged in all
consequential front-end applications because they allow you to write modular,
reactive code.</em></p>
<p><code>Backbone.Events</code> is mixed into almost all other Backbone classes, including:</p>
<ul>
<li><code>Backbone</code></li>
<li><code>Backbone.Model</code></li>
<li><code>Backbone.Collection</code></li>
<li><code>Backbone.View</code></li>
<li><code>Backbone.Router</code></li>
<li><code>Backbone.History</code></li>
</ul>
<p>Remember that events can also pass along data to their handlers simply as
a second argument to <code>trigger</code>.</p>
<p><em>Note</em>: since <code>Backbone</code> is globally available in your app, you can use it as
a simple universal event bus or pub/sub system!</p>
<pre><code>function doStuff () {
  Backbone.trigger(&#39;stuff-happened&#39;, {
    how_much: &#39;lots of&#39;
  });
}

Backbone.on(&#39;stuff-happened&#39;, function (params) {
  var how_much = params.how_much || &#39;some&#39;;
  console.log(&#39;yo, &#39; + how_much + &#39; stuff happened!&#39;);
});
</code></pre><p>Of course you are able to <em>unsubscribe</em> from events using the <code>off</code> method (and
you can also remove a <em>specific</em> event handler by passing that handler function
as a second argument).</p>
<pre><code>Backbone.off(&#39;stuff-happened&#39;);

Backbone.off(&#39;all&#39;, someUniversalHandler);
</code></pre><p>There&#39;s another way for &quot;evented&quot; objects (those with <code>Backbone.Events</code> mixed in)
to listen to events as well. Consider a situation from the Pokémon game we&#39;ve
been building:</p>
<pre><code>builderView.listenTo(builder, &#39;change:selectedSwatch&#39;, function (attrs) {
  // ...
});
</code></pre><p>Subscribe / unsubscribe now become <code>listenTo</code> / <code>stopListening</code>, and you can see
that we can &quot;direct&quot; our listening toward an object.
The reasons why you might want to use <code>listenTo</code> instead of <code>on</code> have to do with
memory management and garbage collection.</p>
<h4 id="view-management">View management</h4>
<p>Typically, to clean up a Backbone view, you simply call <code>.remove()</code>, which
delegates to jQuery&#39;s <code>.remove</code>, thereby destroying the DOM element, its data in
the DOM, and attached event handlers.</p>
<p>If there are multiple views attached to a DOM element, you might instead call
<code>.undelegateEvents()</code> for just one of them and remove any links to that view in
your code (so that it gets garbage collected).</p>
<p>Take a look at
<a href="http://documentcloud.github.io/backbone/docs/backbone.html#section-128"><code>Backbone.View.remove</code></a>
in the source -- it calls <code>stopListening()</code> on itself, which will remove any
event listeners you have bound using <code>.listenTo</code> or <code>.on</code>. <strong>It will not,
however, remove any listeners that another object has &quot;directed&quot; towards the
view</strong>. Some code to illustrate the point:</p>
<pre><code>var myModel = new Backbone.Model({ foo: &#39;bar&#39; }),
    myView  = new Backbone.View({ model: myModel });

$(&#39;body&#39;).append(myView.render().$el);

myModel.on(&#39;change:foo&#39;, function (attrs) {
  myView.render();
});

myModel.listenTo(myView, &#39;some-view-event&#39;, function (params) {
  myModel.sync();
});

myView.remove();
</code></pre><p><em>Neither of the event listeners above will be unbound</em> when
<code>myView</code> is removed. This means that <code>myModel</code> will retain a reference to
<code>myView</code> in JavaScript and <strong>the garbage collector won&#39;t destroy the view</strong>.
This is a <strong>memory leak</strong> and is considered a <strong>Bad Thing</strong> in any programming
environment.</p>
<p><strong><em>Lessons to be learned</em></strong>: every <code>on</code> or <code>listenTo</code> in your application should
be matched by a corresponding <code>off</code> or <code>stopListening</code> call to ensure
bulletproof memory management. When you need a view to react to a model,
recognize the tradeoff between using <code>model.on</code> and <code>view.listenTo</code>.</p>
<p>For more information about view &quot;zombies&quot; that cause memory leaks like this,
check out
<a href="http://lostechies.com/derickbailey/2011/09/15/zombies-run-managing-page-transitions-in-backbone-apps/">this article</a>.
It&#39;s from 2011 though, so be wary of changes in Backbone style / syntax that
have occurred since then.</p>
<hr>
<h3 id="common-client-side-problems-solutions">Common client-side problems &amp; solutions</h3>
<p>As we&#39;ve seen thus far, Backbone is a small library; as such, it doesn&#39;t solve
all the front end UI programming problems that you might encounter in building
complex applications.
Many of the common issues you&#39;ll deal with will have to do with views and view
management. Much is adapted from the <a href="http://addyosmani.github.io/backbone-fundamentals/#common-problems-solutions">Backbone Fundamentals
book</a>.</p>
<h4 id="create-and-render-sub-views">Create and render sub-views</h4>
<ol>
<li><p>The simplest method to create a &quot;sub-view&quot; is through direct DOM-level
inheritance:</p>
<pre><code> var MyView = Backbone.View.extend({

   tmpl: _.template($(&#39;#my-view-template&#39;).html()),

   initialize: function () {
     this.subView = new SubView({
       model: this.model.get(&#39;sub-model&#39;)
     });
   },

   render: function () {
     this.$el.empty();
     this.$el.html(this.tmpl(this.model.toJSON()));

     this.$el.append(this.subView.$el);
     this.subView.render();
   }

 });
</code></pre><p>Note that by rendering <code>this.subView</code> after placing its element in the DOM,
we can utilize rendering logic that sizes the sub-view based on the
dimensions of another element in the page.</p>
</li>
<li><p>You might use <code>setElement</code> instead here, but that has a few tradeoffs
(agnostic to DOM element order, but you can&#39;t specify things like tag name,
etc.)</p>
<pre><code> render: function () {
   // ...
   this.subView.setElement(&#39;.sub-view-container&#39;).render();
 }
</code></pre></li>
<li><p>Here&#39;s another solution that can potentially affect performance:</p>
<pre><code> var MyView = Backbone.View.extend({

   // ...

   initialize: function () {
     this.render();
   },

   render: function () {
     this.$el.html(template);
     this.subView = new SubView();
     this.$el.append(this.subView.$el);
   }

 });

 var SubView = Backbone.View.extend({
   initialize: function () {
     this.render();
   },

   render: function () {
     this.$el.html(template);
   }
 });
</code></pre></li>
</ol>
<p>Looking at these options, we find that #1 is generally preferred. Sub-views
don&#39;t have to be re-initialized when the outer view is rendered
(re-initializations have the potential to cause memory leaks and issues with
existing event bindings). Also, views rendering logic is able to reliably assume
that a view&#39;s element already exists in the DOM.</p>
<h4 id="accessing-models-in-child-views">Accessing models in child views</h4>
<p>Once you start having sub-views as shown above, you may end up needing to create
a model hierarchy as well. This wasn&#39;t the case in the Pokémon homework, but
let&#39;s say we had a <code>Palette</code> model separate from the <code>Builder</code> model.</p>
<pre><code>var Builder = Backbone.Model.extend({

  initialize: function () {
    this.palette = new Palette();
    this.palette.parent = this;
  }

});
</code></pre><p>If we maintain a <code>.parent</code> model link like this, then <code>palette</code> can easily
access the <code>builder</code> model as necessary.</p>
<pre><code>var Palette = Backbone.Model.extend({

  initialize: function () {
    this.on(&#39;change:selectedSwatch&#39;, function (attrs) {
      this.parent.trigger(&#39;selectSwatch&#39;, attrs.selectedSwatch);
    });
  }

});
</code></pre><p>Similarly, we can create a link to parent views.</p>
<pre><code>var BuilderView = Backbone.View.extend({

  initialize: function () {
    this.paletteView = new PaletteView({
      model: palette
    });

    this.paletteView.parentView = this;
  },

  render: function () {
    // ...
    this.$el.append(this.paletteView.$el);
    this.paletteView.render();
  },

  // ...

});

var PaletteView = Backbone.View.extend({

  events: {
    &#39;click .swatch&#39;: &#39;onSwatchClick&#39;
  },

  initialize: function () {
    this.listenTo(this.model.parent, &#39;reset&#39;, this.render);
  },

  onSwatchClick: function () {
    this.parentView.notify();
  },

  // ...

});
</code></pre><p>Keep in mind that this kind of indirection is most times best handled with
events (it keeps code modular), but you may come across scenarios where direct
hierarchical access to models and views is helpful.</p>
<h4 id="refreshing-a-parent-view-within-a-child-view">Refreshing a parent view within a child view</h4>
<p>Once you have this <code>parentView</code> link and come across a point in your application
where a sub-view event should trigger a parent-view render, you may be tempted
to call</p>
<pre><code>this.parentView.render();
</code></pre><p>This will probably work right off the bat. However, if you want inversion of
control and more modularity, you&#39;ll want to use events.</p>
<pre><code>// Parent initialize
this.listenTo(this.subView, &#39;refreshAll&#39;, this.render);

// Parent removal
this.stopListening(this.subView, &#39;refreshAll&#39;);
</code></pre><h4 id="disposing-of-view-hierarchies">Disposing of view hierarchies</h4>
<p>If you have nested views, it would be nice to be able to simply call a <code>close</code>
function on the top-level view to be able to dispose of the entire hierarchy.</p>
<pre><code>Backbone.View.prototype.close = function () {
  if (this.onClose) {
    this.onClose();
  }
  this.remove();
};

var ListView = Backbone.View.extend({

  tagName: &#39;ul&#39;,

  initialize: function (params) {
    this.childViews = params.children || [];
  },

  renderChildren: function (itemView) {
    this.$el.append(itemView.$el);
    this.childViews.push(itemView.render());
  },

  onClose: function () {
    _(this.childViews).invoke(&#39;close&#39;);
  }

});

var ListItemView = Backbone.View.extend({
  tagName: &#39;li&#39;,

  render: function () {

  }
});

var myView = new MyView({
  children: [
    new ListItemView(),
    new ListItemView()
  ]
});

myView.render();
myView.renderChildren();
myView.close();
</code></pre><h4 id="working-with-nested-models-collections">Working with nested models &amp; collections</h4>
<p>The fact that Backbone doesn&#39;t support nested models / collections nicely out of
the box is somewhat of an endorsement for simpler client-side models. However,
if you do find yourself with nested data structures, here&#39;s how you might
build your models. Imagine you are modeling &quot;rooms&quot; inside &quot;buildings&quot; on the
client.</p>
<pre><code>var Rooms = Backbone.Collection.extend({
  // ...
});

var Building = Backbone.Model.extend({

  initialize: function () {
    this.rooms = new Rooms();
    this.rooms.url = &#39;/building/&#39; + this.id + &#39;/rooms&#39;;
    this.rooms.on(&#39;reset&#39;, this.updateCounts);
  },

  // ...

});

var townHall = new Building();

// lazy load the building&#39;s rooms
townHall.rooms.fetch({
  reset: true
});
</code></pre><p>Note that there are some Backbone plugins, such as
<a href="https://github.com/PaulUithol/Backbone-relational">Backbone Relational</a>, which
allow you to set up different kinds of relations (much like a relational
database) for your models. For example, it relieves the issues around chained
model getters like this:</p>
<pre><code>this.model.get(&#39;player&#39;).get(&#39;position&#39;)....
</code></pre><h4 id="inheritance-in-backbone-views-and-models">Inheritance in Backbone views and models</h4>
<p>We&#39;ve been using Backbone inheritance in the form of <code>Backbone.*.extend</code> without
looking at it too closely. This method (inspired by the <code>inherits</code>
function in the Google Closure Library) is designed to mimic classical
object-oriented inheritance with some prototypical stuff thrown in; there are
some nuances you might want to take note of.
<a href="http://documentcloud.github.io/backbone/docs/backbone.html#section-190">Link to its source</a>.</p>
<ul>
<li>Properties and methods are <em>copied</em> from one object to another, not passed by
reference.</li>
<li>Instance methods of a child are checked for a <code>constructor</code>. If not present,
the parent&#39;s <code>constructor</code> is copied.</li>
<li>A <code>__super__</code> property is assigned on the child (this makes it compatible with
Coffeescript classes)</li>
</ul>
<p>You are able to simply inherit from other views / models like so:</p>
<pre><code>var PlayerView = Backbone.View.extend({
  initialize: function (params) {
    console.log(&#39;player init&#39;);
    this.row = params.row || 0;
    this.col = params.col || 0;
    this.orientation = &#39;right&#39;;
  }
});

var PikachuView = PlayerView.extend({
  initialize: function (params) {
    PlayerView.prototype.initialize.call(this, params);
    console.log(&#39;pikachu init&#39;);
    this.orientation = &#39;down&#39;;
  }
});

var playerView  = new PlayerView(),
    pikachuView = new PikachuView();
</code></pre><p>Note how it was necessary to explicitly call a parent view&#39;s method to
re-invoke some functionality if that method was overriden in the child view.
This can be cumbersome as our apps scale. Here&#39;s a proposed improvement:</p>
<pre><code>var PlayerView = function (params) {
  console.log(&#39;player init&#39;);
  this.row = params.row || 0;
  this.col = params.col || 0;
  this.orientation = &#39;right&#39;;

  Backbone.View.apply(this, params);
};

_.extend(PlayerView.prototype, Backbone.View.prototype, {
  // all of PlayerView&#39;s methods go here
  orient: function (dir) {
    this.orientation = dir;
  }
});

PlayerView.extend = Backbone.View.extend;

var PikachuView = PlayerView.extend({
  initialize: function (params) {
    console.log(&#39;pikachu init&#39;);
    this.orientation = &#39;down&#39;;
  }
});

var pikachuView = new PikachuView();
pikachuView.orient(&#39;right&#39;);
</code></pre><p>Neat! <code>_.extend</code> saved us a lot of time and redundant code.</p>
<hr>
<h3 id="marionettejs">MarionetteJS</h3>
<p>Marionette is a Backbone extension that provides APIs and functionality for many
of the most common situations &amp; architectures in a non-trivial Backbone.js app.
For example, it has a notion of nested views and abstractions for view life
cycle management. If you write more Backbone apps, you&#39;ll find yourself writing
the same boilerplate over and over again. Marionette will help you reduce this
boilerplate code. Studying its functionality may help you to more easily gain
access to the more complex &amp; prescriptive front end frameworks (Ember,
AngularJS, etc).</p>
<p><a href="http://marionettejs.com/">Make your Backbone applications dance!</a></p>
<hr>
<h4 id="references">References</h4>
<ul>
<li><a href="http://addyosmani.github.io/backbone-fundamentals">Backbone Fundamentals</a>
Events, Common Problems &amp; Solutions</li>
<li><a href="http://eloquentjavascript.net/chapter9.html">EloquentJS, Chapter 9</a></li>
<li><a href="http://speakingjs.com/es5/ch31.html">Speaking JS, Chapter 31</a></li>
</ul>

      </section>
      <section class="pure-u-3-4 notes lecture9 language-javascript"><h1 id="advanced-js-programming-topics">Advanced JS Programming Topics</h1>
<h2 id="motivation-for-asynchronous-abstraction">Motivation for Asynchronous Abstraction</h2>
<p>I&#39;m going to start with a simple example of asynchronous programming and build
up to something not-so-simple that presents all sorts of problems in our current
model of async JavaScript.</p>
<p>Let&#39;s say we&#39;re trying to read a file in Node. We might create a wrapper for the
<code>fs.readFile</code> function like this:</p>
<pre><code>function read (name) {
  fs.readFile(name, function (err, data) {
    if (err) { throw err; }
    return data;
  });
}
</code></pre><p>But hold on a minute – this doesn&#39;t work. The <code>return data;</code> line doesn&#39;t send
the result anywhere useful and the <code>read</code> function ends up returning <code>undefined</code>
whenever it&#39;s invoked.</p>
<p>To get a result, we have to switch up the control flow.</p>
<pre><code>function read (name, cb) {
  fs.readFile(name, function (err, data) {
    if (err) { throw err; }
    cb(data);
  });
}

read(&#39;foo.json&#39;, function (data) {
  // ...
});
</code></pre><p>Sure, this doesn&#39;t look much different from simply using <code>fs.readFile</code>, but when
you want to keep code modular and have <code>read</code> called from a separate file, this
abstraction might make sense. We aren&#39;t doing much to handle the potential
error, however (keep this in mind for later).</p>
<p>What if we instead want to read an entire directory&#39;s contents? This requires an
<code>fs</code> call to list the files in a directory and then multiple <code>readFile</code> calls
to get the contents of those files. (A similar situation might occur with other
async tasks as well, e.g. one API call that is required to get data necessary to
make successive calls).</p>
<pre><code>function getDirectoryContents (dir, cb) {
  fs.readdir(dir, function (err, files) {
    // `files` is an array of filenames excluding &#39;.&#39; and &#39;..&#39;

    var contents = {};

    _(files).each(function (filename) {
      fs.readFile(filename, function (err, data) {
        contents[filename] = data;
      });
    });

    cb(contents);
  });
}

getDirectoryContents(&#39;myDir&#39;, function (files) {
  console.log(files);   // {}
});
</code></pre><p>I tried to be clever here by pushing results of the <code>readFile</code> calls into an
object and sending that object to the callback (remember, it&#39;s passed by
reference, not copy).</p>
<p><em>Does this work as intended? What might be a problem with this approach?</em></p>
<p>If you inspect the <code>files</code> object within <code>getDirectoryContents</code>, you&#39;ll find
that it&#39;s not quite populated with the contents you expect upon immediate
execution. We could choose to wait a few milliseconds before looking at the
contents, to allow for the time it takes for the OS to run its file system
functions:</p>
<pre><code>getDirectoryContents(&#39;myDir&#39;, function (files) {
  setTimeout(function () {
    console.log(files);
  }, 5);
});
</code></pre><p>But now we&#39;ve introduced more asynchronous code and an arbitrarily-defined
control scheme involving <code>setTimeout</code>. The code looks ugly and is brittle. What
if we encountered a large JSON file and reading it took a long time?</p>
<hr>
<h2 id="promises">Promises</h2>
<p>Let&#39;s go back to the asynchronous task of getting the file contents in
a directory. There&#39;s certainly more than one way to solve this problem. I&#39;m
going to present another Node programming paradigm you can add to your toolkit.</p>
<p>A <strong><em>Promise</em></strong> is an object that represents an <em>eventual value</em> from a
computation or operation. It is the crucial idea that lets you go from having
callback-oriented code like this:</p>
<pre><code>function doSomethingWithResult (value) {
  // ...
}

doSomething(doSomethingWithResult);
</code></pre><p>to more <em>procedural</em> code like this:</p>
<pre><code>doSomething().then(doSomethingWithResult);
</code></pre><p>Now you might wonder why this is useful at all – we&#39;re actually writing <em>more
code</em> with the second snippet. The benefits of promises become apparent in their
more complex usage scenarios – namely, with chaining and error handling.</p>
<p>Instead of descending into callback hell with nesting like this:</p>
<pre><code>fs.readdir(dirname, function (err, files) {
  if (err) {
    console.log(err);
    return;
  }

  var fileToRead = dirname + &#39;/&#39; + files[0];

  fs.stat(fileToRead, function (err, stats) {
    if (err) {
      console.log(err);
      return;
    }
    if (isRecentFile(stats)) {
      fs.readFile(fileToRead, function (err, contents) {
        if (err) {
          console.log(err);
          return;
        }
        doSomeOtherAsyncTask(function (err, data) {
          // ...
        });
      });
    }
  });
});
</code></pre><p>...you might write a series of promise transformations:</p>
<pre><code>fs.readdir(dirname)
  .then(getFirstFile)
  .then(getFileStats)
  .then(filterRecentFile)
  .then(doSomeOtherAsyncTask)
  .catch(errorHandler);
</code></pre><p>Note that you probably could have refactored the above &quot;callback hell&quot; example
by creating named functions. But you still wouldn&#39;t get syntax as nice as this
and more importantly, you wouldn&#39;t be able to handle errors so elegantly.</p>
<p>By throwing in a <code>.catch()</code> call at the end of this promise chain, we can simply
write one function that handles <em>any error along the chain</em>. In other words,
errors are propagated through the chain.</p>
<p><em>Note</em>: If you&#39;re familiar with monads in mathematics or functional programming,
you can actually think of promises as monads in JS. Do-notation in Haskell
serves to turn functionally-composed control flow into an imperative one,
similar to how we just reconciled the JS callback pyramid into a series of
promise-based steps.</p>
<h3 id="implementing-promises">Implementing promises</h3>
<p>OK, so you might be on board with the idea of promises (that&#39;s good, they&#39;re
pretty cool). But how are they implemented? By giving you some ideas about how
they&#39;re implemented, I hope to give you some better tools to understand trickier
situations involving Promises.</p>
<p>Going back to the <code>doSomething</code> function example, we know that we need to change
the result of such a function from this:</p>
<pre><code>function doubleValue (val, callback) {
  callback(value * 2);
}
</code></pre><p>...into this:</p>
<pre><code>function doubleValue (val) {
  return {
    then: function (callback) {
      callback(value * 2);
    }
  }
}
</code></pre><p>This is simply some (relatively uninteresting) sugar for the callback pattern so
far, but it&#39;s a start. You can see that we have to return an object. But this is
very far from being modular.</p>
<p>Let&#39;s create a <code>Promise</code> class. The callback within <code>then</code> should have the
opportunity to <em>resolve</em> itself (signify that a result value has been
determined). We&#39;re still using raw values (not async results) to keep things
simple, though.</p>
<pre><code>function Promise (fn) {
  var callback;

  this.then = function (cb) {
    callback = cb;
  };

  function resolve (value) {
    callback(value);
  }

  fn(resolve);

  return this;
}

function doubleValue = (val) {
  return new Promise(function (resolve) {
    var value = val * 2;
    resolve(value);
  });
}

doubleValue(21).then(console.log);
</code></pre><p>The structure is kind of getting somewhere... but does it work? If you try out
this code you&#39;ll realize there&#39;s a timing problem – <code>resolve</code> is called when
<code>callback</code> hasn&#39;t been set. Here&#39;s a hack that might fix that:</p>
<pre><code>function Promise (fn) {
  // ...

  function resolve (value) {
    setTimeout(function () {
      callback(value);
    }, 1);
  }

  // ...
}
</code></pre><p>Using <code>setTimeout</code> like this forces the callback to be called on the next tick
of the event loop, giving <code>then</code> a chance to set the <code>callback</code> variable.</p>
<p>But of course, this code is very hacky. It&#39;s brittle and will break if we
introduce any sort of asynchronicity. This reveals something you may not have
realized about promises thus far: <strong>they have state</strong>.</p>
<p><strong>A promise can be <em>pending</em> waiting for a value, <em>resolved</em> with a value, or
<em>failed</em> with an error.</strong> The above example was set up for failure so that it
could be simple enough to wrap your head around.</p>
<p>If we start keeping track of state within <code>Promise</code>, we can remove the
<code>setTimeout</code> hack:</p>
<pre><code>function Promise (fn) {
  var state = &#39;pending&#39;;

  var value, deferredCallback;

  function resolve (newValue) {
    value = newValue;
    state = &#39;resolved&#39;;

    if (deferredCallback) {
      handle(defferedCallback);
    }
  }

  function handle (onResolved) {
    if (state === &#39;pending&#39;) {
      deferredCallback = onResolved;
      return;
    }

    onResolved(value);
  }

  this.then = function (onResolved) {
    handle(onResolved);
  }

  fn(resolve);
}
</code></pre><p>This is getting complicated, but now we can invoke <code>then()</code> whenever we want on
the Promise and its callback can invoke <code>resolve()</code> whenever it wants – it
basically works with synchronous or asynchronous code.</p>
<p>The above implementation works because both <code>then()</code> and <code>resolve()</code> hand off to
a new function, <code>handle()</code>, which decides what to do based on the state of the
Promise:</p>
<ul>
<li>If <code>then()</code> is called <em>on the promise</em> before <code>resolve()</code> is called <em>within
it</em>, then there is no value yet to pass along. The state is pending, so we&#39;ll
hold on to the callback. When <code>resolve()</code> is called later, the &quot;deferred&quot;
callback is invoked with a valid value.</li>
<li>If <code>resolve()</code> is called before <code>then()</code>, we can imply hold onto the resulting
value and pass it along to the callback when necessary.</li>
</ul>
<p>There&#39;s more work to be done (implement chaining and error handling), but these
are the basics, and they&#39;re pretty powerful.</p>
<p>For a more detailed analysis, I recommend this article: <a href="http://mattgreer.org/articles/promises-in-wicked-detail/">Promises In Wicked
Detail</a>.</p>
<h3 id="what-s-next">What&#39;s next</h3>
<p>Now that we&#39;ve seen all their great benefits, you should go check out some
promise libraries! Unfortunately they are not included in the ECMAScript
standard, so yes, we do have to resort to libraries here. Some good ones are
<a href="https://github.com/petkaantonov/bluebird/blob/master/API.md">bluebird</a>,
<a href="https://github.com/kriskowal/q">Q</a> and
<a href="https://github.com/tildeio/rsvp.js">rsvp.js</a>. These implement the
&quot;Promises/A&quot; spec, which will soon be included in ES6 (yay built-in promises!).
They also have some good documentation which is good to read up on.</p>

      </section>
      <section class="pure-u-3-4 notes testing language-javascript"><h1 id="testing-tools-build-systems">Testing, Tools, &amp; Build Systems</h1>
<h2 id="does-my-code-work-">Does my code work?</h2>
<p>By this point, I hope you&#39;ve had a chance to get your feet wet with the
wonderful Chrome debugger. However, as you&#39;re well aware, stepping through code
isn&#39;t the only way to verify your programs; <em>testing</em> is an important tool for
any kind of software developer.</p>
<p>In JavaScript&#39;s quest to become a &quot;real&quot; language, one of the important
milestones is a community &amp; standards that encourage safe &amp; valid code through
testing, both for TDD and code maintainability. The language&#39;s dynamic nature
and loose typing makes tests all the more important.
The browser environment also complicates things, especially when you throw in
cross-browser compatibility.</p>
<p>One positive outcome of the whole situation is that the browser sandbox
environment ensures that your code can&#39;t be <em>too</em> harmful for the user. In Node,
however, this protection doesn&#39;t exist, so you generally have to be a little
more careful.</p>
<p>There are no testing features built-in to the ECMAScript standard (no <code>assert</code>
or the like). There are, however, multiple libraries out there that will help
you build test suites using what&#39;s already built-in (because all you really
need at a low level are equality checks and <code>typeof</code>).</p>
<h2 id="testing-libraries-frameworks">Testing libraries &amp; frameworks</h2>
<p>JS testing libraries include both (1) assertion libraries and (2) testing
frameworks. They are built with modularity in mind such that the former are
typically able to power any given testing framework.</p>
<p>Assertion libraries:</p>
<ul>
<li><a href="http://nodejs.org/api/assert.html"><code>assert</code></a>, a core module in Node</li>
<li><a href="https://github.com/visionmedia/should.js"><code>should.js</code></a></li>
<li><a href="https://github.com/LearnBoost/expect.js/"><code>expect.js</code></a></li>
<li><a href="http://chaijs.com/">Chai</a></li>
</ul>
<p>Testing frameworks:</p>
<ul>
<li><a href="http://jasmine.github.io/2.0/introduction.html">Jasmine</a></li>
<li><a href="http://visionmedia.github.io/mocha/">Mocha</a></li>
<li><a href="https://qunitjs.com/">QUnit</a></li>
</ul>
<p>All of these are fairly popular in their own right, so you may choose from them
as you wish. You&#39;ll also find other more customized libraries out there.</p>
<p>I mentioned TDD earlier -- you&#39;ll find many of these libraries fall in line with
TDD (and its close relative, BDD) standard practices. Some of the syntax is
derived from <em>RSpec</em> and other testing standards in the Rails ecosystem; this
may be attributed to the fact that many web developers transitioned from writing
web applications in RoR to heavier client-side applications in JS.</p>
<h4 id="writing-unit-tests">Writing unit tests</h4>
<p>Let&#39;s take a look at what it takes to test some simple functions with Mocha and
<code>should.js</code>. We&#39;ll be writing some tests for the HW1 assignment.
Mocha provides a way to run test suites using its command line tool,
which automatically loads the framework, runs a test file, and generates some
output based on a specified test &quot;reporter&quot;:</p>
<pre><code>mocha --reporter spec test-suite.js
</code></pre><p><code>test-suite.js</code>, then, might look like this:</p>
<pre><code>/*
 * Import assertion library and the modules to test.
 */
var should  = require(&#39;should&#39;)
  , hw1     = require(&#39;../exercises&#39;)
  , key     = require(&#39;../exercises-solution&#39;);

/*
 * Lifted from hw1 stub
 */
var priceList = {
  eggs: 2.50,
  milk: 3.00,
  bread: 2.75,
  orangeJuice: 4.25,
  chocolate: 1.50
};

/*
 * Describe a test suite. These may be nested to provide more structure.
 */
describe(&#39;(Exercise 1) Array methods&#39;, function () {
  var a;

  /*
   * Runs once before each test within this suite.
   */
  beforeEach(function () {
    a = [ 1, 2, 3, 4, 5 ];
  });

  /*
   * A single test that contains one or more assertions. Mocha&#39;s DSL
   * allows us to write tests that look like plain english.
   */
  it(&#39;should sum elements&#39;, function () {
    hw1.arrayMethods.sum(a).should.equal(15);
  });

  /*
   * It&#39;s good practice to provide descriptive test names so you can easily
   * tell which part of the code is failing at a glance.
   */
  it(&#39;should throw an error if summing non-Number elements&#39;, function () {
    var b = [ 1, &#39;2&#39;, 3 ];

    (function () {
      hw1.arrayMethods.sum(b);
    }).should.throw();
  });

  it(&#39;should remove an element&#39;, function () {
    var b = hw1.arrayMethods.remove(a, 2);

    b.should.be.an.Array;
    b.indexOf(2).should.equal(-1);
  });

  it(&#39;should find duplicates&#39;, function () {
    var b = [ 1, 1, 2, 3, &#39;abc&#39;, &#39;def&#39;, &#39;abc&#39;, a, a, { foo: &#39;bar&#39; } ]
      , c = hw1.arrayMethods.findDuplicates(b)
      , cExpected = [ 1, &#39;abc&#39;, a ];

    c.should.be.an.Array;
    c.should.eql(cExpected);
  });
});
</code></pre><p>The above suite shows off some simple usage of our testing libraries of choice.
Next, let&#39;s examine some more advanced scenarios. Mocha supports async testing
simply with a <code>done</code> function provided to test and test suite callbacks. Let&#39;s
say we&#39;re testing the server-side <code>map-storage</code> module in HW6:</p>
<pre><code>var should      = require(&#39;should&#39;)
  , mapStorage  = require(&#39;../map-storage&#39;);

// ------------------------------------------------------------------------

describe(&#39;MapStorage&#39;, function () {

  // Assume a `sampleMapTiles` array exists in scope...
  describe(&#39;#saveMap&#39;, function () {
    it(&#39;should save a map to disk&#39;, function (done) {
      var mapParams = {
        name: &#39;newMap&#39;
      , tiles: sampleMapTiles
      };

      /*
       * The `done` method is flexible enough to work as a node-style
       * callback that takes `err` as its first argument.
       */
      mapStorage.saveMap(mapParams, done);
    });
  });

  describe(&#39;#getMaps&#39;, function () {
    var maps = [];

    beforeEach(function (done) {
      mapStorage.getMaps(function (mapsCollection) {
        maps = mapsCollection;
        done();
      });
    });

    /*
     * Assertions are chainable!
     */
    it(&#39;should fetch a valid maps collection from disk&#39;, function () {
      maps.should.not.be.empty;
      maps.should.be.an.Array.and.have.length(4);
      maps[0].should.be.an.Object.and.have.keys(&#39;name&#39;, &#39;tiles&#39;);
      maps[0].name.should.be.a.String;
      maps[0].tiles.should.be.an.Array;
    });
  });

});
</code></pre><p>Cool! We&#39;ve isolated the functional pieces of this node module and tested them
separately. But what if we want to write tests for UI code running in the
browser? Here, we run into a number of challenges:</p>
<ul>
<li>Self-initialization (bootstrapping an application) &amp; singletons</li>
<li>Encapsulated logic (IIFEs and the like)</li>
<li>DOM event handlers</li>
<li>XHR requests (AJAX)</li>
<li>Nested callbacks in async code</li>
</ul>
<p>We&#39;ll get back to the logistics of testing UI code. First, some ideas about
testability:</p>
<hr>
<h2 id="is-my-code-testable-">Is my code testable?</h2>
<p>Right off the bat, we know there are a few avoidable anti-patterns that make a
front end application difficult to test; these should mostly be apparent to you
if you&#39; been paying attention to JS code style.</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Anti-patterns for testable UI code&lt;/title&gt;
    &lt;style type=&quot;text/css&quot;&gt;
      .form-msg { display: none; }
    &lt;/style&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;h2&gt;Log in&lt;/h2&gt;
    &lt;form id=&quot;login&quot; action=&quot;#&quot;&gt;
      &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; placeholder=&quot;Username&quot; /&gt;
      &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;Password&quot; /&gt;
      &lt;input type=&quot;submit&quot; id=&quot;submit&quot; value=&quot;Submit&quot; /&gt;

      &lt;p class=&quot;form-msg error fields-required&quot;&gt;
        Both username and password fields are required.
      &lt;/p&gt;

      &lt;p class=&quot;form-msg success auth&quot;&gt;
        Successfully logged in!
      &lt;/p&gt;

      &lt;p class=&quot;form-msg error auth&quot;&gt;
        The username/password combination is incorrect.
      &lt;/p&gt;

      &lt;p class=&quot;form-msg error server&quot;&gt;
        There was a problem authenticating the user. Please try again later.
      &lt;/p&gt;
    &lt;/form&gt;

    &lt;!-- scripts --&gt;
    &lt;script src=&quot;//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js&quot;&gt;
    &lt;/script&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      /*
       * This code is inaccessible to tests; you can either run all of it or
       * none of it at once.
       */
      $(function () {

        $(&#39;#login&#39;).on(&#39;submit&#39;, function () {

          // Mixture of form logic and event logic here...
          event.preventDefault();

          var username = $(&#39;#username&#39;).val()
            , password = $(&#39;#password&#39;).val();

          if (username &amp;&amp; password) {
            /*
              * Requires a functioning back end...
              */
            $.ajax({
              type: &#39;POST&#39;
            , url: &#39;/authenticate_user&#39;
            , data: {
                username: username
            , password: password
              }
            , success: function (data, status, jqXHR) {
                $(&#39;.form-msg.success.auth&#39;).show();
            }
            , error: function (jqXHR, textStatus, errorThrown) {
                $(&#39;.form-msg.error.auth&#39;).show();
            }
            });
          } else {
            $(&#39;.form-msg.fields-required&#39;).show();
          }
        });
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong><em>Problems with the above code:</em></strong></p>
<ul>
<li><p>Inline JavaScript embedded in an HTML file</p>
</li>
<li><p>Entirely inaccessible code -- no public interfaces exist anywhere</p>
</li>
<li><p>No construction of a class that encapsulates logic to be tested -- in other words, a singleton that allows the results of one test to affect another</p>
</li>
<li><p>Callback nesting pyramid &amp; spaghetti code</p>
</li>
<li><p>Poorly executed DOM event handlers that mix UI &amp; business logic</p>
</li>
<li><p>Inline use of XHR requests</p>
</li>
<li><p>Asynchronous logic without any notification or event system to alert when complete</p>
</li>
</ul>
<h4 id="improving-testability">Improving testability</h4>
<p>Much of the advice we&#39;ve learned so far about client-side application structure
and separation of concerns applies here in helping us create more testable code.
To create <em>really</em> robust tests, however, we need to go a few steps farther and
look into some additional testing libraries.</p>
<p><a href="http://sinonjs.org/">SinonJS</a> is a library that provides &quot;standalone test
spies, stubs, and mocks for JavaScript&quot;. There are other libraries that provide
these features (Mockery, etc.), but SinonJS appears to be the most popular right
now. Its Getting Started page gives you a good idea of the kind of testing power
it provides you -- you can verify the behavior of callbacks &amp; their arguments,
stub out parts of your application to reduce dynamic behavior, and present mock
interfaces for things like AJAX requests.</p>
<p>In addition to being full-featured and all-encompassing (there are, of course,
also code coverage tools for JS), your tests ought to have good style on their
own and be maintainable for future developers.  <a href="http://uxebu.com/blog/2013/01/08/make-tests-read-like-a-book/">This is a good
article</a>
with advice on writing more readable tests.</p>
<hr>
<h2 id="does-my-full-stack-work-">Does my full stack work?</h2>
<p>In addition to <em>unit tests</em>, you will eventually also encounter <em>integration
tests</em> and <em>end-to-end tests</em> as a front end developer.</p>
<p><strong>Integration tests</strong> are meant to verify the joint functionality of two parts
of your application stack -- usually, these ensure that system interfaces work
as intended.</p>
<p><strong>End-to-end tests</strong>, as the name implies, test the overall functionality of an
application from the point of view of an end user. They are also the hardest to
write and maintain because they require things like mocking out a database,
simulating a headless browser, etc.</p>
<p>Libraries:</p>
<ul>
<li><a href="http://theintern.io/">Intern</a> is a neat library that automates a full test
stack by running a test suite across environments (browser, Node) and across
platforms (various browsers). </li>
<li><a href="http://docs.seleniumhq.org/">Selenium</a> allows you to automate browsers,
primarily for testing purposes</li>
<li><a href="http://phantomjs.org/">PhantomJS</a> lets you run headless browser automation
(faster than Selenium)</li>
</ul>
<hr>
<h2 id="js-workflow">JS Workflow</h2>
<p>(Demonstrated in class)</p>
<p>TDD is just one part of a serious JS developer&#39;s workflow. As your projects
expand in scope, you&#39;ll find the need to run automated build scripts to compile
assets &amp; templates. There are some great tools out there to do this job, but
unfortunately there&#39;s no single standard yet. The one I use these days is called
<a href="http://gulpjs.com/">Gulp</a> -- it&#39;s a build system that makes heavy use of
<em>Streams</em>. It&#39;s a step forward from the widely-used
<a href="http://gruntjs.com/">Grunt</a>, which doesn&#39;t handle chaining &amp; composition of
tasks very well. Even more experimental is a tool called
<a href="http://www.solitr.com/blog/2014/02/broccoli-first-release/">Broccoli</a>, which
aims to provide fast rebuilds and a nicer API for complicated plugin
composition.</p>
<p>There is a good amount of development being done on all of these libraries
(notice that they&#39;re all at version <code>&lt;1.0</code>). When selecting a build tool, keep
in mind that for most people, value is only derived if the community plugins for
the tool (CoffeeScript &amp; SASS compilers, test runners, requireJS builders, etc.)
are sufficiently populated.</p>

      </section>
      <section class="pure-u-3-4 notes coffeescript language-coffeescript"><h1 id="coffeescript">CoffeeScript</h1>
<h2 id="why-use-a-language-that-_compiles_-to-javascript-">Why use a language that <em>compiles</em> to JavaScript?</h2>
<p>As you write more JavaScript, you might get tired of avoiding the bad parts,
want things like static typing, or even just find JavaScript&#39;s syntax too clunky
for your taste. However, you can&#39;t just start using a random other language
instead of JavaScript because no other languages run in the browser.</p>
<p>That&#39;s why compile to JavaScript languages exist. They let you write in a
different language, and a cross-compiler converts it to JS so you can run it in
the browser.</p>
<p>CoffeeScript is probably the most popular compile-to-js language. It lets you
write less code that automatically passes JSHint and is arguably more readable.
There are other options like Dart by Google and TypeScript by Microsoft that
provides static typing, but those won&#39;t be covered here.</p>
<h2 id="quick-overview-of-coffeescript-syntax">Quick overview of CoffeeScript syntax</h2>
<p>Note: Taken and adapted from <a href="http://www.coffeescript.org">coffeescript.org</a></p>
<pre><code># Assignment:
number   = 42

# Conditions:
if number == 42
  console.log &#39;here&#39;
  console.log &#39;number is 42&#39;
else
  console.log(&quot;number is &quot;)
# Existence:
alert &quot;I knew it!&quot; if elvis?

# Functions:
square = (x) -&gt; x * x

# Objects:
math =
  root:   Math.sqrt
  square: square
  cube:   (x) -&gt; x * square x
  nested1: {a: 1, b: 2}
  nested2:
    a: 1
    b: 2

list = [1, 2, 3, 4, 5]
# Array comprehensions:
cubes = (math.cube num for num in list when num &gt; 2)

# for in loops
# prints 1, 2, 3, 4, 5 not 0, 1, 2, 3, 4, 5
for el in list
  console.log e

for k, v of math
  console.log k, v
</code></pre><p>Some things to note:</p>
<ul>
<li><p>There are no semicolons. It actually results in a compiler error if you end a
line with one. This makes it impossible to have those weird semicolon
insertion bugs.</p>
</li>
<li><p>There are no <code>var</code>s. The <code>var</code> keyword is undefined in CoffeeScript. Variables
are local by default. If you want to make it global you need to attach it to a
global object like <code>window</code>. This prevents accidentally creating global
variables, and some easy to miss bugs caused by variable hoisting.</p>
</li>
<li><p>CoffeeScript is whitespace sensitive. See in the if statement, instead of
using braces, the code is just tabbed over.</p>
</li>
<li><p>You don&#39;t need to use <code>===</code>, it&#39;s actually a compiler error. <code>==</code> are
converted to <code>===</code> during the compilation.</p>
</li>
<li><p>You don&#39;t need to use <code>()</code> when calling a function with arguments. This can
get confusing with nested function calls, though. Also you need the parentheses
when calling a function without arguments (unlike Ruby).</p>
</li>
<li><p>CoffeeScript has syntactic sugar for string interpolation, letting you insert
CoffeeScript code in the middle of the string with <code>\#\{\}</code>. This only works
inside double quotes, though.    </p>
</li>
<li><p>Everything is a statement, so you can use Ruby style one line if statements,
i.e. <code>doSomething() if condition</code>.</p>
</li>
<li><p>CoffeeScript has an existential operator <code>?</code>. It compiles to
<code>typeof elvis !== &quot;undefined&quot; &amp;&amp; elvis !== null</code>.</p>
</li>
<li><p>Functions are defined with <code>() -&gt;</code>. The arguments go in the parentheses and
once again it&#39;s whitespace sensitive instead of using braces.</p>
</li>
<li><p>Functions implicitly return the last line. Explicit <code>return</code> statements can
also be used.</p>
</li>
<li><p>Objects can be defined either by using whitespace and ommiting the braces and
commas, or in the standard way. Nested objects also work fine either way.</p>
</li>
<li><p>CoffeeScript supports list comprehensions similar to python.</p>
</li>
<li><p>For in loops on lists work as you would expect coming from other languages.
It iterates over the elements instead of the indices.</p>
</li>
<li><p>CoffeeScript has <code>for of</code> loops for iterating over keys/values objects.</p>
</li>
</ul>
<h2 id="coffeescript-s-more-interesting-features">CoffeeScript&#39;s more interesting features</h2>
<p><strong>Classes</strong>:</p>
<p>CoffeeScript provides some nice abstraction for object oriented programming.</p>
<pre><code>class Animal
  constructor: (@name) -&gt;

  move: (meters) -&gt;
    alert @name + &quot; moved m.&quot;

class Snake extends Animal
  move: -&gt;
    alert &quot;Slithering...&quot;
    super 5

class Horse extends Animal
  move: -&gt;
    alert &quot;Galloping...&quot;
    super 45

sam = new Snake &quot;Sammy the Python&quot;
tom = new Horse &quot;Tommy the Palomino&quot;

sam.move()
tom.move()
</code></pre><p>Some things to note:</p>
<ul>
<li><p>You don&#39;t have to use the convoluted psuedo-class construction with
prototypes. You just use the keyword <code>class</code> and list out (class &amp; instance)
methods &amp; properties. (You can still access <code>.prototype</code> using the <code>::</code>
operator, though).</p>
</li>
<li><p>If you define a <code>constructor</code> function, it is called when an object is
instantiated.</p>
</li>
<li><p><code>@</code> is syntactic sugar for <code>this.</code> access.</p>
</li>
<li><p>To set up inheritance, just use the word <code>extends</code>, similar to Java.</p>
</li>
<li><p>You can call the overridden superclass&#39;s function using the <code>super</code> keyword.</p>
</li>
</ul>
<p><strong>Fat Arrow</strong>:</p>
<p>When defining a function, you can use a fat arrow <code>=&gt;</code> (instead of <code>-&gt;</code>) to bind
a function to the current value of <code>this</code>. This is useful for setting callbacks,
among other things.</p>
<pre><code>Account = (customer, cart) -&gt;
  @customer = customer
  @cart = cart

  $(&#39;.shopping_cart&#39;).bind &#39;click&#39;, (event) =&gt;
    @customer.purchase @cart
</code></pre><h2 id="how-to-use-coffeescript">How to use CoffeeScript</h2>
<p>Install <code>coffee</code> globally with <code>sudo npm install -g coffee-script</code>.</p>
<p>The standard file extension is <code>.coffee</code>. You can run a file without compiling
it using <code>coffee &lt;name&gt;.coffee</code>.</p>
<p>You&#39;ll generally want to have your CoffeeScript files automatically compiled.
You can do this with a command like <code>coffee -mo js/ -cw coffee/</code>.
In particular, this will:</p>
<ul>
<li>take all of the <code>name&gt;.coffee</code> files in the <code>coffee/</code> directory and save
them to <code>&lt;name&gt;.js</code> in the <code>js/</code> directory</li>
<li>update the files in <code>js/</code> as the files in <code>coffee/</code> change</li>
<li>create source maps, allowing the browser to give you line numbers in your
CoffeeScript files for errors instead of the line numbers in your compiled
JS files.</li>
</ul>

      </section>
      <section class="pure-u-3-4 notes d3 language-javascript"><h1 id="data-visualization-with-d3-js">Data Visualization with D3.js</h1>
<p><em>April 30, 2014</em></p>

      </section>
    </div>
  </body>
  <script type="text/javascript" src="build/javascripts/main-optimized.min.js"></script>
  <script type="text/javascript" src="build/javascripts/vendor/prism.min.js"></script>
</html>